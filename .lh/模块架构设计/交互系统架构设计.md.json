{
    "sourceFile": "模块架构设计/交互系统架构设计.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 11,
            "patches": [
                {
                    "date": 1767205556732,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767205566849,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -81,9 +81,9 @@\n graph LR\r\n     Start[Unity Inspector<br/>配置interactionTemplateId] -->|1. 读取模板ID| Template[模板层<br/>查找EInteractionTypeTemplate]\r\n     Template -->|2. 获取组件类型| Component[组件查找器<br/>自动查找所需组件]\r\n     Component -->|3. 获取组件列表| Orchestrator[初始化编排器<br/>统一初始化流程]\r\n-    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInit[ComponentType]\r\n+    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInitComponentType]\r\n     Init -->|5. 配置组件参数| Unity[Unity组件层<br/>完成配置]\r\n     \r\n     style Template fill:#e1f5ff\r\n     style Component fill:#fff4e1\r\n"
                },
                {
                    "date": 1767205579719,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,13 +77,13 @@\n \r\n ### 模板方法数据流\r\n \r\n ```mermaid\r\n-graph LR\r\n+graph TD\r\n     Start[Unity Inspector<br/>配置interactionTemplateId] -->|1. 读取模板ID| Template[模板层<br/>查找EInteractionTypeTemplate]\r\n     Template -->|2. 获取组件类型| Component[组件查找器<br/>自动查找所需组件]\r\n     Component -->|3. 获取组件列表| Orchestrator[初始化编排器<br/>统一初始化流程]\r\n-    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInitComponentType]\r\n+    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInit.ComponentType]\r\n     Init -->|5. 配置组件参数| Unity[Unity组件层<br/>完成配置]\r\n     \r\n     style Template fill:#e1f5ff\r\n     style Component fill:#fff4e1\r\n"
                },
                {
                    "date": 1767205585117,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -81,9 +81,9 @@\n graph TD\r\n     Start[Unity Inspector<br/>配置interactionTemplateId] -->|1. 读取模板ID| Template[模板层<br/>查找EInteractionTypeTemplate]\r\n     Template -->|2. 获取组件类型| Component[组件查找器<br/>自动查找所需组件]\r\n     Component -->|3. 获取组件列表| Orchestrator[初始化编排器<br/>统一初始化流程]\r\n-    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInit.ComponentType]\r\n+    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInit]\r\n     Init -->|5. 配置组件参数| Unity[Unity组件层<br/>完成配置]\r\n     \r\n     style Template fill:#e1f5ff\r\n     style Component fill:#fff4e1\r\n"
                },
                {
                    "date": 1767205599329,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -143,9 +143,9 @@\n \r\n ```mermaid\r\n flowchart TD\r\n     Start[Unity Inspector<br/>配置interactionTemplateId] --> ReadTemplate[读取模板ID<br/>itemLifecycle.interactionTemplateId]\r\n-    ReadTemplate --> FindTemplate[查找模板<br/>EInteractionTypeTemplate[templateId]]\r\n+    ReadTemplate --> FindTemplate[查找模板<br/>EInteractionTypeTemplate]\r\n     FindTemplate -->|找到模板| GetTypeList[获取组件类型列表<br/>template.type]\r\n     FindTemplate -->|未找到| Error[错误：模板不存在]\r\n     \r\n     GetTypeList --> FindComponents[组件查找器<br/>遍历type列表，查找组件]\r\n"
                },
                {
                    "date": 1767205607279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -149,13 +149,13 @@\n     FindTemplate -->|未找到| Error[错误：模板不存在]\r\n     \r\n     GetTypeList --> FindComponents[组件查找器<br/>遍历type列表，查找组件]\r\n     FindComponents --> CheckComponents{所有组件<br/>是否找到?}\r\n-    CheckComponents -->|是| CreateComponentList[创建组件列表<br/>comps = {comp1, comp2, ...}]\r\n+    CheckComponents -->|是| CreateComponentList[创建组件列表<br/>comps]\r\n     CheckComponents -->|否| Error2[错误：组件未找到]\r\n     \r\n     CreateComponentList --> CallInit[调用初始化函数<br/>template.init(comps)]\r\n-    CallInit --> InitStrategy[初始化策略<br/>InterationInit[ComponentType]\"]\r\n+    CallInit --> InitStrategy[初始化策略<br/>InterationInit]\r\n     InitStrategy --> ConfigComponent[配置组件参数<br/>完成初始化]\r\n     ConfigComponent --> Success[初始化完成]\r\n     \r\n     style CheckComponents fill:#fff4e1,stroke:#333,stroke-width:2px\r\n"
                },
                {
                    "date": 1767205612889,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,9 +152,9 @@\n     FindComponents --> CheckComponents{所有组件<br/>是否找到?}\r\n     CheckComponents -->|是| CreateComponentList[创建组件列表<br/>comps]\r\n     CheckComponents -->|否| Error2[错误：组件未找到]\r\n     \r\n-    CreateComponentList --> CallInit[调用初始化函数<br/>template.init(comps)]\r\n+    CreateComponentList --> CallInit[调用初始化函数<br/>template.init]\r\n     CallInit --> InitStrategy[初始化策略<br/>InterationInit]\r\n     InitStrategy --> ConfigComponent[配置组件参数<br/>完成初始化]\r\n     ConfigComponent --> Success[初始化完成]\r\n     \r\n"
                },
                {
                    "date": 1767205623575,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -223,10 +223,10 @@\n ### 工作流程\r\n \r\n ```mermaid\r\n flowchart TD\r\n-    Start[接收组件列表<br/>comps = {comp1, comp2, ...}] --> ExtractComponent[提取组件<br/>local comp = table.remove(comps, 1)]\r\n-    ExtractComponent --> SelectStrategy{选择初始化策略<br/>InterationInit[ComponentType]}\r\n+    Start[接收组件列表<br/>comps] --> ExtractComponent[提取组件<br/>local comp = table.remove(comps, 1)]\r\n+    ExtractComponent --> SelectStrategy{选择初始化策略<br/>InterationInit}\r\n     \r\n     SelectStrategy --> PickableItemStrategy[PickableItem策略<br/>配置拾取效果/音效]\r\n     SelectStrategy --> KeyOperatedZoneStrategy[KeyOperatedZone策略<br/>配置碰撞体/提示UI]\r\n     SelectStrategy --> MovingPlatformStrategy[MovingPlatform策略<br/>配置路径点/速度]\r\n"
                },
                {
                    "date": 1767205630689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,9 +237,9 @@\n     MovingPlatformStrategy --> ReadParams\r\n     OtherStrategy --> ReadParams\r\n     \r\n     ReadParams --> ApplyDefault[应用默认值<br/>param.value or defaultValue]\r\n-    ApplyDefault --> ConfigComponent[配置组件<br/>comp.property = param.value]\r\n+    ApplyDefault --> ConfigComponent[配置组件<br/>comp.property]\r\n     ConfigComponent --> ConfigFeedback[配置反馈效果<br/>MMFeedbacks/粒子系统]\r\n     ConfigFeedback --> Success[初始化完成]\r\n     \r\n     style SelectStrategy fill:#fff4e1,stroke:#333,stroke-width:2px\r\n"
                },
                {
                    "date": 1767205646147,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -223,9 +223,9 @@\n ### 工作流程\r\n \r\n ```mermaid\r\n flowchart TD\r\n-    Start[接收组件列表<br/>comps] --> ExtractComponent[提取组件<br/>local comp = table.remove(comps, 1)]\r\n+    Start[接收组件列表<br/>comps] --> ExtractComponent[提取组件<br/>local comp = table.remove]\r\n     ExtractComponent --> SelectStrategy{选择初始化策略<br/>InterationInit}\r\n     \r\n     SelectStrategy --> PickableItemStrategy[PickableItem策略<br/>配置拾取效果/音效]\r\n     SelectStrategy --> KeyOperatedZoneStrategy[KeyOperatedZone策略<br/>配置碰撞体/提示UI]\r\n"
                },
                {
                    "date": 1767205651368,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -223,9 +223,9 @@\n ### 工作流程\r\n \r\n ```mermaid\r\n flowchart TD\r\n-    Start[接收组件列表<br/>comps] --> ExtractComponent[提取组件<br/>local comp = table.remove]\r\n+    Start[接收组件列表<br/>comps] --> ExtractComponent[提取组件]\r\n     ExtractComponent --> SelectStrategy{选择初始化策略<br/>InterationInit}\r\n     \r\n     SelectStrategy --> PickableItemStrategy[PickableItem策略<br/>配置拾取效果/音效]\r\n     SelectStrategy --> KeyOperatedZoneStrategy[KeyOperatedZone策略<br/>配置碰撞体/提示UI]\r\n"
                },
                {
                    "date": 1767205667332,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -231,9 +231,9 @@\n     SelectStrategy --> KeyOperatedZoneStrategy[KeyOperatedZone策略<br/>配置碰撞体/提示UI]\r\n     SelectStrategy --> MovingPlatformStrategy[MovingPlatform策略<br/>配置路径点/速度]\r\n     SelectStrategy --> OtherStrategy[其他策略<br/>...]\r\n     \r\n-    PickableItemStrategy --> ReadParams[读取参数配置<br/>param = param or {}]\r\n+    PickableItemStrategy --> ReadParams[读取参数配置<br/>param]\r\n     KeyOperatedZoneStrategy --> ReadParams\r\n     MovingPlatformStrategy --> ReadParams\r\n     OtherStrategy --> ReadParams\r\n     \r\n@@ -305,9 +305,9 @@\n \r\n ```mermaid\r\n graph TB\r\n     Context[上下文<br/>InteractionUtil]\r\n-    StrategyInterface[策略接口<br/>InterationInit[ComponentType]]\r\n+    StrategyInterface[策略接口<br/>InterationInit]\r\n     \r\n     Strategy1[策略1<br/>PickableItem初始化]\r\n     Strategy2[策略2<br/>KeyOperatedZone初始化]\r\n     Strategy3[策略3<br/>MovingPlatform初始化]\r\n"
                }
            ],
            "date": 1767205556732,
            "name": "Commit-0",
            "content": "# 交互系统架构设计\r\n\r\n## 设计目标\r\n\r\n设计一套完整的交互系统架构，支持多种交互类型（物品拾取、门、宝箱、传送门等），实现模板化配置、组件自动初始化、参数化配置，提供数据驱动的配置化交互系统。\r\n\r\n---\r\n\r\n## 核心设计理念\r\n\r\n### 1. 模板化配置为核心\r\n\r\n**本质**：交互系统的核心是模板化配置机制\r\n- 交互配置 = 一个模板ID即可完成完整配置\r\n- 组件初始化 = 模板自动查找组件并初始化\r\n- 参数化配置 = 同一个模板可以有不同的参数配置\r\n- 统一管理 = 所有交互类型通过统一的模板系统管理\r\n\r\n### 2. 数据驱动架构\r\n\r\n**本质**：交互特性通过配置数据实现，无需修改代码\r\n- 交互类型、组件类型 → 通过模板配置定义\r\n- 初始化参数、反馈效果 → 通过参数配置调整\r\n- 新增交互类型 → 扩展模板配置即可\r\n- 交互平衡 → 调整配置参数即可\r\n\r\n### 3. 策略模式 + 外观模式\r\n\r\n**本质**：模板方法模式实现标准化流程，外观模式隐藏复杂逻辑\r\n- 模板方法模式：定义交互初始化的标准流程\r\n- 策略模式：每个模板就是一种交互策略\r\n- 外观模式：隐藏复杂的初始化逻辑，提供简单的配置接口\r\n- 工厂模式：模板工厂创建交互组件\r\n\r\n---\r\n\r\n## 整体架构设计\r\n\r\n### 三层架构 + 模板方法模式\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph ConfigLayer[\"配置层<br/>Unity Inspector\"]\r\n        ItemLifecycle[\"ItemLifecycle组件<br/>interactionTemplateId\"]\r\n        TemplateConfig[\"模板配置<br/>EInteractionTypeTemplate\"]\r\n    end\r\n    \r\n    subgraph TemplateLayer[\"模板层<br/>InteractionUtil\"]\r\n        TemplateRegistry[\"模板注册表<br/>EInteractionTypeTemplate\"]\r\n        ComponentFinder[\"组件查找器<br/>自动查找所需组件\"]\r\n        InitOrchestrator[\"初始化编排器<br/>统一初始化流程\"]\r\n    end\r\n    \r\n    subgraph InitLayer[\"初始化层<br/>InteractionInit\"]\r\n        InitStrategies[\"初始化策略组<br/>InterationInit[ComponentType]\"]\r\n        ParamConfig[\"参数配置<br/>参数化配置支持\"]\r\n    end\r\n    \r\n    subgraph UnityLayer[\"Unity组件层\"]\r\n        TopDownComponents[\"TopDown组件<br/>PickableItem/KeyOperatedZone等\"]\r\n        FeedbackComponents[\"反馈组件<br/>MMFeedbacks/粒子系统等\"]\r\n    end\r\n    \r\n    ConfigLayer -->|读取模板ID| TemplateLayer\r\n    TemplateLayer -->|查找模板| TemplateRegistry\r\n    TemplateRegistry -->|查找组件| ComponentFinder\r\n    ComponentFinder -->|获取组件列表| InitOrchestrator\r\n    InitOrchestrator -->|调用初始化| InitLayer\r\n    InitLayer -->|执行策略| InitStrategies\r\n    InitStrategies -->|配置组件| UnityLayer\r\n    \r\n    style ConfigLayer fill:#fff9c4\r\n    style TemplateLayer fill:#e1f5ff\r\n    style InitLayer fill:#fff4e1\r\n    style UnityLayer fill:#c8e6c9\r\n```\r\n\r\n### 模板方法数据流\r\n\r\n```mermaid\r\ngraph LR\r\n    Start[Unity Inspector<br/>配置interactionTemplateId] -->|1. 读取模板ID| Template[模板层<br/>查找EInteractionTypeTemplate]\r\n    Template -->|2. 获取组件类型| Component[组件查找器<br/>自动查找所需组件]\r\n    Component -->|3. 获取组件列表| Orchestrator[初始化编排器<br/>统一初始化流程]\r\n    Orchestrator -->|4. 调用初始化策略| Init[初始化层<br/>InterationInit[ComponentType]\r\n    Init -->|5. 配置组件参数| Unity[Unity组件层<br/>完成配置]\r\n    \r\n    style Template fill:#e1f5ff\r\n    style Component fill:#fff4e1\r\n    style Init fill:#c8e6c9\r\n    style Unity fill:#c8e6c9\r\n```\r\n\r\n**数据流特性**：\r\n- ✅ **模板驱动**：一个模板ID即可完成完整配置\r\n- ✅ **自动查找**：系统自动查找所需组件，无需手动添加\r\n- ✅ **统一流程**：所有交互类型使用统一的初始化流程\r\n- ✅ **参数化配置**：同一个模板可以有不同的参数配置\r\n- ✅ **策略模式**：每个组件类型对应一个初始化策略\r\n- ✅ **外观模式**：隐藏复杂的初始化逻辑，提供简单的配置接口\r\n\r\n---\r\n\r\n## 模板层架构设计\r\n\r\n### 核心职责\r\n\r\n模板注册管理 + 组件自动查找 + 初始化流程编排\r\n\r\n### 架构图\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph InteractionUtil[\"InteractionUtil模板管理器\"]\r\n        TemplateRegistry[\"模板注册表<br/>EInteractionTypeTemplate<br/>templateId → {type, init}\"]\r\n        ComponentFinder[\"组件查找器<br/>自动查找所需组件<br/>GetComponents<T>()\"]\r\n        InitOrchestrator[\"初始化编排器<br/>统一初始化流程<br/>InitItemInteraction()\"]\r\n    end\r\n    \r\n    subgraph TemplateStructure[\"模板结构\"]\r\n        TypeList[\"组件类型列表<br/>type = {ComponentType1, ComponentType2}\"]\r\n        InitFunction[\"初始化函数<br/>init = function(comps) end\"]\r\n    end\r\n    \r\n    subgraph ComponentList[\"组件列表\"]\r\n        Comp1[\"组件1<br/>ComponentType1\"]\r\n        Comp2[\"组件2<br/>ComponentType2\"]\r\n        CompN[\"组件N<br/>...\"]\r\n    end\r\n    \r\n    TemplateRegistry -->|读取模板| TemplateStructure\r\n    TemplateStructure -->|获取类型列表| ComponentFinder\r\n    ComponentFinder -->|查找组件| ComponentList\r\n    ComponentList -->|传递组件列表| InitOrchestrator\r\n    InitOrchestrator -->|调用init函数| TemplateStructure\r\n    \r\n    style InteractionUtil fill:#e1f5ff\r\n    style TemplateStructure fill:#fff4e1\r\n    style ComponentList fill:#c8e6c9\r\n```\r\n\r\n### 工作流程\r\n\r\n```mermaid\r\nflowchart TD\r\n    Start[Unity Inspector<br/>配置interactionTemplateId] --> ReadTemplate[读取模板ID<br/>itemLifecycle.interactionTemplateId]\r\n    ReadTemplate --> FindTemplate[查找模板<br/>EInteractionTypeTemplate[templateId]]\r\n    FindTemplate -->|找到模板| GetTypeList[获取组件类型列表<br/>template.type]\r\n    FindTemplate -->|未找到| Error[错误：模板不存在]\r\n    \r\n    GetTypeList --> FindComponents[组件查找器<br/>遍历type列表，查找组件]\r\n    FindComponents --> CheckComponents{所有组件<br/>是否找到?}\r\n    CheckComponents -->|是| CreateComponentList[创建组件列表<br/>comps = {comp1, comp2, ...}]\r\n    CheckComponents -->|否| Error2[错误：组件未找到]\r\n    \r\n    CreateComponentList --> CallInit[调用初始化函数<br/>template.init(comps)]\r\n    CallInit --> InitStrategy[初始化策略<br/>InterationInit[ComponentType]\"]\r\n    InitStrategy --> ConfigComponent[配置组件参数<br/>完成初始化]\r\n    ConfigComponent --> Success[初始化完成]\r\n    \r\n    style CheckComponents fill:#fff4e1,stroke:#333,stroke-width:2px\r\n    style FindTemplate fill:#e1f5ff\r\n    style InitStrategy fill:#c8e6c9\r\n    style Success fill:#c8e6c9\r\n```\r\n\r\n### 核心组件\r\n\r\n1. **模板注册表（EInteractionTypeTemplate）**\r\n   - 存储所有交互模板配置\r\n   - 模板结构：`{type = {ComponentType1, ...}, init = function(comps) end}`\r\n   - 支持动态注册新模板\r\n\r\n2. **组件查找器（ComponentFinder）**\r\n   - 根据模板的type列表自动查找组件\r\n   - 支持多种组件类型（PickableItem、KeyOperatedZone等）\r\n   - 自动处理组件查找失败的情况\r\n\r\n3. **初始化编排器（InitOrchestrator）**\r\n   - 统一管理初始化流程\r\n   - 调用模板的init函数\r\n   - 传递组件列表给初始化策略\r\n\r\n---\r\n\r\n## 初始化层架构设计\r\n\r\n### 核心职责\r\n\r\n组件初始化策略 + 参数化配置 + 组件参数设置\r\n\r\n### 架构图\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph InteractionInit[\"InteractionInit初始化策略组\"]\r\n        PickableItemInit[\"PickableItem初始化<br/>InterationInit[PickableItem]\"]\r\n        KeyOperatedZoneInit[\"KeyOperatedZone初始化<br/>InterationInit[KeyOperatedZone]\"]\r\n        MovingPlatformInit[\"MovingPlatform初始化<br/>InterationInit[MovingPlatform]\"]\r\n        OtherInit[\"其他组件初始化<br/>...\"]\r\n    end\r\n    \r\n    subgraph ParamConfig[\"参数配置\"]\r\n        DefaultParams[\"默认参数<br/>提供合理默认值\"]\r\n        CustomParams[\"自定义参数<br/>参数化配置\"]\r\n    end\r\n    \r\n    subgraph ComponentConfig[\"组件配置\"]\r\n        PropertySet[\"属性设置<br/>设置组件属性\"]\r\n        FeedbackConfig[\"反馈配置<br/>配置反馈效果\"]\r\n        ColliderConfig[\"碰撞体配置<br/>配置碰撞体参数\"]\r\n    end\r\n    \r\n    InteractionInit -->|读取参数| ParamConfig\r\n    ParamConfig -->|应用配置| ComponentConfig\r\n    ComponentConfig -->|完成初始化| UnityComponent[Unity组件<br/>配置完成]\r\n    \r\n    style InteractionInit fill:#fff4e1\r\n    style ParamConfig fill:#e1f5ff\r\n    style ComponentConfig fill:#c8e6c9\r\n```\r\n\r\n### 工作流程\r\n\r\n```mermaid\r\nflowchart TD\r\n    Start[接收组件列表<br/>comps = {comp1, comp2, ...}] --> ExtractComponent[提取组件<br/>local comp = table.remove(comps, 1)]\r\n    ExtractComponent --> SelectStrategy{选择初始化策略<br/>InterationInit[ComponentType]}\r\n    \r\n    SelectStrategy --> PickableItemStrategy[PickableItem策略<br/>配置拾取效果/音效]\r\n    SelectStrategy --> KeyOperatedZoneStrategy[KeyOperatedZone策略<br/>配置碰撞体/提示UI]\r\n    SelectStrategy --> MovingPlatformStrategy[MovingPlatform策略<br/>配置路径点/速度]\r\n    SelectStrategy --> OtherStrategy[其他策略<br/>...]\r\n    \r\n    PickableItemStrategy --> ReadParams[读取参数配置<br/>param = param or {}]\r\n    KeyOperatedZoneStrategy --> ReadParams\r\n    MovingPlatformStrategy --> ReadParams\r\n    OtherStrategy --> ReadParams\r\n    \r\n    ReadParams --> ApplyDefault[应用默认值<br/>param.value or defaultValue]\r\n    ApplyDefault --> ConfigComponent[配置组件<br/>comp.property = param.value]\r\n    ConfigComponent --> ConfigFeedback[配置反馈效果<br/>MMFeedbacks/粒子系统]\r\n    ConfigFeedback --> Success[初始化完成]\r\n    \r\n    style SelectStrategy fill:#fff4e1,stroke:#333,stroke-width:2px\r\n    style ReadParams fill:#e1f5ff\r\n    style ConfigComponent fill:#c8e6c9\r\n    style Success fill:#c8e6c9\r\n```\r\n\r\n### 核心组件\r\n\r\n1. **初始化策略组（InteractionInit）**\r\n   - 每个组件类型对应一个初始化策略\r\n   - 策略函数签名：`InterationInit[ComponentType](component, param)`\r\n   - 支持参数化配置，提供默认值\r\n\r\n2. **参数配置系统（ParamConfig）**\r\n   - 支持默认参数和自定义参数\r\n   - 参数验证和类型检查\r\n   - 参数合并机制（自定义参数覆盖默认参数）\r\n\r\n---\r\n\r\n## 架构模式分析\r\n\r\n### 模板方法模式（Template Method Pattern）\r\n\r\n**核心思想**：定义交互初始化的标准流程，子步骤由具体策略实现\r\n\r\n```mermaid\r\ngraph TB\r\n    TemplateMethod[模板方法<br/>InitItemInteraction<br/>定义标准流程]\r\n    \r\n    Step1[步骤1：查找模板<br/>抽象步骤]\r\n    Step2[步骤2：查找组件<br/>抽象步骤]\r\n    Step3[步骤3：调用初始化<br/>具体步骤]\r\n    \r\n    ConcreteStep1[具体实现1<br/>查找EInteractionTypeTemplate]\r\n    ConcreteStep2[具体实现2<br/>查找Unity组件]\r\n    ConcreteStep3[具体实现3<br/>调用InterationInit]\r\n    \r\n    TemplateMethod --> Step1\r\n    TemplateMethod --> Step2\r\n    TemplateMethod --> Step3\r\n    \r\n    Step1 --> ConcreteStep1\r\n    Step2 --> ConcreteStep2\r\n    Step3 --> ConcreteStep3\r\n    \r\n    style TemplateMethod fill:#f3e5f5\r\n    style Step1 fill:#e1f5ff\r\n    style Step2 fill:#e1f5ff\r\n    style Step3 fill:#fff4e1\r\n```\r\n\r\n**优势**：\r\n- ✅ **标准化流程**：所有交互类型使用统一的初始化流程\r\n- ✅ **灵活扩展**：可以轻松添加新的初始化步骤\r\n- ✅ **代码复用**：公共流程在模板方法中实现\r\n\r\n### 策略模式（Strategy Pattern）\r\n\r\n**核心思想**：每个组件类型对应一个初始化策略\r\n\r\n```mermaid\r\ngraph TB\r\n    Context[上下文<br/>InteractionUtil]\r\n    StrategyInterface[策略接口<br/>InterationInit[ComponentType]]\r\n    \r\n    Strategy1[策略1<br/>PickableItem初始化]\r\n    Strategy2[策略2<br/>KeyOperatedZone初始化]\r\n    Strategy3[策略3<br/>MovingPlatform初始化]\r\n    \r\n    Context -->|选择策略| StrategyInterface\r\n    StrategyInterface --> Strategy1\r\n    StrategyInterface --> Strategy2\r\n    StrategyInterface --> Strategy3\r\n    \r\n    style Context fill:#f3e5f5\r\n    style StrategyInterface fill:#e1f5ff\r\n    style Strategy1 fill:#c8e6c9\r\n    style Strategy2 fill:#c8e6c9\r\n    style Strategy3 fill:#c8e6c9\r\n```\r\n\r\n**优势**：\r\n- ✅ **策略替换**：可以动态替换初始化策略\r\n- ✅ **扩展性强**：新增组件类型只需添加新策略\r\n- ✅ **解耦设计**：上下文和策略解耦\r\n\r\n### 外观模式（Facade Pattern）\r\n\r\n**核心思想**：隐藏复杂的初始化逻辑，提供简单的配置接口\r\n\r\n```mermaid\r\ngraph TB\r\n    Client[客户端<br/>Unity Inspector<br/>只需配置templateId]\r\n    Facade[外观<br/>InteractionUtil<br/>InitItemInteraction]\r\n    \r\n    Subsystem1[子系统1<br/>模板查找]\r\n    Subsystem2[子系统2<br/>组件查找]\r\n    Subsystem3[子系统3<br/>初始化策略]\r\n    Subsystem4[子系统4<br/>参数配置]\r\n    \r\n    Client -->|简单调用| Facade\r\n    Facade -->|协调调用| Subsystem1\r\n    Facade -->|协调调用| Subsystem2\r\n    Facade -->|协调调用| Subsystem3\r\n    Facade -->|协调调用| Subsystem4\r\n    \r\n    style Client fill:#fff9c4\r\n    style Facade fill:#f3e5f5\r\n    style Subsystem1 fill:#e1f5ff\r\n    style Subsystem2 fill:#e1f5ff\r\n    style Subsystem3 fill:#fff4e1\r\n    style Subsystem4 fill:#c8e6c9\r\n```\r\n\r\n**优势**：\r\n- ✅ **简化接口**：客户端只需配置templateId，无需了解内部实现\r\n- ✅ **隐藏复杂性**：复杂的初始化逻辑被隐藏在外观内部\r\n- ✅ **易于使用**：降低使用门槛，提高开发效率\r\n\r\n---\r\n\r\n## 数据流设计\r\n\r\n### 初始化数据流\r\n\r\n```mermaid\r\nsequenceDiagram\r\n    participant UI as Unity Inspector\r\n    participant IT as InteractionUtil\r\n    participant TR as TemplateRegistry\r\n    participant CF as ComponentFinder\r\n    participant II as InteractionInit\r\n    participant UC as Unity Component\r\n    \r\n    UI->>IT: 配置interactionTemplateId\r\n    IT->>TR: 查找模板 EInteractionTypeTemplate[templateId]\r\n    TR->>IT: 返回模板 {type, init}\r\n    IT->>CF: 根据type列表查找组件\r\n    CF->>UC: GetComponents<ComponentType>()\r\n    UC->>CF: 返回组件列表\r\n    CF->>IT: 返回组件列表 comps\r\n    IT->>II: 调用 template.init(comps)\r\n    II->>UC: 配置组件参数\r\n    UC->>II: 配置完成\r\n    II->>IT: 初始化完成\r\n```\r\n\r\n### 模板注册数据流\r\n\r\n```mermaid\r\nsequenceDiagram\r\n    participant Dev as 开发者\r\n    participant TR as TemplateRegistry\r\n    participant II as InteractionInit\r\n    \r\n    Dev->>TR: 注册新模板 EInteractionTypeTemplate[id] = {type, init}\r\n    TR->>TR: 存储模板配置\r\n    Dev->>II: 实现初始化策略 InterationInit[ComponentType]\r\n    II->>II: 存储初始化函数\r\n    Note over TR,II: 模板注册完成，可在Unity中使用\r\n```\r\n\r\n---\r\n\r\n## 架构验证\r\n\r\n### 流程合理性验证\r\n\r\n从架构可验证：\r\n- ✅ **数据流完整**：配置模板ID → 查找模板 → 查找组件 → 初始化 → 完成（完整流程）\r\n- ✅ **职责清晰**：模板层、初始化层职责明确，无重叠\r\n- ✅ **解耦设计**：通过策略模式实现组件类型和初始化逻辑解耦\r\n- ✅ **扩展性强**：新增交互类型只需注册模板和实现策略\r\n\r\n### 扩展性验证\r\n\r\n从架构可验证：\r\n- ✅ **模板方法模式**：新增初始化步骤只需扩展模板方法\r\n- ✅ **策略模式**：新增组件类型只需添加新策略\r\n- ✅ **外观模式**：客户端接口稳定，内部实现可自由扩展\r\n- ✅ **配置驱动**：新交互类型通过配置数据扩展\r\n\r\n### 易用性验证\r\n\r\n从架构可验证：\r\n- ✅ **简单配置**：只需配置一个templateId即可完成初始化\r\n- ✅ **自动处理**：系统自动查找组件和执行初始化\r\n- ✅ **参数化**：支持参数化配置，灵活调整\r\n- ✅ **统一接口**：所有交互类型使用统一的配置方式\r\n\r\n---\r\n\r\n## 开发指导原则\r\n\r\n### 一、开发约束（什么能做，什么不能做）\r\n\r\n#### ✅ 应该做的\r\n\r\n1. **交互配置必须通过模板**\r\n   ```\r\n   ✅ 正确：\r\n   Unity Inspector → 配置interactionTemplateId → 系统自动初始化\r\n   \r\n   ❌ 错误：\r\n   手动添加组件、手动配置参数\r\n   ```\r\n\r\n2. **初始化策略必须注册**\r\n   ```\r\n   ✅ 正确：\r\n   实现 InterationInit[ComponentType] = function(component, param) end\r\n   \r\n   ❌ 错误：\r\n   直接操作组件，不通过初始化策略\r\n   ```\r\n\r\n3. **模板必须包含type和init**\r\n   ```\r\n   ✅ 正确：\r\n   EInteractionTypeTemplate[id] = {\r\n       type = {ComponentType1, ComponentType2},\r\n       init = function(comps) end\r\n   }\r\n   \r\n   ❌ 错误：\r\n   模板结构不完整\r\n   ```\r\n\r\n#### ❌ 不应该做的\r\n\r\n1. **禁止绕过模板系统**\r\n   - 不能手动添加和配置组件\r\n   - 必须通过模板系统统一管理\r\n\r\n2. **禁止硬编码组件类型**\r\n   - 组件类型必须在模板的type列表中定义\r\n   - 不能硬编码组件查找逻辑\r\n\r\n3. **禁止直接操作Unity组件**\r\n   - 必须通过初始化策略配置组件\r\n   - 不能直接修改组件属性\r\n\r\n### 二、开发流程（标准化开发步骤）\r\n\r\n#### 开发新交互类型的标准流程\r\n\r\n```\r\n1. 确定组件类型\r\n   ↓\r\n   需要哪些Unity组件？（PickableItem、KeyOperatedZone等）\r\n   \r\n2. 实现初始化策略\r\n   ↓\r\n   在InteractionInit中实现 InterationInit[ComponentType]\r\n   \r\n3. 注册模板\r\n   ↓\r\n   在EInteractionTypeTemplate中注册新模板\r\n   \r\n4. 配置参数（可选）\r\n   ↓\r\n   定义参数结构，提供默认值\r\n   \r\n5. 在Unity中使用\r\n   ↓\r\n   在ItemLifecycle中配置interactionTemplateId\r\n```\r\n\r\n---\r\n\r\n## 总结\r\n\r\n### 架构设计价值\r\n\r\n该架构设计文档的价值在于：\r\n- ✅ **思路解构**：完整解构交互系统的搭建思路\r\n- ✅ **流程验证**：从架构层面验证流程合理性\r\n- ✅ **模式分析**：分析模板方法、策略、外观模式的应用\r\n- ✅ **开发指导**：为后续详细设计和实现提供清晰指导\r\n\r\n### 设计原则\r\n\r\n- ✅ **模板化配置为核心**：一个模板ID即可完成完整配置\r\n- ✅ **数据驱动架构**：交互特性通过配置数据实现\r\n- ✅ **策略模式 + 外观模式**：实现灵活扩展和简单接口\r\n- ✅ **自动处理**：系统自动查找组件和执行初始化\r\n\r\n### 架构特点\r\n\r\n- ✅ **简单易用**：只需配置一个templateId，系统自动处理\r\n- ✅ **灵活扩展**：新增交互类型只需注册模板和实现策略\r\n- ✅ **统一管理**：所有交互类型通过统一的模板系统管理\r\n- ✅ **参数化配置**：同一个模板可以有不同的参数配置\r\n\r\n细节实现是后续开发阶段的工作，当前架构设计已足够指导整个交互系统的开发。\r\n"
        }
    ]
}