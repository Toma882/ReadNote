{
    "sourceFile": "è½¯ä»¶æ¶æ„è®¾è®¡/æ¶æ„æ¨¡å¼/äº‹ä»¶æº¯æºæ¶æ„æ¨¡å¼.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767096782691,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767096782691,
            "name": "Commit-0",
            "content": "# äº‹ä»¶æº¯æºæ¶æ„æ¨¡å¼ï¼ˆEvent Sourcing Architecture Patternï¼‰\r\n\r\n## ç›®å½•\r\n\r\n- [æ¦‚è¿°](#æ¦‚è¿°)\r\n- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)\r\n- [æ¶æ„ç»“æ„](#æ¶æ„ç»“æ„)\r\n- [è®¾è®¡è§„åˆ™](#è®¾è®¡è§„åˆ™)\r\n- [ä¼˜ç¼ºç‚¹åˆ†æ](#ä¼˜ç¼ºç‚¹åˆ†æ)\r\n- [å®è·µæŒ‡å—](#å®è·µæŒ‡å—)\r\n- [ä¸å…¶ä»–æ¶æ„æ¨¡å¼çš„å…³ç³»](#ä¸å…¶ä»–æ¶æ„æ¨¡å¼çš„å…³ç³»)\r\n- [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)\r\n- [å®é™…æ¡ˆä¾‹](#å®é™…æ¡ˆä¾‹)\r\n- [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)\r\n- [æ€»ç»“](#æ€»ç»“)\r\n\r\n---\r\n\r\n## æ¦‚è¿°\r\n\r\n**äº‹ä»¶æº¯æºæ¶æ„æ¨¡å¼ï¼ˆEvent Sourcing Architecture Patternï¼‰**æ˜¯ä¸€ç§å°†ç³»ç»ŸçŠ¶æ€å˜åŒ–å­˜å‚¨ä¸ºäº‹ä»¶åºåˆ—çš„æ¶æ„æ¨¡å¼ã€‚ç³»ç»Ÿä¸å­˜å‚¨å½“å‰çŠ¶æ€ï¼Œè€Œæ˜¯å­˜å‚¨æ‰€æœ‰å¯¼è‡´çŠ¶æ€å˜åŒ–çš„äº‹ä»¶ï¼Œé€šè¿‡é‡æ”¾äº‹ä»¶æ¥é‡å»ºå½“å‰çŠ¶æ€ã€‚\r\n\r\n### ä»€ä¹ˆæ˜¯äº‹ä»¶æº¯æºï¼Ÿ\r\n\r\näº‹ä»¶æº¯æºå°†çŠ¶æ€å˜åŒ–å­˜å‚¨ä¸ºä¸å¯å˜çš„äº‹ä»¶åºåˆ—ï¼š\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"ä¼ ç»Ÿæ–¹å¼\"\r\n        State1[çŠ¶æ€1<br/>State]\r\n        State2[çŠ¶æ€2<br/>State]\r\n        State3[çŠ¶æ€3<br/>State]\r\n        \r\n        State1 --> State2\r\n        State2 --> State3\r\n    end\r\n    \r\n    subgraph \"äº‹ä»¶æº¯æº\"\r\n        Event1[äº‹ä»¶1<br/>Event]\r\n        Event2[äº‹ä»¶2<br/>Event]\r\n        Event3[äº‹ä»¶3<br/>Event]\r\n        CurrentState[å½“å‰çŠ¶æ€<br/>Current State<br/>é€šè¿‡é‡æ”¾äº‹ä»¶é‡å»º]\r\n        \r\n        Event1 --> Event2\r\n        Event2 --> Event3\r\n        Event1 --> CurrentState\r\n        Event2 --> CurrentState\r\n        Event3 --> CurrentState\r\n    end\r\n    \r\n    style State3 fill:#ffcccb\r\n    style CurrentState fill:#90ee90\r\n    style Event1 fill:#ffebee\r\n    style Event2 fill:#ffebee\r\n    style Event3 fill:#ffebee\r\n```\r\n\r\n**æ ¸å¿ƒåŸåˆ™**ï¼š\r\n- **äº‹ä»¶å­˜å‚¨**ï¼šå­˜å‚¨æ‰€æœ‰çŠ¶æ€å˜åŒ–äº‹ä»¶\r\n- **ä¸å¯å˜äº‹ä»¶**ï¼šäº‹ä»¶ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹\r\n- **çŠ¶æ€é‡å»º**ï¼šé€šè¿‡é‡æ”¾äº‹ä»¶é‡å»ºå½“å‰çŠ¶æ€\r\n- **å®Œæ•´å†å²**ï¼šä¿ç•™å®Œæ•´çš„çŠ¶æ€å˜åŒ–å†å²\r\n\r\n### ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶æº¯æºï¼Ÿ\r\n\r\näº‹ä»¶æº¯æºè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š\r\n- **å®Œæ•´å®¡è®¡**ï¼šä¿ç•™æ‰€æœ‰çŠ¶æ€å˜åŒ–çš„å®Œæ•´å†å²\r\n- **æ—¶é—´æ—…è¡Œ**ï¼šå¯ä»¥é‡å»ºä»»æ„æ—¶é—´ç‚¹çš„çŠ¶æ€\r\n- **è°ƒè¯•èƒ½åŠ›**ï¼šå¯ä»¥é‡æ”¾äº‹ä»¶æ¥è°ƒè¯•é—®é¢˜\r\n- **ä¸šåŠ¡æ´å¯Ÿ**ï¼šé€šè¿‡åˆ†æäº‹ä»¶åºåˆ—è·å¾—ä¸šåŠ¡æ´å¯Ÿ\r\n- **æ•°æ®ä¸€è‡´æ€§**ï¼šé€šè¿‡äº‹ä»¶ä¿è¯æ•°æ®ä¸€è‡´æ€§\r\n\r\n---\r\n\r\n## æ ¸å¿ƒæ¦‚å¿µ\r\n\r\n### æ ¸å¿ƒæ€æƒ³\r\n\r\näº‹ä»¶æº¯æºçš„æ ¸å¿ƒæ€æƒ³æ˜¯**äº‹ä»¶å³çœŸç›¸ï¼ˆEvents as Truthï¼‰**ï¼š\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"äº‹ä»¶æº¯æºæ ¸å¿ƒæ€æƒ³\"\r\n        Event[äº‹ä»¶<br/>Event<br/>ä¸å¯å˜çš„äº‹å®]\r\n        EventStore[äº‹ä»¶å­˜å‚¨<br/>Event Store<br/>äº‹ä»¶åºåˆ—]\r\n        State[çŠ¶æ€<br/>State<br/>é€šè¿‡äº‹ä»¶é‡å»º]\r\n        \r\n        Event --> EventStore\r\n        EventStore --> State\r\n        State -.é€šè¿‡é‡æ”¾.-> EventStore\r\n    end\r\n    \r\n    style Event fill:#ffebee\r\n    style EventStore fill:#fff4e1\r\n    style State fill:#e1f5ff\r\n```\r\n\r\n**å…³é”®åŸåˆ™**ï¼š\r\n1. **äº‹ä»¶å­˜å‚¨**ï¼šæ‰€æœ‰çŠ¶æ€å˜åŒ–éƒ½å­˜å‚¨ä¸ºäº‹ä»¶\r\n2. **ä¸å¯å˜äº‹ä»¶**ï¼šäº‹ä»¶ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹\r\n3. **çŠ¶æ€é‡å»º**ï¼šé€šè¿‡é‡æ”¾äº‹ä»¶é‡å»ºçŠ¶æ€\r\n4. **å®Œæ•´å†å²**ï¼šä¿ç•™å®Œæ•´çš„çŠ¶æ€å˜åŒ–å†å²\r\n\r\n### åŸºæœ¬ç‰¹å¾\r\n\r\n- **äº‹ä»¶å­˜å‚¨**ï¼šå­˜å‚¨æ‰€æœ‰çŠ¶æ€å˜åŒ–äº‹ä»¶\r\n- **ä¸å¯å˜äº‹ä»¶**ï¼šäº‹ä»¶ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹\r\n- **çŠ¶æ€é‡å»º**ï¼šé€šè¿‡é‡æ”¾äº‹ä»¶é‡å»ºçŠ¶æ€\r\n- **å®Œæ•´å†å²**ï¼šä¿ç•™å®Œæ•´çš„çŠ¶æ€å˜åŒ–å†å²\r\n- **æ—¶é—´æ—…è¡Œ**ï¼šå¯ä»¥é‡å»ºä»»æ„æ—¶é—´ç‚¹çš„çŠ¶æ€\r\n\r\n---\r\n\r\n## æ¶æ„ç»“æ„\r\n\r\n### äº‹ä»¶æº¯æºå®Œæ•´æ¶æ„\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"å‘½ä»¤ç«¯\"\r\n        Command[å‘½ä»¤<br/>Command]\r\n        CommandHandler[å‘½ä»¤å¤„ç†å™¨<br/>Command Handler]\r\n        Aggregate[èšåˆ<br/>Aggregate]\r\n        Event[é¢†åŸŸäº‹ä»¶<br/>Domain Event]\r\n    end\r\n    \r\n    subgraph \"äº‹ä»¶å­˜å‚¨\"\r\n        EventStore[äº‹ä»¶å­˜å‚¨<br/>Event Store]\r\n        EventStream[äº‹ä»¶æµ<br/>Event Stream]\r\n    end\r\n    \r\n    subgraph \"æŸ¥è¯¢ç«¯\"\r\n        Projection[æŠ•å½±<br/>Projection]\r\n        ReadModel[è¯»æ¨¡å‹<br/>Read Model]\r\n        Query[æŸ¥è¯¢<br/>Query]\r\n    end\r\n    \r\n    subgraph \"é‡æ”¾æœºåˆ¶\"\r\n        Replay[äº‹ä»¶é‡æ”¾<br/>Event Replay]\r\n        Snapshot[å¿«ç…§<br/>Snapshot]\r\n        CurrentState[å½“å‰çŠ¶æ€<br/>Current State]\r\n    end\r\n    \r\n    Command --> CommandHandler\r\n    CommandHandler --> Aggregate\r\n    Aggregate --> Event\r\n    Event --> EventStore\r\n    EventStore --> EventStream\r\n    \r\n    EventStream --> Projection\r\n    Projection --> ReadModel\r\n    ReadModel --> Query\r\n    \r\n    EventStream --> Replay\r\n    Replay --> Snapshot\r\n    Snapshot --> CurrentState\r\n    Replay --> CurrentState\r\n    \r\n    style Event fill:#ffebee\r\n    style EventStore fill:#fff4e1\r\n    style Projection fill:#e1f5ff\r\n    style Replay fill:#c8e6c9\r\n```\r\n\r\n### æ ¸å¿ƒç»„ä»¶è¯¦è§£\r\n\r\n#### 1. äº‹ä»¶ï¼ˆEventï¼‰\r\n\r\n**å®šä¹‰**ï¼šè¡¨ç¤ºç³»ç»Ÿä¸­å‘ç”Ÿçš„é‡è¦äº‹æƒ…\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"äº‹ä»¶ç‰¹å¾\"\r\n        Immutable[ä¸å¯å˜<br/>Immutable]\r\n        Timestamp[æ—¶é—´æˆ³<br/>Timestamp]\r\n        Payload[äº‹ä»¶æ•°æ®<br/>Event Data]\r\n        Sequence[åºåˆ—å·<br/>Sequence Number]\r\n    end\r\n    \r\n    style Immutable fill:#ffebee\r\n```\r\n\r\n**ç‰¹ç‚¹**ï¼š\r\n- ä¸å¯å˜ï¼ˆä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹ï¼‰\r\n- æœ‰æ—¶é—´æˆ³\r\n- åŒ…å«äº‹ä»¶æ•°æ®\r\n- æœ‰åºåˆ—å·\r\n\r\n**ç¤ºä¾‹**ï¼š\r\n- OrderCreatedï¼ˆè®¢å•å·²åˆ›å»ºï¼‰\r\n- OrderItemAddedï¼ˆè®¢å•é¡¹å·²æ·»åŠ ï¼‰\r\n- OrderPaidï¼ˆè®¢å•å·²æ”¯ä»˜ï¼‰\r\n- OrderCancelledï¼ˆè®¢å•å·²å–æ¶ˆï¼‰\r\n\r\n#### 2. äº‹ä»¶å­˜å‚¨ï¼ˆEvent Storeï¼‰\r\n\r\n**å®šä¹‰**ï¼šå­˜å‚¨æ‰€æœ‰äº‹ä»¶çš„æŒä¹…åŒ–å­˜å‚¨\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"äº‹ä»¶å­˜å‚¨\"\r\n        Append[è¿½åŠ äº‹ä»¶<br/>Append Events]\r\n        Read[è¯»å–äº‹ä»¶<br/>Read Events]\r\n        Stream[äº‹ä»¶æµ<br/>Event Stream]\r\n        Version[ç‰ˆæœ¬æ§åˆ¶<br/>Version Control]\r\n    end\r\n    \r\n    style Append fill:#ffebee\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- è¿½åŠ æ–°äº‹ä»¶\r\n- è¯»å–äº‹ä»¶æµ\r\n- ç®¡ç†äº‹ä»¶ç‰ˆæœ¬\r\n- ä¿è¯äº‹ä»¶é¡ºåº\r\n\r\n**ç‰¹ç‚¹**ï¼š\r\n- åªè¿½åŠ ï¼ˆAppend-Onlyï¼‰\r\n- ä¸å¯ä¿®æ”¹\r\n- æœ‰åºå­˜å‚¨\r\n- æ”¯æŒç‰ˆæœ¬æ§åˆ¶\r\n\r\n#### 3. èšåˆï¼ˆAggregateï¼‰\r\n\r\n**å®šä¹‰**ï¼šé€šè¿‡äº‹ä»¶é‡å»ºçŠ¶æ€çš„é¢†åŸŸå¯¹è±¡\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"èšåˆ\"\r\n        Events[äº‹ä»¶åˆ—è¡¨<br/>Event List]\r\n        Apply[åº”ç”¨äº‹ä»¶<br/>Apply Events]\r\n        State[å½“å‰çŠ¶æ€<br/>Current State]\r\n        Rebuild[é‡å»ºçŠ¶æ€<br/>Rebuild State]\r\n    end\r\n    \r\n    Events --> Apply\r\n    Apply --> State\r\n    Events --> Rebuild\r\n    Rebuild --> State\r\n    \r\n    style Events fill:#ffebee\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- åº”ç”¨äº‹ä»¶æ”¹å˜çŠ¶æ€\r\n- é‡å»ºå½“å‰çŠ¶æ€\r\n- äº§ç”Ÿæ–°äº‹ä»¶\r\n- ç»´æŠ¤ä¸šåŠ¡ä¸å˜é‡\r\n\r\n#### 4. æŠ•å½±ï¼ˆProjectionï¼‰\r\n\r\n**å®šä¹‰**ï¼šå°†äº‹ä»¶æŠ•å½±åˆ°è¯»æ¨¡å‹\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"æŠ•å½±\"\r\n        Event1[äº‹ä»¶1<br/>Event]\r\n        Event2[äº‹ä»¶2<br/>Event]\r\n        ProjectionLogic[æŠ•å½±é€»è¾‘<br/>Projection Logic]\r\n        ReadModel[è¯»æ¨¡å‹<br/>Read Model]\r\n        \r\n        Event1 --> ProjectionLogic\r\n        Event2 --> ProjectionLogic\r\n        ProjectionLogic --> ReadModel\r\n    end\r\n    \r\n    style ProjectionLogic fill:#fff4e1\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- ç›‘å¬äº‹ä»¶\r\n- æ›´æ–°è¯»æ¨¡å‹\r\n- å¤„ç†äº‹ä»¶é‡æ”¾\r\n- æ”¯æŒå¤šä¸ªè¯»æ¨¡å‹\r\n\r\n#### 5. äº‹ä»¶é‡æ”¾ï¼ˆEvent Replayï¼‰\r\n\r\n**å®šä¹‰**ï¼šé€šè¿‡é‡æ”¾äº‹ä»¶é‡å»ºçŠ¶æ€\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"äº‹ä»¶é‡æ”¾\"\r\n        EventStore[äº‹ä»¶å­˜å‚¨<br/>Event Store]\r\n        Replay[é‡æ”¾<br/>Replay]\r\n        State[çŠ¶æ€<br/>State]\r\n        \r\n        EventStore --> Replay\r\n        Replay --> State\r\n    end\r\n    \r\n    style Replay fill:#c8e6c9\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- ä»äº‹ä»¶å­˜å‚¨è¯»å–äº‹ä»¶\r\n- æŒ‰é¡ºåºé‡æ”¾äº‹ä»¶\r\n- é‡å»ºå½“å‰çŠ¶æ€\r\n- æ”¯æŒæ—¶é—´ç‚¹é‡å»º\r\n\r\n#### 6. å¿«ç…§ï¼ˆSnapshotï¼‰\r\n\r\n**å®šä¹‰**ï¼šçŠ¶æ€çš„å¿«ç…§ï¼Œç”¨äºä¼˜åŒ–é‡æ”¾æ€§èƒ½\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"å¿«ç…§æœºåˆ¶\"\r\n        Events[äº‹ä»¶åºåˆ—<br/>Event Sequence]\r\n        Snapshot[å¿«ç…§<br/>Snapshot<br/>çŠ¶æ€å¿«ç…§]\r\n        Replay[é‡æ”¾å‰©ä½™äº‹ä»¶<br/>Replay Remaining Events]\r\n        CurrentState[å½“å‰çŠ¶æ€<br/>Current State]\r\n        \r\n        Events --> Snapshot\r\n        Snapshot --> Replay\r\n        Replay --> CurrentState\r\n    end\r\n    \r\n    style Snapshot fill:#fff4e1\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- å®šæœŸåˆ›å»ºçŠ¶æ€å¿«ç…§\r\n- ä¼˜åŒ–é‡æ”¾æ€§èƒ½\r\n- å‡å°‘é‡æ”¾äº‹ä»¶æ•°é‡\r\n- æ”¯æŒå¿«é€Ÿæ¢å¤\r\n\r\n---\r\n\r\n## è®¾è®¡è§„åˆ™\r\n\r\n### äº‹ä»¶è®¾è®¡è§„åˆ™\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"äº‹ä»¶è®¾è®¡è§„åˆ™\"\r\n        Rule1[äº‹ä»¶ä¸å¯å˜<br/>Events Are Immutable]\r\n        Rule2[äº‹ä»¶æœ‰åº<br/>Events Are Ordered]\r\n        Rule3[äº‹ä»¶å®Œæ•´<br/>Events Are Complete]\r\n        Rule4[äº‹ä»¶è¯­ä¹‰åŒ–<br/>Events Are Semantic]\r\n    end\r\n    \r\n    style Rule1 fill:#ffebee\r\n```\r\n\r\n**è§„åˆ™è¯´æ˜**ï¼š\r\n- âœ… **äº‹ä»¶ä¸å¯å˜**ï¼šäº‹ä»¶ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹\r\n- âœ… **äº‹ä»¶æœ‰åº**ï¼šäº‹ä»¶æŒ‰æ—¶é—´é¡ºåºå­˜å‚¨\r\n- âœ… **äº‹ä»¶å®Œæ•´**ï¼šäº‹ä»¶åŒ…å«é‡å»ºçŠ¶æ€æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯\r\n- âœ… **äº‹ä»¶è¯­ä¹‰åŒ–**ï¼šäº‹ä»¶åç§°æ¸…æ™°è¡¨è¾¾ä¸šåŠ¡å«ä¹‰\r\n\r\n### çŠ¶æ€é‡å»ºè§„åˆ™\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"çŠ¶æ€é‡å»ºè§„åˆ™\"\r\n        Start[èµ·å§‹çŠ¶æ€<br/>Initial State]\r\n        Events[äº‹ä»¶åºåˆ—<br/>Event Sequence]\r\n        Apply[åº”ç”¨äº‹ä»¶<br/>Apply Events]\r\n        Current[å½“å‰çŠ¶æ€<br/>Current State]\r\n        \r\n        Start --> Events\r\n        Events --> Apply\r\n        Apply --> Current\r\n    end\r\n    \r\n    style Apply fill:#ffebee\r\n```\r\n\r\n**è§„åˆ™è¯´æ˜**ï¼š\r\n- âœ… **èµ·å§‹çŠ¶æ€**ï¼šä»åˆå§‹çŠ¶æ€å¼€å§‹\r\n- âœ… **é¡ºåºåº”ç”¨**ï¼šæŒ‰é¡ºåºåº”ç”¨æ‰€æœ‰äº‹ä»¶\r\n- âœ… **å¹‚ç­‰æ€§**ï¼šé‡æ”¾åº”è¯¥æ˜¯å¹‚ç­‰çš„\r\n- âœ… **å®Œæ•´æ€§**ï¼šæ‰€æœ‰äº‹ä»¶éƒ½å¿…é¡»åº”ç”¨\r\n\r\n---\r\n\r\n## ä¼˜ç¼ºç‚¹åˆ†æ\r\n\r\n### ä¼˜ç‚¹\r\n\r\n```mermaid\r\nmindmap\r\n  root((äº‹ä»¶æº¯æºä¼˜ç‚¹))\r\n    å®Œæ•´å®¡è®¡\r\n      å®Œæ•´å†å²è®°å½•\r\n      ä¸å¯ç¯¡æ”¹\r\n      å¯è¿½æº¯\r\n    æ—¶é—´æ—…è¡Œ\r\n      é‡å»ºä»»æ„æ—¶é—´ç‚¹\r\n      çŠ¶æ€å›æ»š\r\n      å†å²åˆ†æ\r\n    è°ƒè¯•èƒ½åŠ›\r\n      é‡æ”¾äº‹ä»¶\r\n      é—®é¢˜å®šä½\r\n      çŠ¶æ€é‡å»º\r\n    ä¸šåŠ¡æ´å¯Ÿ\r\n      äº‹ä»¶åˆ†æ\r\n      æ¨¡å¼è¯†åˆ«\r\n      ä¸šåŠ¡ä¼˜åŒ–\r\n    æ•°æ®ä¸€è‡´æ€§\r\n      äº‹ä»¶ä¿è¯ä¸€è‡´æ€§\r\n      é¿å…æ•°æ®ä¸¢å¤±\r\n      å¯é å­˜å‚¨\r\n```\r\n\r\n**è¯¦ç»†è¯´æ˜**ï¼š\r\n- âœ… **å®Œæ•´å®¡è®¡**ï¼šä¿ç•™æ‰€æœ‰çŠ¶æ€å˜åŒ–çš„å®Œæ•´å†å²\r\n- âœ… **æ—¶é—´æ—…è¡Œ**ï¼šå¯ä»¥é‡å»ºä»»æ„æ—¶é—´ç‚¹çš„çŠ¶æ€\r\n- âœ… **è°ƒè¯•èƒ½åŠ›**ï¼šå¯ä»¥é‡æ”¾äº‹ä»¶æ¥è°ƒè¯•é—®é¢˜\r\n- âœ… **ä¸šåŠ¡æ´å¯Ÿ**ï¼šé€šè¿‡åˆ†æäº‹ä»¶åºåˆ—è·å¾—ä¸šåŠ¡æ´å¯Ÿ\r\n- âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šé€šè¿‡äº‹ä»¶ä¿è¯æ•°æ®ä¸€è‡´æ€§\r\n\r\n### ç¼ºç‚¹\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"äº‹ä»¶æº¯æºç¼ºç‚¹\"\r\n        Complexity[å¤æ‚åº¦é«˜<br/>éœ€è¦ç†è§£äº‹ä»¶æº¯æº]\r\n        Performance[æ€§èƒ½é—®é¢˜<br/>é‡æ”¾å¯èƒ½æ…¢]\r\n        Storage[å­˜å‚¨å¼€é”€<br/>äº‹ä»¶å¯èƒ½å¾ˆå¤š]\r\n        Learning[å­¦ä¹ æ›²çº¿é™¡å³­<br/>éœ€è¦æŒæ¡æ¦‚å¿µ]\r\n    end\r\n    \r\n    style Complexity fill:#ffcccb\r\n    style Performance fill:#ffcccb\r\n```\r\n\r\n**è¯¦ç»†è¯´æ˜**ï¼š\r\n- âŒ **å¤æ‚åº¦é«˜**ï¼šéœ€è¦ç†è§£äº‹ä»¶æº¯æºæ¦‚å¿µ\r\n- âŒ **æ€§èƒ½é—®é¢˜**ï¼šé‡æ”¾å¤§é‡äº‹ä»¶å¯èƒ½å¾ˆæ…¢\r\n- âŒ **å­˜å‚¨å¼€é”€**ï¼šäº‹ä»¶å¯èƒ½å¾ˆå¤šï¼Œå­˜å‚¨å¼€é”€å¤§\r\n- âŒ **å­¦ä¹ æ›²çº¿é™¡å³­**ï¼šéœ€è¦æŒæ¡äº‹ä»¶æº¯æºæ¦‚å¿µ\r\n- âŒ **æŸ¥è¯¢å¤æ‚**ï¼šæŸ¥è¯¢éœ€è¦é‡å»ºçŠ¶æ€æˆ–ä½¿ç”¨æŠ•å½±\r\n\r\n---\r\n\r\n## å®è·µæŒ‡å—\r\n\r\n### äº‹ä»¶æº¯æºå®æ–½æ­¥éª¤\r\n\r\n```mermaid\r\ngraph TD\r\n    Start[å¼€å§‹äº‹ä»¶æº¯æº] --> Step1[1. è¯†åˆ«é¢†åŸŸäº‹ä»¶<br/>Identify Domain Events]\r\n    Step1 --> Step2[2. è®¾è®¡äº‹ä»¶ç»“æ„<br/>Design Event Structure]\r\n    Step2 --> Step3[3. å®ç°äº‹ä»¶å­˜å‚¨<br/>Implement Event Store]\r\n    Step3 --> Step4[4. å®ç°èšåˆé‡å»º<br/>Implement Aggregate Rebuild]\r\n    Step4 --> Step5[5. å®ç°æŠ•å½±<br/>Implement Projections]\r\n    Step5 --> Step6[6. ä¼˜åŒ–æ€§èƒ½<br/>Optimize Performance]\r\n    Step6 --> End[å®Œæˆ]\r\n    \r\n    style Step1 fill:#ffebee\r\n    style Step2 fill:#fff4e1\r\n    style Step3 fill:#e1f5ff\r\n```\r\n\r\n### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"æ€§èƒ½ä¼˜åŒ–\"\r\n        Snapshot[å¿«ç…§æœºåˆ¶<br/>Snapshot Mechanism]\r\n        Projection[æŠ•å½±ä¼˜åŒ–<br/>Projection Optimization]\r\n        Caching[ç¼“å­˜ç­–ç•¥<br/>Caching Strategy]\r\n        Batch[æ‰¹é‡å¤„ç†<br/>Batch Processing]\r\n    end\r\n    \r\n    style Snapshot fill:#ffebee\r\n```\r\n\r\n**ä¼˜åŒ–å»ºè®®**ï¼š\r\n- âœ… **å¿«ç…§æœºåˆ¶**ï¼šå®šæœŸåˆ›å»ºå¿«ç…§ï¼Œå‡å°‘é‡æ”¾äº‹ä»¶\r\n- âœ… **æŠ•å½±ä¼˜åŒ–**ï¼šä¼˜åŒ–æŠ•å½±é€»è¾‘ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½\r\n- âœ… **ç¼“å­˜ç­–ç•¥**ï¼šç¼“å­˜å¸¸ç”¨çŠ¶æ€ï¼Œå‡å°‘é‡æ”¾\r\n- âœ… **æ‰¹é‡å¤„ç†**ï¼šæ‰¹é‡å¤„ç†äº‹ä»¶ï¼Œæé«˜æ€§èƒ½\r\n\r\n---\r\n\r\n## ä¸å…¶ä»–æ¶æ„æ¨¡å¼çš„å…³ç³»\r\n\r\n### äº‹ä»¶æº¯æºä¸å…¶ä»–æ¶æ„çš„å…³ç³»\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"æ¶æ„å…³ç³»\"\r\n        ES[äº‹ä»¶æº¯æº]\r\n        CQRS[CQRS]\r\n        DDD[é¢†åŸŸé©±åŠ¨è®¾è®¡]\r\n        EventDriven[äº‹ä»¶é©±åŠ¨]\r\n        \r\n        ES --> CQRS\r\n        ES --> DDD\r\n        ES --> EventDriven\r\n        \r\n        CQRS -.å¸¸ç»“åˆ.-> ES\r\n        DDD -.å¸¸ç»“åˆ.-> ES\r\n    end\r\n    \r\n    style ES fill:#ffebee\r\n```\r\n\r\n**å…³ç³»è¯´æ˜**ï¼š\r\n- **CQRS**ï¼šäº‹ä»¶æº¯æºå¸¸ä¸CQRSç»“åˆä½¿ç”¨\r\n- **é¢†åŸŸé©±åŠ¨è®¾è®¡**ï¼šäº‹ä»¶æº¯æºæ˜¯DDDçš„å®ç°æ–¹å¼ä¹‹ä¸€\r\n- **äº‹ä»¶é©±åŠ¨**ï¼šäº‹ä»¶æº¯æºæ˜¯äº‹ä»¶é©±åŠ¨çš„æè‡´å®ç°\r\n\r\n---\r\n\r\n## åº”ç”¨åœºæ™¯\r\n\r\n### é€‚ç”¨åœºæ™¯\r\n\r\n```mermaid\r\nmindmap\r\n  root((äº‹ä»¶æº¯æºé€‚ç”¨åœºæ™¯))\r\n    å®¡è®¡è¦æ±‚é«˜\r\n      é‡‘èç³»ç»Ÿ\r\n      åŒ»ç–—ç³»ç»Ÿ\r\n      æ³•å¾‹ç³»ç»Ÿ\r\n    æ—¶é—´æ—…è¡Œéœ€æ±‚\r\n      çŠ¶æ€å›æ»š\r\n      å†å²åˆ†æ\r\n      è°ƒè¯•éœ€æ±‚\r\n    å¤æ‚ä¸šåŠ¡é€»è¾‘\r\n      å·¥ä½œæµç³»ç»Ÿ\r\n      çŠ¶æ€æœºç³»ç»Ÿ\r\n      å®¡æ‰¹ç³»ç»Ÿ\r\n    ä¸šåŠ¡æ´å¯Ÿéœ€æ±‚\r\n      æ•°æ®åˆ†æ\r\n      æ¨¡å¼è¯†åˆ«\r\n      ä¸šåŠ¡ä¼˜åŒ–\r\n```\r\n\r\n**å…·ä½“åœºæ™¯**ï¼š\r\n- âœ… **é‡‘èç³»ç»Ÿ**ï¼šéœ€è¦å®Œæ•´å®¡è®¡ï¼Œæ—¶é—´æ—…è¡Œ\r\n- âœ… **åŒ»ç–—ç³»ç»Ÿ**ï¼šéœ€è¦å®Œæ•´å†å²ï¼Œä¸å¯ç¯¡æ”¹\r\n- âœ… **å·¥ä½œæµç³»ç»Ÿ**ï¼šéœ€è¦çŠ¶æ€å›æ»šï¼Œå†å²åˆ†æ\r\n- âœ… **ç”µå•†ç³»ç»Ÿ**ï¼šéœ€è¦å®Œæ•´è®¢å•å†å²ï¼Œä¸šåŠ¡åˆ†æ\r\n\r\n### ä¸é€‚ç”¨åœºæ™¯\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"ä¸é€‚ç”¨åœºæ™¯\"\r\n        Simple[ç®€å•ç³»ç»Ÿ<br/>ä¸éœ€è¦å®Œæ•´å†å²]\r\n        LowAudit[ä½å®¡è®¡è¦æ±‚<br/>ä¸éœ€è¦å®¡è®¡]\r\n        HighPerformance[é«˜æ€§èƒ½è¦æ±‚<br/>é‡æ”¾æ€§èƒ½å·®]\r\n        SimpleState[ç®€å•çŠ¶æ€<br/>çŠ¶æ€ç®€å•]\r\n    end\r\n    \r\n    style Simple fill:#ffcccb\r\n```\r\n\r\n**ä¸é€‚ç”¨åœºæ™¯**ï¼š\r\n- âŒ **ç®€å•ç³»ç»Ÿ**ï¼šä¸éœ€è¦å®Œæ•´å†å²\r\n- âŒ **ä½å®¡è®¡è¦æ±‚**ï¼šä¸éœ€è¦å®¡è®¡åŠŸèƒ½\r\n- âŒ **é«˜æ€§èƒ½è¦æ±‚**ï¼šé‡æ”¾æ€§èƒ½å¯èƒ½ä¸æ»¡è¶³\r\n- âŒ **ç®€å•çŠ¶æ€**ï¼šçŠ¶æ€ç®€å•ï¼Œä¸éœ€è¦äº‹ä»¶æº¯æº\r\n\r\n---\r\n\r\n## å®é™…æ¡ˆä¾‹\r\n\r\n### æ¡ˆä¾‹1ï¼šç”µå•†è®¢å•ç³»ç»Ÿ\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"è®¢å•äº‹ä»¶\"\r\n        OrderCreated[è®¢å•å·²åˆ›å»º<br/>OrderCreated]\r\n        ItemAdded[å•†å“å·²æ·»åŠ <br/>ItemAdded]\r\n        ItemRemoved[å•†å“å·²ç§»é™¤<br/>ItemRemoved]\r\n        OrderPaid[è®¢å•å·²æ”¯ä»˜<br/>OrderPaid]\r\n        OrderCancelled[è®¢å•å·²å–æ¶ˆ<br/>OrderCancelled]\r\n    end\r\n    \r\n    subgraph \"äº‹ä»¶å­˜å‚¨\"\r\n        EventStore[äº‹ä»¶å­˜å‚¨<br/>Event Store]\r\n        EventStream[äº‹ä»¶æµ<br/>Event Stream]\r\n    end\r\n    \r\n    subgraph \"è®¢å•èšåˆ\"\r\n        OrderAggregate[è®¢å•èšåˆ<br/>Order Aggregate]\r\n        Rebuild[é‡å»ºçŠ¶æ€<br/>Rebuild State]\r\n        CurrentState[å½“å‰çŠ¶æ€<br/>Current State]\r\n    end\r\n    \r\n    OrderCreated --> EventStore\r\n    ItemAdded --> EventStore\r\n    ItemRemoved --> EventStore\r\n    OrderPaid --> EventStore\r\n    OrderCancelled --> EventStore\r\n    \r\n    EventStore --> EventStream\r\n    EventStream --> Rebuild\r\n    Rebuild --> OrderAggregate\r\n    OrderAggregate --> CurrentState\r\n    \r\n    style OrderCreated fill:#ffebee\r\n    style EventStore fill:#fff4e1\r\n    style OrderAggregate fill:#e1f5ff\r\n```\r\n\r\n### æ¡ˆä¾‹2ï¼šæ¸¸æˆæˆ˜æ–—ç³»ç»Ÿ\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"æˆ˜æ–—äº‹ä»¶\"\r\n        BattleStarted[æˆ˜æ–—å·²å¼€å§‹<br/>BattleStarted]\r\n        UnitActionExecuted[å•ä½è¡ŒåŠ¨å·²æ‰§è¡Œ<br/>UnitActionExecuted]\r\n        DamageDealt[ä¼¤å®³å·²é€ æˆ<br/>DamageDealt]\r\n        UnitDied[å•ä½å·²æ­»äº¡<br/>UnitDied]\r\n        BattleEnded[æˆ˜æ–—å·²ç»“æŸ<br/>BattleEnded]\r\n    end\r\n    \r\n    subgraph \"äº‹ä»¶å­˜å‚¨\"\r\n        EventStore[äº‹ä»¶å­˜å‚¨<br/>Event Store]\r\n        EventStream[äº‹ä»¶æµ<br/>Event Stream]\r\n    end\r\n    \r\n    subgraph \"æˆ˜æ–—èšåˆ\"\r\n        BattleAggregate[æˆ˜æ–—èšåˆ<br/>Battle Aggregate]\r\n        Rebuild[é‡å»ºçŠ¶æ€<br/>Rebuild State]\r\n        CurrentState[å½“å‰çŠ¶æ€<br/>Current State]\r\n    end\r\n    \r\n    BattleStarted --> EventStore\r\n    UnitActionExecuted --> EventStore\r\n    DamageDealt --> EventStore\r\n    UnitDied --> EventStore\r\n    BattleEnded --> EventStore\r\n    \r\n    EventStore --> EventStream\r\n    EventStream --> Rebuild\r\n    Rebuild --> BattleAggregate\r\n    BattleAggregate --> CurrentState\r\n    \r\n    style BattleStarted fill:#ffebee\r\n    style EventStore fill:#fff4e1\r\n    style BattleAggregate fill:#e1f5ff\r\n```\r\n\r\n---\r\n\r\n## è®¾è®¡åŸåˆ™\r\n\r\n### äº‹ä»¶æº¯æºè®¾è®¡åŸåˆ™\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"äº‹ä»¶æº¯æºè®¾è®¡åŸåˆ™\"\r\n        Principle1[äº‹ä»¶ä¸å¯å˜<br/>Events Are Immutable]\r\n        Principle2[äº‹ä»¶æœ‰åº<br/>Events Are Ordered]\r\n        Principle3[çŠ¶æ€é‡å»º<br/>State Reconstruction]\r\n        Principle4[å®Œæ•´å†å²<br/>Complete History]\r\n        Principle5[æ€§èƒ½ä¼˜åŒ–<br/>Performance Optimization]\r\n    end\r\n    \r\n    style Principle1 fill:#ffebee\r\n```\r\n\r\n**æ ¸å¿ƒåŸåˆ™**ï¼š\r\n- **äº‹ä»¶ä¸å¯å˜**ï¼šäº‹ä»¶ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹\r\n- **äº‹ä»¶æœ‰åº**ï¼šäº‹ä»¶æŒ‰æ—¶é—´é¡ºåºå­˜å‚¨\r\n- **çŠ¶æ€é‡å»º**ï¼šé€šè¿‡é‡æ”¾äº‹ä»¶é‡å»ºçŠ¶æ€\r\n- **å®Œæ•´å†å²**ï¼šä¿ç•™å®Œæ•´çš„çŠ¶æ€å˜åŒ–å†å²\r\n- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡å¿«ç…§ç­‰æœºåˆ¶ä¼˜åŒ–æ€§èƒ½\r\n\r\n---\r\n\r\n## æ€»ç»“\r\n\r\näº‹ä»¶æº¯æºæ¶æ„æ¨¡å¼é€šè¿‡å°†çŠ¶æ€å˜åŒ–å­˜å‚¨ä¸ºä¸å¯å˜çš„äº‹ä»¶åºåˆ—ï¼Œä¿ç•™å®Œæ•´çš„å†å²è®°å½•ï¼Œæ”¯æŒæ—¶é—´æ—…è¡Œå’Œå®Œæ•´å®¡è®¡ã€‚\r\n\r\n**æ ¸å¿ƒä»·å€¼**ï¼š\r\n- ğŸ“œ **å®Œæ•´å®¡è®¡**ï¼šä¿ç•™æ‰€æœ‰çŠ¶æ€å˜åŒ–çš„å®Œæ•´å†å²\r\n- â° **æ—¶é—´æ—…è¡Œ**ï¼šå¯ä»¥é‡å»ºä»»æ„æ—¶é—´ç‚¹çš„çŠ¶æ€\r\n- ğŸ› **è°ƒè¯•èƒ½åŠ›**ï¼šå¯ä»¥é‡æ”¾äº‹ä»¶æ¥è°ƒè¯•é—®é¢˜\r\n- ğŸ’¡ **ä¸šåŠ¡æ´å¯Ÿ**ï¼šé€šè¿‡åˆ†æäº‹ä»¶åºåˆ—è·å¾—ä¸šåŠ¡æ´å¯Ÿ\r\n- ğŸ”’ **æ•°æ®ä¸€è‡´æ€§**ï¼šé€šè¿‡äº‹ä»¶ä¿è¯æ•°æ®ä¸€è‡´æ€§\r\n\r\n**é€‚ç”¨åœºæ™¯**ï¼š\r\n- âœ… å®¡è®¡è¦æ±‚é«˜\r\n- âœ… æ—¶é—´æ—…è¡Œéœ€æ±‚\r\n- âœ… å¤æ‚ä¸šåŠ¡é€»è¾‘\r\n- âœ… ä¸šåŠ¡æ´å¯Ÿéœ€æ±‚\r\n\r\n**æ³¨æ„äº‹é¡¹**ï¼š\r\n- âš ï¸ å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦ç†è§£äº‹ä»¶æº¯æºæ¦‚å¿µ\r\n- âš ï¸ æ€§èƒ½é—®é¢˜ï¼Œé‡æ”¾å¤§é‡äº‹ä»¶å¯èƒ½å¾ˆæ…¢\r\n- âš ï¸ å­˜å‚¨å¼€é”€ï¼Œäº‹ä»¶å¯èƒ½å¾ˆå¤š\r\n- âš ï¸ æŸ¥è¯¢å¤æ‚ï¼Œéœ€è¦é‡å»ºçŠ¶æ€æˆ–ä½¿ç”¨æŠ•å½±\r\n\r\näº‹ä»¶æº¯æºæ˜¯æ„å»ºå¯å®¡è®¡ã€å¯è¿½æº¯ã€å¯åˆ†æç³»ç»Ÿçš„ä¼˜ç§€æ¶æ„æ¨¡å¼ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦å®Œæ•´å†å²è®°å½•å’Œå®¡è®¡åŠŸèƒ½çš„ç³»ç»Ÿã€‚\r\n\r\n"
        }
    ]
}