{
    "sourceFile": "æ¨¡å—æ¶æ„è®¾è®¡/å‰§æƒ…æ¼”å‡ºæ¶æ„è®¾è®¡.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 41,
            "patches": [
                {
                    "date": 1767379748424,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767379794474,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,45 +55,10 @@\n     style StateLayer fill:#f3e5f5\r\n     style PresentationLayer fill:#ffebee\r\n ```\r\n \r\n----\r\n \r\n-## ğŸ“Š æ•°æ®æµå›¾\r\n \r\n-```mermaid\r\n-sequenceDiagram\r\n-    participant Config as é…ç½®æ•°æ®\r\n-    participant Parser as è„šæœ¬è§£æå™¨\r\n-    participant Executor as å‰§æƒ…æ‰§è¡Œå™¨\r\n-    participant State as çŠ¶æ€ç®¡ç†\r\n-    participant Presenter as è¡¨ç°å±‚\r\n-    \r\n-    Config->>Parser: åŠ è½½å‰§æƒ…é…ç½®\r\n-    Parser->>Parser: è§£æèŠ‚ç‚¹å›¾\r\n-    Parser->>Executor: åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡\r\n-    \r\n-    Executor->>State: æŸ¥è¯¢å½“å‰çŠ¶æ€\r\n-    State->>Executor: è¿”å›å½“å‰èŠ‚ç‚¹\r\n-    \r\n-    Executor->>Executor: æ‰§è¡Œå½“å‰èŠ‚ç‚¹\r\n-    Executor->>Presenter: è¯·æ±‚è¡¨ç°ï¼ˆTimeline/UI/Audioï¼‰\r\n-    \r\n-    Presenter->>Presenter: æ’­æ”¾è¡¨ç°\r\n-    Presenter->>Executor: è¡¨ç°å®Œæˆå›è°ƒ\r\n-    \r\n-    Executor->>State: æ›´æ–°çŠ¶æ€ï¼ˆèŠ‚ç‚¹å®Œæˆï¼‰\r\n-    Executor->>Executor: é€‰æ‹©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\r\n-    \r\n-    alt åˆ†æ”¯èŠ‚ç‚¹\r\n-        Executor->>Presenter: æ˜¾ç¤ºåˆ†æ”¯é€‰æ‹©UI\r\n-        Presenter->>Executor: è¿”å›ç©å®¶é€‰æ‹©\r\n-        Executor->>Executor: æ ¹æ®é€‰æ‹©è·³è½¬èŠ‚ç‚¹\r\n-    end\r\n-    \r\n-    Executor->>State: ä¿å­˜è¿›åº¦\r\n-```\r\n-\r\n ---\r\n \r\n ## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n \r\n"
                },
                {
                    "date": 1767379847642,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,10 +55,8 @@\n     style StateLayer fill:#f3e5f5\r\n     style PresentationLayer fill:#ffebee\r\n ```\r\n \r\n-\r\n-\r\n ---\r\n \r\n ## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n \r\n"
                },
                {
                    "date": 1767379918506,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,52 +9,57 @@\n ## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n \r\n ```mermaid\r\n graph TB\r\n-    subgraph DataLayer[\"æ•°æ®å±‚<br/>DataLayer<br/>é™æ€é…ç½®æ•°æ®\"]\r\n-        StoryConfig[\"StoryConfig<br/>å‰§æƒ…é…ç½®<br/>id/name/entryNodeId\"]\r\n-        NodeConfig[\"NodeConfig<br/>èŠ‚ç‚¹é…ç½®<br/>nodeId/type/params/connections\"]\r\n-        DialogueConfig[\"DialogueConfig<br/>å¯¹è¯é…ç½®<br/>å¤ç”¨ç°æœ‰CfgDialogue\"]\r\n-        ResourceConfig[\"ResourceConfig<br/>èµ„æºé…ç½®<br/>timeline/audio/animation\"]\r\n+    subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n+        direction LR\r\n+        StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n+        NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n+        DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n+        ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n     end\r\n     \r\n-    subgraph ScriptLayer[\"è„šæœ¬å±‚<br/>ScriptLayer<br/>å‰§æƒ…è„šæœ¬è§£æ\"]\r\n-        StoryParser[\"StoryParser<br/>å‰§æƒ…è§£æå™¨\"]\r\n-        NodeGraph[\"NodeGraph<br/>èŠ‚ç‚¹å›¾ç®¡ç†<br/>èŠ‚ç‚¹è¿æ¥å…³ç³»\"]\r\n-        ScriptValidator[\"ScriptValidator<br/>è„šæœ¬éªŒè¯å™¨\"]\r\n+    subgraph ScriptLayer[\"è„šæœ¬å±‚ | ScriptLayer\"]\r\n+        direction LR\r\n+        StoryParser[\"å‰§æƒ…è§£æå™¨<br/>StoryParser\"]\r\n+        NodeGraph[\"èŠ‚ç‚¹å›¾ç®¡ç†<br/>NodeGraph\"]\r\n+        ScriptValidator[\"è„šæœ¬éªŒè¯å™¨<br/>ScriptValidator\"]\r\n     end\r\n     \r\n-    subgraph ExecutionLayer[\"æ‰§è¡Œå±‚<br/>ExecutionLayer<br/>å‰§æƒ…æ‰§è¡Œå™¨\"]\r\n-        StoryExecutor[\"StoryExecutor<br/>å‰§æƒ…æ‰§è¡Œå™¨<br/>ç®¡ç†å½“å‰èŠ‚ç‚¹\"]\r\n-        NodeExecutor[\"NodeExecutor<br/>èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>æ‰§è¡Œå…·ä½“èŠ‚ç‚¹\"]\r\n-        BranchSelector[\"BranchSelector<br/>åˆ†æ”¯é€‰æ‹©å™¨<br/>å¤„ç†åˆ†æ”¯é€»è¾‘\"]\r\n+    subgraph ExecutionLayer[\"æ‰§è¡Œå±‚ | ExecutionLayer\"]\r\n+        direction LR\r\n+        StoryExecutor[\"å‰§æƒ…æ‰§è¡Œå™¨<br/>StoryExecutor\"]\r\n+        NodeExecutor[\"èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>NodeExecutor\"]\r\n+        BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n     end\r\n     \r\n-    subgraph StateLayer[\"çŠ¶æ€å±‚<br/>StateLayer<br/>å‰§æƒ…çŠ¶æ€ç®¡ç†\"]\r\n-        StoryState[\"StoryState<br/>å‰§æƒ…çŠ¶æ€<br/>currentNode/progress\"]\r\n-        StoryVariable[\"StoryVariable<br/>å‰§æƒ…å˜é‡<br/>å…¨å±€/å±€éƒ¨å˜é‡\"]\r\n-        StatePersistence[\"StatePersistence<br/>çŠ¶æ€æŒä¹…åŒ–<br/>ä¿å­˜/æ¢å¤\"]\r\n+    subgraph StateLayer[\"çŠ¶æ€å±‚ | StateLayer\"]\r\n+        direction LR\r\n+        StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n+        StoryVariable[\"å‰§æƒ…å˜é‡<br/>StoryVariable\"]\r\n+        StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n     end\r\n     \r\n-    subgraph PresentationLayer[\"è¡¨ç°å±‚<br/>PresentationLayer<br/>ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’\"]\r\n-        TimelinePlayer[\"TimelinePlayer<br/>Timelineæ’­æ”¾å™¨\"]\r\n-        UIPresenter[\"UIPresenter<br/>UIè¡¨ç°å™¨<br/>å¯¹è¯UI/é€‰æ‹©UI\"]\r\n-        AudioPlayer[\"AudioPlayer<br/>éŸ³é¢‘æ’­æ”¾å™¨\"]\r\n-        VisualPlayer[\"VisualPlayer<br/>è§†è§‰è¡¨ç°å™¨<br/>åŠ¨ç”»/ç‰¹æ•ˆ\"]\r\n+    subgraph PresentationLayer[\"è¡¨ç°å±‚ | PresentationLayer\"]\r\n+        direction LR\r\n+        TimelinePlayer[\"Timelineæ’­æ”¾å™¨\"]\r\n+        UIPresenter[\"UIè¡¨ç°å™¨\"]\r\n+        AudioPlayer[\"éŸ³é¢‘æ’­æ”¾å™¨\"]\r\n+        VisualPlayer[\"è§†è§‰è¡¨ç°å™¨\"]\r\n     end\r\n     \r\n-    DataLayer -->|é…ç½®åŠ è½½| ScriptLayer\r\n-    ScriptLayer -->|è§£æç»“æœ| ExecutionLayer\r\n-    ExecutionLayer -->|æ‰§è¡ŒçŠ¶æ€| StateLayer\r\n-    ExecutionLayer -->|è¡¨ç°è¯·æ±‚| PresentationLayer\r\n-    StateLayer -->|çŠ¶æ€æŸ¥è¯¢| ExecutionLayer\r\n-    PresentationLayer -->|å®Œæˆå›è°ƒ| ExecutionLayer\r\n+    DataLayer -->|åŠ è½½é…ç½®| ScriptLayer\r\n+    ScriptLayer -->|è§£æå®Œæˆ| ExecutionLayer\r\n+    ExecutionLayer -->|æ›´æ–°çŠ¶æ€| StateLayer\r\n+    ExecutionLayer -->|è¯·æ±‚è¡¨ç°| PresentationLayer\r\n+    StateLayer -.->|æŸ¥è¯¢çŠ¶æ€| ExecutionLayer\r\n+    PresentationLayer -.->|æ‰§è¡Œå®Œæˆ| ExecutionLayer\r\n     \r\n-    style DataLayer fill:#e1f5ff\r\n-    style ScriptLayer fill:#fff4e1\r\n-    style ExecutionLayer fill:#c8e6c9\r\n-    style StateLayer fill:#f3e5f5\r\n-    style PresentationLayer fill:#ffebee\r\n+    style DataLayer fill:#e1f5ff,stroke:#01579b,stroke-width:2px\r\n+    style ScriptLayer fill:#fff4e1,stroke:#e65100,stroke-width:2px\r\n+    style ExecutionLayer fill:#c8e6c9,stroke:#1b5e20,stroke-width:2px\r\n+    style StateLayer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\r\n+    style PresentationLayer fill:#ffebee,stroke:#b71c1c,stroke-width:2px\r\n ```\r\n \r\n ---\r\n \r\n@@ -78,12 +83,866 @@\n - ä¸ç°æœ‰ç³»ç»Ÿï¼ˆTimelineã€UIã€Audioï¼‰é€šè¿‡æ¥å£äº¤äº’\r\n \r\n ---\r\n \r\n-## ğŸ“ åç»­è¯¦ç»†è®¾è®¡\r\n+---\r\n \r\n-å¾…æ¶æ„å›¾ç¡®è®¤åï¼Œå°†è¯¦ç»†è®¾è®¡ï¼š\r\n-- å„å±‚çš„å…·ä½“å®ç°\r\n-- èŠ‚ç‚¹ç±»å‹å®šä¹‰\r\n-- æ•°æ®æ ¼å¼è®¾è®¡\r\n-- APIæ¥å£è®¾è®¡\r\n-- ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ\r\n+## æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n+\r\n+### 1. è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ\r\n+\r\n+**æœ¬è´¨**ï¼šå‰§æƒ…æ¼”å‡ºç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯è„šæœ¬è§£æå’Œæ‰§è¡Œ\r\n+- å‰§æƒ…è„šæœ¬ = å¯¹è¯æ ‘ã€èŠ‚ç‚¹å›¾ç­‰ç»“æ„åŒ–æ•°æ®\r\n+- èŠ‚ç‚¹è¿æ¥ = é€šè¿‡ nextNodeIdã€branchList ç­‰å­—æ®µå®šä¹‰è¿æ¥å…³ç³»\r\n+- æ¡ä»¶åˆ†æ”¯ = é€šè¿‡ conditions å­—æ®µå®ç°æ¡ä»¶åˆ¤æ–­å’Œåˆ†æ”¯é€‰æ‹©\r\n+- è„šæœ¬è§£æ = å°†é…ç½®æ•°æ®è§£æä¸ºå¯æ‰§è¡Œçš„èŠ‚ç‚¹å›¾ç»“æ„\r\n+\r\n+### 2. æ•°æ®é©±åŠ¨æ¶æ„\r\n+\r\n+**æœ¬è´¨**ï¼šå‰§æƒ…ç‰¹æ€§é€šè¿‡é…ç½®æ•°æ®å®ç°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç \r\n+- èŠ‚ç‚¹ç±»å‹ã€åˆ†æ”¯æ¡ä»¶ã€æ•ˆæœè§¦å‘ â†’ é€šè¿‡é…ç½®æ•°æ®å®šä¹‰\r\n+- å‰§æƒ…æµç¨‹ã€åˆ†æ”¯é€‰æ‹©ã€çŠ¶æ€ä¿å­˜ â†’ é€šè¿‡é…ç½®æ•°æ®æ§åˆ¶\r\n+- æ–°å¢èŠ‚ç‚¹ç±»å‹ â†’ æ‰©å±•é…ç½®æ•°æ®å³å¯\r\n+- å‰§æƒ…è°ƒæ•´ â†’ ä¿®æ”¹é…ç½®æ•°æ®å³å¯\r\n+\r\n+### 3. äº”å±‚æ¶æ„ + ç®¡é“è¿‡æ»¤å™¨\r\n+\r\n+**æœ¬è´¨**ï¼šåˆ†å±‚æ¶æ„å®ç°èŒè´£åˆ†ç¦»ï¼Œç®¡é“è¿‡æ»¤å™¨å®ç°æ•°æ®æµè½¬\r\n+- äº”å±‚æ¶æ„ï¼šè„šæœ¬å±‚ã€æ‰§è¡Œå±‚ã€è¡¨ç°å±‚ã€çŠ¶æ€å±‚ã€æ•°æ®å±‚\r\n+- ç®¡é“è¿‡æ»¤å™¨ï¼šContext åœ¨å±‚é—´æµè½¬å¹¶é€æ­¥å¢å¼º\r\n+- ç»Ÿä¸€æ¥å£ï¼šæ‰€æœ‰å±‚ä½¿ç”¨ç»Ÿä¸€çš„ StoryContext\r\n+- è§£è€¦è®¾è®¡ï¼šå±‚é—´é€šè¿‡ Context å’Œ CommunicationBus é€šä¿¡\r\n+\r\n+### 4. è¡¨ç°å±‚è§£è€¦\r\n+\r\n+**æœ¬è´¨**ï¼šè¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦ï¼Œé€šè¿‡ Visual ç³»ç»Ÿç»Ÿä¸€ç®¡ç†\r\n+- è¡¨ç°ç±»å‹ = Timelineã€UIã€Audioã€Animationã€VFX ç­‰\r\n+- ç»Ÿä¸€æ¥å£ = é€šè¿‡ Visual ç³»ç»Ÿç»Ÿä¸€è°ƒç”¨\r\n+- èµ„æºç®¡ç† = Visual ç³»ç»Ÿè´Ÿè´£èµ„æºåŠ è½½å’Œç”Ÿå‘½å‘¨æœŸ\r\n+- æ€§èƒ½ä¼˜åŒ– = Visual ç³»ç»Ÿè´Ÿè´£å¯¹è±¡æ± å’Œæ€§èƒ½ä¼˜åŒ–\r\n+\r\n+---\r\n+\r\n+## ç®¡é“è¿‡æ»¤å™¨æ•°æ®æµ\r\n+\r\n+```mermaid\r\n+graph LR\r\n+    Start[å¤–éƒ¨è§¦å‘] -->|1. åˆ›å»ºContext| ScriptL[è„šæœ¬å±‚<br/>è§£æè„šæœ¬<br/>+scriptData]\r\n+    ScriptL -->|2. StoryContext<br/>+scriptData| ExecL[æ‰§è¡Œå±‚<br/>æ‰§è¡ŒèŠ‚ç‚¹<br/>+executionData]\r\n+    ExecL -->|3. StoryContext<br/>+executionData| PresL[è¡¨ç°å±‚<br/>æ’­æ”¾è¡¨ç°<br/>+presentationData]\r\n+    PresL -->|4. StoryContext<br/>+presentationData| StateL[çŠ¶æ€å±‚<br/>æ›´æ–°çŠ¶æ€<br/>+stateData]\r\n+    StateL -->|5. StoryContext<br/>å¾ªç¯ä½¿ç”¨| ExecL\r\n+    ExecL -.å®ŒæˆèŠ‚ç‚¹.-> End[èŠ‚ç‚¹å®Œæˆ]\r\n+    \r\n+    style ScriptL fill:#e1f5ff\r\n+    style ExecL fill:#fff4e1\r\n+    style PresL fill:#c8e6c9\r\n+    style StateL fill:#f3e5f5\r\n+```\r\n+\r\n+---\r\n+\r\n+## è„šæœ¬å±‚æ¶æ„è®¾è®¡\r\n+\r\n+### æ ¸å¿ƒèŒè´£\r\n+\r\n+è§£æå‰§æƒ…è„šæœ¬é…ç½® â†’ æ„å»ºèŠ‚ç‚¹å›¾ â†’ æ³¨å†ŒèŠ‚ç‚¹ç±»å‹\r\n+\r\n+### æ¶æ„å›¾\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph ScriptLayer[\"è„šæœ¬å±‚\"]\r\n+        ScriptParser[\"è„šæœ¬è§£æå™¨<br/>StoryScriptParser\"]\r\n+        NodeGraphBuilder[\"èŠ‚ç‚¹å›¾æ„å»ºå™¨<br/>NodeGraphBuilder\"]\r\n+        NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n+    end\r\n+    \r\n+    subgraph DataSource[\"æ•°æ®æº\"]\r\n+        StoryConfig[\"StoryConfig<br/>å‰§æƒ…é…ç½®\"]\r\n+        NodeConfig[\"NodeConfig<br/>èŠ‚ç‚¹é…ç½®\"]\r\n+    end\r\n+    \r\n+    subgraph NodeGraph[\"èŠ‚ç‚¹å›¾ç»“æ„\"]\r\n+        Nodes[\"èŠ‚ç‚¹åˆ—è¡¨<br/>nodes\"]\r\n+        Edges[\"è¿æ¥å…³ç³»<br/>edges\"]\r\n+        EntryNode[\"å…¥å£èŠ‚ç‚¹<br/>entryNode\"]\r\n+    end\r\n+    \r\n+    DataSource --> ScriptParser\r\n+    ScriptParser --> NodeGraphBuilder\r\n+    NodeGraphBuilder --> NodeGraph\r\n+    NodeGraph --> NodeRegistry\r\n+    \r\n+    style ScriptLayer fill:#e1f5ff\r\n+    style NodeGraph fill:#c8e6c9\r\n+```\r\n+\r\n+### æ ¸å¿ƒç»„ä»¶\r\n+\r\n+1. **è„šæœ¬è§£æå™¨ï¼ˆStoryScriptParserï¼‰**\r\n+   - è§£æ StoryConfig é…ç½®æ•°æ®\r\n+   - è§£æ NodeConfig èŠ‚ç‚¹é…ç½®\r\n+   - æ„å»ºèŠ‚ç‚¹å›¾æ•°æ®ç»“æ„\r\n+   - éªŒè¯èŠ‚ç‚¹è¿æ¥å…³ç³»\r\n+\r\n+2. **èŠ‚ç‚¹å›¾æ„å»ºå™¨ï¼ˆNodeGraphBuilderï¼‰**\r\n+   - æ„å»ºèŠ‚ç‚¹å›¾ç»“æ„ï¼ˆnodesã€edgesï¼‰\r\n+   - è¯†åˆ«å…¥å£èŠ‚ç‚¹\r\n+   - éªŒè¯èŠ‚ç‚¹å›¾å®Œæ•´æ€§\r\n+   - ä¼˜åŒ–èŠ‚ç‚¹å›¾ç»“æ„\r\n+\r\n+3. **èŠ‚ç‚¹æ³¨å†Œè¡¨ï¼ˆNodeRegistryï¼‰**\r\n+   - æ³¨å†ŒèŠ‚ç‚¹ç±»å‹ï¼ˆå¯¹è¯èŠ‚ç‚¹ã€åŠ¨ä½œèŠ‚ç‚¹ã€åˆ†æ”¯èŠ‚ç‚¹ç­‰ï¼‰\r\n+   - èŠ‚ç‚¹ç±»å‹æ˜ å°„ï¼ˆnodeType â†’ NodeExecutorï¼‰\r\n+   - èŠ‚ç‚¹å·¥å‚æ¨¡å¼ï¼ˆåˆ›å»ºèŠ‚ç‚¹æ‰§è¡Œå™¨ï¼‰\r\n+\r\n+### èŠ‚ç‚¹ç±»å‹å®šä¹‰\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph NodeTypes[\"èŠ‚ç‚¹ç±»å‹\"]\r\n+        DialogueNode[\"å¯¹è¯èŠ‚ç‚¹<br/>DialogueNode\"]\r\n+        ActionNode[\"åŠ¨ä½œèŠ‚ç‚¹<br/>ActionNode\"]\r\n+        BranchNode[\"åˆ†æ”¯èŠ‚ç‚¹<br/>BranchNode\"]\r\n+        ConditionNode[\"æ¡ä»¶èŠ‚ç‚¹<br/>ConditionNode\"]\r\n+        TimelineNode[\"TimelineèŠ‚ç‚¹<br/>TimelineNode\"]\r\n+        EndNode[\"ç»“æŸèŠ‚ç‚¹<br/>EndNode\"]\r\n+    end\r\n+    \r\n+    DialogueNode -->|ç»§æ‰¿| BaseNode\r\n+    ActionNode -->|ç»§æ‰¿| BaseNode\r\n+    BranchNode -->|ç»§æ‰¿| BaseNode\r\n+    ConditionNode -->|ç»§æ‰¿| BaseNode\r\n+    TimelineNode -->|ç»§æ‰¿| BaseNode\r\n+    EndNode -->|ç»§æ‰¿| BaseNode\r\n+    \r\n+    style BaseNode fill:#fff4e1\r\n+```\r\n+\r\n+---\r\n+\r\n+## æ‰§è¡Œå±‚æ¶æ„è®¾è®¡\r\n+\r\n+### æ ¸å¿ƒèŒè´£\r\n+\r\n+ç®¡ç†å½“å‰èŠ‚ç‚¹ â†’ æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘ â†’ é€‰æ‹©åˆ†æ”¯ â†’ æ›´æ–°çŠ¶æ€\r\n+\r\n+### æ¶æ„å›¾\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph ExecutionLayer[\"æ‰§è¡Œå±‚\"]\r\n+        StoryExecutor[\"å‰§æƒ…æ‰§è¡Œå™¨<br/>StoryExecutor\"]\r\n+        NodeExecutor[\"èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>NodeExecutor\"]\r\n+        BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n+        ConditionChecker[\"æ¡ä»¶æ£€æŸ¥å™¨<br/>ConditionChecker\"]\r\n+    end\r\n+    \r\n+    subgraph NodeState[\"èŠ‚ç‚¹çŠ¶æ€\"]\r\n+        CurrentNode[\"å½“å‰èŠ‚ç‚¹<br/>currentNode\"]\r\n+        NodeStack[\"èŠ‚ç‚¹æ ˆ<br/>nodeStack\"]\r\n+        ExecutionContext[\"æ‰§è¡Œä¸Šä¸‹æ–‡<br/>executionContext\"]\r\n+    end\r\n+    \r\n+    subgraph BranchLogic[\"åˆ†æ”¯é€»è¾‘\"]\r\n+        BranchList[\"åˆ†æ”¯åˆ—è¡¨<br/>branchList\"]\r\n+        ConditionList[\"æ¡ä»¶åˆ—è¡¨<br/>conditionList\"]\r\n+        SelectedBranch[\"é€‰ä¸­åˆ†æ”¯<br/>selectedBranch\"]\r\n+    end\r\n+    \r\n+    StoryExecutor --> NodeExecutor\r\n+    StoryExecutor --> BranchSelector\r\n+    BranchSelector --> ConditionChecker\r\n+    NodeExecutor --> NodeState\r\n+    BranchSelector --> BranchLogic\r\n+    \r\n+    style ExecutionLayer fill:#fff4e1\r\n+    style NodeState fill:#c8e6c9\r\n+    style BranchLogic fill:#e1f5ff\r\n+```\r\n+\r\n+### å·¥ä½œæµç¨‹\r\n+\r\n+```mermaid\r\n+flowchart TD\r\n+    Start[å‰§æƒ…å¼€å§‹] --> Load[åŠ è½½èŠ‚ç‚¹å›¾]\r\n+    Load --> Init[åˆå§‹åŒ–æ‰§è¡Œå™¨]\r\n+    Init --> GetEntry[è·å–å…¥å£èŠ‚ç‚¹]\r\n+    GetEntry --> Execute[æ‰§è¡Œå½“å‰èŠ‚ç‚¹]\r\n+    \r\n+    Execute --> CheckType{èŠ‚ç‚¹ç±»å‹?}\r\n+    CheckType -->|å¯¹è¯èŠ‚ç‚¹| Dialogue[æ‰§è¡Œå¯¹è¯]\r\n+    CheckType -->|åŠ¨ä½œèŠ‚ç‚¹| Action[æ‰§è¡ŒåŠ¨ä½œ]\r\n+    CheckType -->|åˆ†æ”¯èŠ‚ç‚¹| Branch[é€‰æ‹©åˆ†æ”¯]\r\n+    CheckType -->|TimelineèŠ‚ç‚¹| Timeline[æ’­æ”¾Timeline]\r\n+    CheckType -->|ç»“æŸèŠ‚ç‚¹| End[ç»“æŸå‰§æƒ…]\r\n+    \r\n+    Dialogue --> Wait[ç­‰å¾…å®Œæˆ]\r\n+    Action --> Wait\r\n+    Timeline --> Wait\r\n+    \r\n+    Wait --> CheckBranch{æœ‰åˆ†æ”¯?}\r\n+    CheckBranch -->|æ˜¯| Select[é€‰æ‹©åˆ†æ”¯]\r\n+    CheckBranch -->|å¦| Next[ä¸‹ä¸€ä¸ªèŠ‚ç‚¹]\r\n+    \r\n+    Select --> CheckCondition{æ£€æŸ¥æ¡ä»¶}\r\n+    CheckCondition -->|æ»¡è¶³| Next\r\n+    CheckCondition -->|ä¸æ»¡è¶³| Select\r\n+    \r\n+    Next --> Execute\r\n+    End --> Save[ä¿å­˜çŠ¶æ€]\r\n+    Save --> Finish[å®Œæˆ]\r\n+    \r\n+    style Execute fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style CheckBranch fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style CheckCondition fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+```\r\n+\r\n+### æ ¸å¿ƒç»„ä»¶\r\n+\r\n+1. **å‰§æƒ…æ‰§è¡Œå™¨ï¼ˆStoryExecutorï¼‰**\r\n+   - ç®¡ç†å½“å‰èŠ‚ç‚¹çŠ¶æ€\r\n+   - æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œæµç¨‹\r\n+   - å¤„ç†èŠ‚ç‚¹è·³è½¬\r\n+   - ç®¡ç†èŠ‚ç‚¹æ ˆï¼ˆæ”¯æŒåµŒå¥—å‰§æƒ…ï¼‰\r\n+\r\n+2. **èŠ‚ç‚¹æ‰§è¡Œå™¨ï¼ˆNodeExecutorï¼‰**\r\n+   - æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘\r\n+   - è°ƒç”¨è¡¨ç°å±‚æ’­æ”¾è¡¨ç°\r\n+   - ç­‰å¾…èŠ‚ç‚¹å®Œæˆ\r\n+   - è§¦å‘èŠ‚ç‚¹å®Œæˆäº‹ä»¶\r\n+\r\n+3. **åˆ†æ”¯é€‰æ‹©å™¨ï¼ˆBranchSelectorï¼‰**\r\n+   - è§£æåˆ†æ”¯åˆ—è¡¨\r\n+   - æ£€æŸ¥åˆ†æ”¯æ¡ä»¶\r\n+   - é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„åˆ†æ”¯\r\n+   - å¤„ç†ç©å®¶é€‰æ‹©åˆ†æ”¯\r\n+\r\n+4. **æ¡ä»¶æ£€æŸ¥å™¨ï¼ˆConditionCheckerï¼‰**\r\n+   - æ£€æŸ¥èŠ‚ç‚¹æ¡ä»¶ï¼ˆå‰ç½®æ¡ä»¶ï¼‰\r\n+   - æ£€æŸ¥åˆ†æ”¯æ¡ä»¶ï¼ˆåˆ†æ”¯é€‰æ‹©ï¼‰\r\n+   - ä½¿ç”¨ Condition ç³»ç»Ÿç»Ÿä¸€æ£€æŸ¥\r\n+   - è¿”å›æ¡ä»¶æ£€æŸ¥ç»“æœ\r\n+\r\n+---\r\n+\r\n+## è¡¨ç°å±‚æ¶æ„è®¾è®¡\r\n+\r\n+### æ ¸å¿ƒèŒè´£\r\n+\r\n+æ¥æ”¶æ‰§è¡Œè¯·æ±‚ â†’ è°ƒç”¨ Visual ç³»ç»Ÿ â†’ æ’­æ”¾è¡¨ç°æ•ˆæœ â†’ é€šçŸ¥å®Œæˆ\r\n+\r\n+### æ¶æ„å›¾\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph PresentationLayer[\"è¡¨ç°å±‚\"]\r\n+        VisualAdapter[\"Visual é€‚é…å™¨<br/>VisualAdapter\"]\r\n+        TimelinePlayer[\"Timeline æ’­æ”¾å™¨<br/>TimelinePlayer\"]\r\n+        UIPlayer[\"UI æ’­æ”¾å™¨<br/>UIPlayer\"]\r\n+        AudioPlayer[\"Audio æ’­æ”¾å™¨<br/>AudioPlayer\"]\r\n+    end\r\n+    \r\n+    subgraph VisualSystem[\"Visual ç³»ç»Ÿ\"]\r\n+        VisualSystemCore[\"VisualSystem<br/>æ ¸å¿ƒç³»ç»Ÿ\"]\r\n+        VisualSequence[\"VisualSequence<br/>åºåˆ—ç¼–æ’\"]\r\n+        VisualPool[\"å¯¹è±¡æ± <br/>ObjectPool\"]\r\n+    end\r\n+    \r\n+    subgraph PresentationTypes[\"è¡¨ç°ç±»å‹\"]\r\n+        Timeline[\"Timeline<br/>æ—¶é—´è½´\"]\r\n+        UI[\"UI<br/>ç•Œé¢\"]\r\n+        Audio[\"Audio<br/>éŸ³é¢‘\"]\r\n+        Animation[\"Animation<br/>åŠ¨ç”»\"]\r\n+        VFX[\"VFX<br/>ç‰¹æ•ˆ\"]\r\n+    end\r\n+    \r\n+    VisualAdapter --> VisualSystemCore\r\n+    TimelinePlayer --> Timeline\r\n+    UIPlayer --> UI\r\n+    AudioPlayer --> Audio\r\n+    \r\n+    VisualSystemCore --> VisualSequence\r\n+    VisualSequence --> VisualPool\r\n+    VisualSequence --> PresentationTypes\r\n+    \r\n+    style PresentationLayer fill:#c8e6c9\r\n+    style VisualSystem fill:#fff4e1\r\n+    style PresentationTypes fill:#e1f5ff\r\n+```\r\n+\r\n+### å·¥ä½œæµç¨‹\r\n+\r\n+```mermaid\r\n+flowchart TD\r\n+    Request[è¡¨ç°è¯·æ±‚] --> Parse[è§£æè¡¨ç°ç±»å‹]\r\n+    Parse --> Select{é€‰æ‹©æ’­æ”¾å™¨}\r\n+    \r\n+    Select -->|Timeline| Timeline[Timelineæ’­æ”¾å™¨]\r\n+    Select -->|UI| UI[UIæ’­æ”¾å™¨]\r\n+    Select -->|Audio| Audio[Audioæ’­æ”¾å™¨]\r\n+    Select -->|Animation| Animation[Animationæ’­æ”¾å™¨]\r\n+    Select -->|VFX| VFX[VFXæ’­æ”¾å™¨]\r\n+    \r\n+    Timeline --> Visual[è°ƒç”¨Visualç³»ç»Ÿ]\r\n+    UI --> Visual\r\n+    Audio --> Visual\r\n+    Animation --> Visual\r\n+    VFX --> Visual\r\n+    \r\n+    Visual --> Create[åˆ›å»ºVisualSequence]\r\n+    Create --> Append[æ·»åŠ è¡¨ç°èŠ‚ç‚¹]\r\n+    Append --> Play[æ’­æ”¾åºåˆ—]\r\n+    Play --> Wait[ç­‰å¾…å®Œæˆ]\r\n+    Wait --> Notify[é€šçŸ¥å®Œæˆ]\r\n+    \r\n+    style Select fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style Visual fill:#c8e6c9\r\n+```\r\n+\r\n+### æ ¸å¿ƒç»„ä»¶\r\n+\r\n+1. **Visual é€‚é…å™¨ï¼ˆVisualAdapterï¼‰**\r\n+   - ç»Ÿä¸€æ¥å£å°è£…\r\n+   - è¡¨ç°ç±»å‹æ˜ å°„\r\n+   - å‚æ•°è½¬æ¢ï¼ˆStoryContext â†’ VisualContextï¼‰\r\n+   - å®Œæˆå›è°ƒå¤„ç†\r\n+\r\n+2. **Timeline æ’­æ”¾å™¨ï¼ˆTimelinePlayerï¼‰**\r\n+   - åˆ›å»º TimelineVisual\r\n+   - é…ç½® Timeline å‚æ•°\r\n+   - æ’­æ”¾ Timeline\r\n+   - ç›‘å¬æ’­æ”¾å®Œæˆ\r\n+\r\n+3. **UI æ’­æ”¾å™¨ï¼ˆUIPlayerï¼‰**\r\n+   - æ‰“å¼€å¯¹è¯ UI\r\n+   - æ˜¾ç¤ºå¯¹è¯å†…å®¹\r\n+   - ç­‰å¾…ç©å®¶æ“ä½œ\r\n+   - å…³é—­å¯¹è¯ UI\r\n+\r\n+4. **Audio æ’­æ”¾å™¨ï¼ˆAudioPlayerï¼‰**\r\n+   - æ’­æ”¾èƒŒæ™¯éŸ³ä¹\r\n+   - æ’­æ”¾éŸ³æ•ˆ\r\n+   - éŸ³é‡æ§åˆ¶\r\n+   - éŸ³é¢‘æ·¡å…¥æ·¡å‡º\r\n+\r\n+---\r\n+\r\n+## çŠ¶æ€å±‚æ¶æ„è®¾è®¡\r\n+\r\n+### æ ¸å¿ƒèŒè´£\r\n+\r\n+ç®¡ç†å‰§æƒ…çŠ¶æ€ â†’ è¿½è¸ªè¿›åº¦ â†’ ä¿å­˜/æ¢å¤ â†’ æŒä¹…åŒ–\r\n+\r\n+### æ¶æ„å›¾\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph StateLayer[\"çŠ¶æ€å±‚\"]\r\n+        StateManager[\"çŠ¶æ€ç®¡ç†å™¨<br/>StoryStateManager\"]\r\n+        ProgressTracker[\"è¿›åº¦è¿½è¸ªå™¨<br/>ProgressTracker\"]\r\n+        SaveLoader[\"ä¿å­˜åŠ è½½å™¨<br/>SaveLoader\"]\r\n+    end\r\n+    \r\n+    subgraph StateData[\"çŠ¶æ€æ•°æ®\"]\r\n+        StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n+        NodeState[\"èŠ‚ç‚¹çŠ¶æ€<br/>NodeState\"]\r\n+        BranchHistory[\"åˆ†æ”¯å†å²<br/>BranchHistory\"]\r\n+        VariableState[\"å˜é‡çŠ¶æ€<br/>VariableState\"]\r\n+    end\r\n+    \r\n+    subgraph Persistence[\"æŒä¹…åŒ–\"]\r\n+        SaveData[\"å­˜æ¡£æ•°æ®<br/>SaveData\"]\r\n+        LoadData[\"åŠ è½½æ•°æ®<br/>LoadData\"]\r\n+    end\r\n+    \r\n+    StateManager --> StateData\r\n+    ProgressTracker --> StateData\r\n+    SaveLoader --> Persistence\r\n+    Persistence --> StateData\r\n+    \r\n+    style StateLayer fill:#f3e5f5\r\n+    style StateData fill:#c8e6c9\r\n+    style Persistence fill:#e1f5ff\r\n+```\r\n+\r\n+### çŠ¶æ€ç®¡ç†æµç¨‹\r\n+\r\n+```mermaid\r\n+flowchart TD\r\n+    Start[å‰§æƒ…å¼€å§‹] --> Init[åˆå§‹åŒ–çŠ¶æ€]\r\n+    Init --> Track[è¿½è¸ªè¿›åº¦]\r\n+    \r\n+    Track --> Update[æ›´æ–°çŠ¶æ€]\r\n+    Update --> Check{éœ€è¦ä¿å­˜?}\r\n+    Check -->|æ˜¯| Save[ä¿å­˜çŠ¶æ€]\r\n+    Check -->|å¦| Continue[ç»§ç»­æ‰§è¡Œ]\r\n+    \r\n+    Save --> Persist[æŒä¹…åŒ–]\r\n+    Persist --> Continue\r\n+    \r\n+    Continue --> Complete{å‰§æƒ…å®Œæˆ?}\r\n+    Complete -->|å¦| Track\r\n+    Complete -->|æ˜¯| FinalSave[æœ€ç»ˆä¿å­˜]\r\n+    FinalSave --> End[ç»“æŸ]\r\n+    \r\n+    Load[åŠ è½½å‰§æƒ…] --> Restore[æ¢å¤çŠ¶æ€]\r\n+    Restore --> Resume[æ¢å¤æ‰§è¡Œ]\r\n+    Resume --> Track\r\n+    \r\n+    style Check fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style Complete fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+```\r\n+\r\n+### æ ¸å¿ƒç»„ä»¶\r\n+\r\n+1. **çŠ¶æ€ç®¡ç†å™¨ï¼ˆStoryStateManagerï¼‰**\r\n+   - ç®¡ç†å‰§æƒ…çŠ¶æ€ï¼ˆæœªå¼€å§‹/è¿›è¡Œä¸­/å·²å®Œæˆ/å·²è·³è¿‡ï¼‰\r\n+   - ç®¡ç†èŠ‚ç‚¹çŠ¶æ€ï¼ˆæœªæ‰§è¡Œ/æ‰§è¡Œä¸­/å·²å®Œæˆï¼‰\r\n+   - ç®¡ç†åˆ†æ”¯å†å²ï¼ˆè®°å½•ç©å®¶é€‰æ‹©ï¼‰\r\n+   - ç®¡ç†å˜é‡çŠ¶æ€ï¼ˆå‰§æƒ…å˜é‡ã€å…¨å±€å˜é‡ï¼‰\r\n+\r\n+2. **è¿›åº¦è¿½è¸ªå™¨ï¼ˆProgressTrackerï¼‰**\r\n+   - è¿½è¸ªå‰§æƒ…è¿›åº¦ï¼ˆå½“å‰èŠ‚ç‚¹ã€å·²å®ŒæˆèŠ‚ç‚¹ï¼‰\r\n+   - è¿½è¸ªåˆ†æ”¯è¿›åº¦ï¼ˆå·²é€‰æ‹©åˆ†æ”¯ã€æœªé€‰æ‹©åˆ†æ”¯ï¼‰\r\n+   - è¿½è¸ªå®Œæˆåº¦ï¼ˆç™¾åˆ†æ¯”ã€é‡Œç¨‹ç¢‘ï¼‰\r\n+\r\n+3. **ä¿å­˜åŠ è½½å™¨ï¼ˆSaveLoaderï¼‰**\r\n+   - ä¿å­˜å‰§æƒ…çŠ¶æ€åˆ°å­˜æ¡£\r\n+   - ä»å­˜æ¡£åŠ è½½å‰§æƒ…çŠ¶æ€\r\n+   - æ”¯æŒå¢é‡ä¿å­˜ï¼ˆåªä¿å­˜å˜æ›´ï¼‰\r\n+   - æ”¯æŒç‰ˆæœ¬å…¼å®¹ï¼ˆæ—§å­˜æ¡£å…¼å®¹ï¼‰\r\n+\r\n+---\r\n+\r\n+## æ•°æ®å±‚æ¶æ„è®¾è®¡\r\n+\r\n+### æ ¸å¿ƒèŒè´£\r\n+\r\n+æä¾›é…ç½®æ•°æ® â†’ ç®¡ç†èµ„æºè·¯å¾„ â†’ æ”¯æŒæ•°æ®æŸ¥è¯¢\r\n+\r\n+### æ¶æ„å›¾\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph DataLayer[\"æ•°æ®å±‚\"]\r\n+        StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n+        NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n+        DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n+        ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n+    end\r\n+    \r\n+    subgraph ConfigData[\"é…ç½®æ•°æ®<br/>é™æ€æ•°æ®\"]\r\n+        StoryData[\"StoryData<br/>å‰§æƒ…ID/åç§°/å…¥å£èŠ‚ç‚¹\"]\r\n+        NodeData[\"NodeData<br/>èŠ‚ç‚¹ID/ç±»å‹/å‚æ•°\"]\r\n+        DialogueData[\"DialogueData<br/>å¯¹è¯ID/å†…å®¹/NPC\"]\r\n+        ResourceData[\"ResourceData<br/>èµ„æºè·¯å¾„/ç±»å‹\"]\r\n+    end\r\n+    \r\n+    subgraph RuntimeData[\"è¿è¡Œæ—¶æ•°æ®<br/>åŠ¨æ€æ•°æ®\"]\r\n+        StoryStateData[\"StoryStateData<br/>å‰§æƒ…çŠ¶æ€\"]\r\n+        NodeExecutionData[\"NodeExecutionData<br/>èŠ‚ç‚¹æ‰§è¡Œæ•°æ®\"]\r\n+        VariableData[\"VariableData<br/>å˜é‡æ•°æ®\"]\r\n+    end\r\n+    \r\n+    ConfigData --> StoryConfig\r\n+    ConfigData --> NodeConfig\r\n+    ConfigData --> DialogueConfig\r\n+    ConfigData --> ResourceConfig\r\n+    \r\n+    RuntimeData --> StateLayer[çŠ¶æ€å±‚]\r\n+    \r\n+    style DataLayer fill:#ffebee\r\n+    style ConfigData fill:#c8e6c9\r\n+    style RuntimeData fill:#e1f5ff\r\n+```\r\n+\r\n+### æ•°æ®ç»“æ„è®¾è®¡\r\n+\r\n+#### StoryConfigï¼ˆå‰§æƒ…é…ç½®ï¼‰\r\n+\r\n+```mermaid\r\n+graph LR\r\n+    StoryConfig --> StoryId[å‰§æƒ…ID]\r\n+    StoryConfig --> StoryName[å‰§æƒ…åç§°]\r\n+    StoryConfig --> EntryNode[å…¥å£èŠ‚ç‚¹ID]\r\n+    StoryConfig --> NodeList[èŠ‚ç‚¹åˆ—è¡¨]\r\n+    StoryConfig --> VariableList[å˜é‡åˆ—è¡¨]\r\n+    StoryConfig --> ResourceList[èµ„æºåˆ—è¡¨]\r\n+    \r\n+    style StoryConfig fill:#ffebee\r\n+```\r\n+\r\n+#### NodeConfigï¼ˆèŠ‚ç‚¹é…ç½®ï¼‰\r\n+\r\n+```mermaid\r\n+graph LR\r\n+    NodeConfig --> NodeId[èŠ‚ç‚¹ID]\r\n+    NodeConfig --> NodeType[èŠ‚ç‚¹ç±»å‹]\r\n+    NodeConfig --> NodeParams[èŠ‚ç‚¹å‚æ•°]\r\n+    NodeConfig --> NextNodeId[ä¸‹ä¸€èŠ‚ç‚¹ID]\r\n+    NodeConfig --> BranchList[åˆ†æ”¯åˆ—è¡¨]\r\n+    NodeConfig --> Conditions[æ¡ä»¶åˆ—è¡¨]\r\n+    NodeConfig --> Effects[æ•ˆæœåˆ—è¡¨]\r\n+    \r\n+    style NodeConfig fill:#c8e6c9\r\n+```\r\n+\r\n+#### DialogueConfigï¼ˆå¯¹è¯é…ç½®ï¼‰\r\n+\r\n+```mermaid\r\n+graph LR\r\n+    DialogueConfig --> DialogueId[å¯¹è¯ID]\r\n+    DialogueConfig --> NpcId[è¯´è¯è€…ID]\r\n+    DialogueConfig --> Content[å¯¹è¯å†…å®¹]\r\n+    DialogueConfig --> ShowType[æ˜¾ç¤ºç±»å‹]\r\n+    DialogueConfig --> ShowParams[æ˜¾ç¤ºå‚æ•°]\r\n+    DialogueConfig --> Emotion[è¡¨æƒ…åºå·]\r\n+    \r\n+    style DialogueConfig fill:#e1f5ff\r\n+```\r\n+\r\n+---\r\n+\r\n+## æ•°æ®æµè®¾è®¡\r\n+\r\n+### å®Œæ•´æ•°æ®æµ\r\n+\r\n+```mermaid\r\n+sequenceDiagram\r\n+    participant Trigger as å¤–éƒ¨è§¦å‘\r\n+    participant Script as è„šæœ¬å±‚\r\n+    participant Exec as æ‰§è¡Œå±‚\r\n+    participant Pres as è¡¨ç°å±‚\r\n+    participant State as çŠ¶æ€å±‚\r\n+    participant Data as æ•°æ®å±‚\r\n+    \r\n+    Trigger->>Script: è§¦å‘å‰§æƒ…\r\n+    Script->>Data: æŸ¥è¯¢é…ç½®æ•°æ®\r\n+    Data-->>Script: è¿”å›StoryConfig/NodeConfig\r\n+    Script->>Script: è§£æè„šæœ¬ï¼Œæ„å»ºèŠ‚ç‚¹å›¾\r\n+    Script->>Exec: StoryContext + scriptData\r\n+    \r\n+    Exec->>Exec: æ‰§è¡Œå½“å‰èŠ‚ç‚¹\r\n+    Exec->>Pres: StoryContext + executionData\r\n+    Pres->>Pres: æ’­æ”¾è¡¨ç°ï¼ˆTimeline/UI/Audioï¼‰\r\n+    Pres-->>Exec: è¡¨ç°å®Œæˆå›è°ƒ\r\n+    Exec->>State: StoryContext + presentationData\r\n+    \r\n+    State->>State: æ›´æ–°çŠ¶æ€\r\n+    State->>Data: ä¿å­˜çŠ¶æ€ï¼ˆå¯é€‰ï¼‰\r\n+    State-->>Exec: çŠ¶æ€æ›´æ–°å®Œæˆ\r\n+    Exec->>Exec: é€‰æ‹©ä¸‹ä¸€èŠ‚ç‚¹\r\n+    Exec->>Exec: ç»§ç»­æ‰§è¡Œï¼ˆå¾ªç¯ï¼‰\r\n+```\r\n+\r\n+### Context å¢å¼ºè¿‡ç¨‹\r\n+\r\n+```mermaid\r\n+graph LR\r\n+    A[StoryContext<br/>åˆå§‹Context] -->|è„šæœ¬å±‚å¢å¼º| B[+scriptData<br/>èŠ‚ç‚¹å›¾/å…¥å£èŠ‚ç‚¹]\r\n+    B -->|æ‰§è¡Œå±‚å¢å¼º| C[+executionData<br/>å½“å‰èŠ‚ç‚¹/æ‰§è¡ŒçŠ¶æ€]\r\n+    C -->|è¡¨ç°å±‚å¢å¼º| D[+presentationData<br/>è¡¨ç°ç±»å‹/æ’­æ”¾çŠ¶æ€]\r\n+    D -->|çŠ¶æ€å±‚å¢å¼º| E[+stateData<br/>å‰§æƒ…çŠ¶æ€/è¿›åº¦]\r\n+    E -->|å¾ªç¯ä½¿ç”¨| C\r\n+    \r\n+    style A fill:#e1f5ff\r\n+    style B fill:#fff4e1\r\n+    style C fill:#c8e6c9\r\n+    style D fill:#f3e5f5\r\n+    style E fill:#ffebee\r\n+```\r\n+\r\n+---\r\n+\r\n+## ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ\r\n+\r\n+### Visual ç³»ç»Ÿé›†æˆ\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph StorySystem[\"å‰§æƒ…ç³»ç»Ÿ\"]\r\n+        StoryExecutor[\"StoryExecutor\"]\r\n+        VisualAdapter[\"VisualAdapter\"]\r\n+    end\r\n+    \r\n+    subgraph VisualSystem[\"Visual ç³»ç»Ÿ\"]\r\n+        VisualSystemCore[\"VisualSystem\"]\r\n+        VisualSequence[\"VisualSequence\"]\r\n+        TimelineVisual[\"TimelineVisual\"]\r\n+        UIVisual[\"UIVisual\"]\r\n+    end\r\n+    \r\n+    StoryExecutor --> VisualAdapter\r\n+    VisualAdapter --> VisualSystemCore\r\n+    VisualSystemCore --> VisualSequence\r\n+    VisualSequence --> TimelineVisual\r\n+    VisualSequence --> UIVisual\r\n+    \r\n+    style StorySystem fill:#ffebee\r\n+    style VisualSystem fill:#c8e6c9\r\n+```\r\n+\r\n+### Dialogue ç³»ç»Ÿé›†æˆ\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph StorySystem[\"å‰§æƒ…ç³»ç»Ÿ\"]\r\n+        NodeExecutor[\"NodeExecutor\"]\r\n+        DialogueNode[\"DialogueNode\"]\r\n+    end\r\n+    \r\n+    subgraph DialogueSystem[\"å¯¹è¯ç³»ç»Ÿ<br/>ï¼ˆç‹¬ç«‹ä½¿ç”¨ï¼‰\"]\r\n+        DialogueManager[\"DialogueManager\"]\r\n+        CfgDialogue[\"CfgDialogue\"]\r\n+        DialogueUI[\"DialogueUI\"]\r\n+    end\r\n+    \r\n+    NodeExecutor --> DialogueNode\r\n+    DialogueNode -->|å¤ç”¨| DialogueManager\r\n+    DialogueManager --> CfgDialogue\r\n+    DialogueManager --> DialogueUI\r\n+    \r\n+    DialogueManager -.ç‹¬ç«‹ä½¿ç”¨.-> CfgDialogue\r\n+    \r\n+    style StorySystem fill:#ffebee\r\n+    style DialogueSystem fill:#c8e6c9\r\n+```\r\n+\r\n+### Condition ç³»ç»Ÿé›†æˆ\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph StorySystem[\"å‰§æƒ…ç³»ç»Ÿ\"]\r\n+        ConditionChecker[\"ConditionChecker\"]\r\n+        BranchSelector[\"BranchSelector\"]\r\n+    end\r\n+    \r\n+    subgraph ConditionSystem[\"Condition ç³»ç»Ÿ\"]\r\n+        ConditionUtil[\"ConditionUtil\"]\r\n+        ConditionData[\"ConditionData\"]\r\n+    end\r\n+    \r\n+    ConditionChecker --> ConditionUtil\r\n+    BranchSelector --> ConditionUtil\r\n+    ConditionUtil --> ConditionData\r\n+    \r\n+    style StorySystem fill:#ffebee\r\n+    style ConditionSystem fill:#c8e6c9\r\n+```\r\n+\r\n+### DataHandleQueue é›†æˆ\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph StorySystem[\"å‰§æƒ…ç³»ç»Ÿ\"]\r\n+        StoryExecutor[\"StoryExecutor\"]\r\n+        EffectTrigger[\"EffectTrigger\"]\r\n+    end\r\n+    \r\n+    subgraph DataQueue[\"DataHandleQueue\"]\r\n+        Queue[\"DataHandleQueue\"]\r\n+        Handler[\"HandlerMapping\"]\r\n+    end\r\n+    \r\n+    StoryExecutor --> EffectTrigger\r\n+    EffectTrigger --> Queue\r\n+    Queue --> Handler\r\n+    \r\n+    style StorySystem fill:#ffebee\r\n+    style DataQueue fill:#f3e5f5\r\n+```\r\n+\r\n+---\r\n+\r\n+## é«˜çº§ç‰¹æ€§\r\n+\r\n+### 1. å‰§æƒ…ä¸­æ–­ä¸æ¢å¤\r\n+\r\n+**è®¾è®¡ç†å¿µ**ï¼šé€šè¿‡èŠ‚ç‚¹æ ˆå®ç°å‰§æƒ…ä¸­æ–­å’Œæ¢å¤\r\n+\r\n+```mermaid\r\n+flowchart TD\r\n+    StoryA[å‰§æƒ…Aæ‰§è¡Œä¸­] --> Trigger[æ–°å‰§æƒ…Bè§¦å‘]\r\n+    Trigger --> Save[ä¿å­˜å‰§æƒ…AçŠ¶æ€åˆ°æ ˆ]\r\n+    Save --> Switch[åˆ‡æ¢åˆ°å‰§æƒ…B]\r\n+    Switch --> Execute[æ‰§è¡Œå‰§æƒ…B]\r\n+    Execute --> Complete{å‰§æƒ…Bå®Œæˆ?}\r\n+    Complete -->|æ˜¯| Restore[ä»æ ˆæ¢å¤å‰§æƒ…A]\r\n+    Complete -->|å¦| Execute\r\n+    Restore --> Resume[ç»§ç»­æ‰§è¡Œå‰§æƒ…A]\r\n+    \r\n+    style Complete fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+```\r\n+\r\n+### 2. æ¡ä»¶åˆ†æ”¯ç³»ç»Ÿ\r\n+\r\n+**è®¾è®¡ç†å¿µ**ï¼šé€šè¿‡ Condition ç³»ç»Ÿå®ç°æ¡ä»¶åˆ¤æ–­\r\n+\r\n+```mermaid\r\n+flowchart TD\r\n+    BranchNode[åˆ†æ”¯èŠ‚ç‚¹] --> Check[æ£€æŸ¥åˆ†æ”¯æ¡ä»¶]\r\n+    Check --> Condition1{æ¡ä»¶1æ»¡è¶³?}\r\n+    Check --> Condition2{æ¡ä»¶2æ»¡è¶³?}\r\n+    Check --> Condition3{æ¡ä»¶3æ»¡è¶³?}\r\n+    \r\n+    Condition1 -->|æ˜¯| Branch1[åˆ†æ”¯1]\r\n+    Condition2 -->|æ˜¯| Branch2[åˆ†æ”¯2]\r\n+    Condition3 -->|æ˜¯| Branch3[åˆ†æ”¯3]\r\n+    \r\n+    Condition1 -->|å¦| Check\r\n+    Condition2 -->|å¦| Check\r\n+    Condition3 -->|å¦| Check\r\n+    \r\n+    style Check fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+```\r\n+\r\n+### 3. ç©å®¶é€‰æ‹©åˆ†æ”¯\r\n+\r\n+**è®¾è®¡ç†å¿µ**ï¼šé€šè¿‡ UI ç³»ç»Ÿå®ç°ç©å®¶é€‰æ‹©\r\n+\r\n+```mermaid\r\n+flowchart TD\r\n+    ChoiceNode[é€‰æ‹©èŠ‚ç‚¹] --> Show[æ˜¾ç¤ºé€‰æ‹©UI]\r\n+    Show --> Option1[é€‰é¡¹1]\r\n+    Show --> Option2[é€‰é¡¹2]\r\n+    Show --> Option3[é€‰é¡¹3]\r\n+    \r\n+    Option1 --> Select1[ç©å®¶é€‰æ‹©1]\r\n+    Option2 --> Select2[ç©å®¶é€‰æ‹©2]\r\n+    Option3 --> Select3[ç©å®¶é€‰æ‹©3]\r\n+    \r\n+    Select1 --> Branch1[åˆ†æ”¯1]\r\n+    Select2 --> Branch2[åˆ†æ”¯2]\r\n+    Select3 --> Branch3[åˆ†æ”¯3]\r\n+    \r\n+    style Show fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+```\r\n+\r\n+### 4. å‰§æƒ…å˜é‡ç³»ç»Ÿ\r\n+\r\n+**è®¾è®¡ç†å¿µ**ï¼šé€šè¿‡å˜é‡ç³»ç»Ÿå®ç°å‰§æƒ…çŠ¶æ€ç®¡ç†\r\n+\r\n+```mermaid\r\n+graph LR\r\n+    VariableSystem[å˜é‡ç³»ç»Ÿ] --> GlobalVar[å…¨å±€å˜é‡]\r\n+    VariableSystem --> StoryVar[å‰§æƒ…å˜é‡]\r\n+    VariableSystem --> LocalVar[å±€éƒ¨å˜é‡]\r\n+    \r\n+    GlobalVar -->|è·¨å‰§æƒ…å…±äº«| StoryA[å‰§æƒ…A]\r\n+    GlobalVar -->|è·¨å‰§æƒ…å…±äº«| StoryB[å‰§æƒ…B]\r\n+    \r\n+    StoryVar -->|å‰§æƒ…å†…å…±äº«| Node1[èŠ‚ç‚¹1]\r\n+    StoryVar -->|å‰§æƒ…å†…å…±äº«| Node2[èŠ‚ç‚¹2]\r\n+    \r\n+    LocalVar -->|èŠ‚ç‚¹å†…ä½¿ç”¨| Node3[èŠ‚ç‚¹3]\r\n+    \r\n+    style VariableSystem fill:#c8e6c9\r\n+```\r\n+\r\n+---\r\n+\r\n+## ä¸å¯¹è¯ç³»ç»Ÿçš„å…³ç³»\r\n+\r\n+### å¯¹è¯ç³»ç»Ÿä½œä¸ºå­é›†\r\n+\r\n+```mermaid\r\n+graph TB\r\n+    subgraph StorySystem[\"å‰§æƒ…æ¼”å‡ºç³»ç»Ÿ\"]\r\n+        StoryExecutor[\"StoryExecutor\"]\r\n+        DialogueNode[\"DialogueNode<br/>å¯¹è¯èŠ‚ç‚¹\"]\r\n+    end\r\n+    \r\n+    subgraph DialogueSystem[\"å¯¹è¯ç³»ç»Ÿ<br/>ï¼ˆç‹¬ç«‹ä½¿ç”¨ï¼‰\"]\r\n+        DialogueManager[\"DialogueManager\"]\r\n+        CfgDialogue[\"CfgDialogue\"]\r\n+    end\r\n+    \r\n+    StoryExecutor --> DialogueNode\r\n+    DialogueNode -->|å¤ç”¨| DialogueManager\r\n+    DialogueManager --> CfgDialogue\r\n+    \r\n+    DialogueManager -.ç‹¬ç«‹ä½¿ç”¨.-> CfgDialogue\r\n+    \r\n+    style StorySystem fill:#ffebee\r\n+    style DialogueSystem fill:#c8e6c9\r\n+```\r\n+\r\n+**å…³ç³»è¯´æ˜**ï¼š\r\n+- âœ… **å¯¹è¯ç³»ç»Ÿç‹¬ç«‹**ï¼šå¯¹è¯ç³»ç»Ÿå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼ˆNPCå¯¹è¯ã€ä»»åŠ¡å¯¹è¯ç­‰ï¼‰\r\n+- âœ… **å‰§æƒ…ç³»ç»Ÿå¤ç”¨**ï¼šå‰§æƒ…ç³»ç»Ÿé€šè¿‡ DialogueNode å¤ç”¨å¯¹è¯ç³»ç»Ÿ\r\n+- âœ… **é…ç½®å…±äº«**ï¼šä¸¤è€…å…±äº« CfgDialogue é…ç½®æ•°æ®\r\n+- âœ… **åŠŸèƒ½æ‰©å±•**ï¼šå‰§æƒ…ç³»ç»Ÿåœ¨å¯¹è¯ç³»ç»ŸåŸºç¡€ä¸Šæ‰©å±•ï¼ˆåˆ†æ”¯ã€æ¡ä»¶ã€çŠ¶æ€ç­‰ï¼‰\r\n+\r\n+---\r\n+\r\n+## æ ¸å¿ƒè®¾è®¡ç‰¹ç‚¹\r\n+\r\n+### 1. è„šæœ¬å±‚ï¼šå¯¹è¯æ ‘/èŠ‚ç‚¹å›¾\r\n+\r\n+**è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n+- âœ… **ç»“æ„åŒ–è„šæœ¬**ï¼šæ”¯æŒå¯¹è¯æ ‘ã€èŠ‚ç‚¹å›¾ç­‰ç»“æ„åŒ–æ•°æ®\r\n+- âœ… **èŠ‚ç‚¹ç±»å‹ä¸°å¯Œ**ï¼šå¯¹è¯ã€åŠ¨ä½œã€åˆ†æ”¯ã€æ¡ä»¶ã€Timeline ç­‰å¤šç§èŠ‚ç‚¹ç±»å‹\r\n+- âœ… **çµæ´»è¿æ¥**ï¼šæ”¯æŒçº¿æ€§ã€åˆ†æ”¯ã€å¾ªç¯ç­‰å¤šç§è¿æ¥æ–¹å¼\r\n+- âœ… **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹é…ç½®é€šè¿‡æ•°æ®å±‚ç®¡ç†\r\n+\r\n+### 2. æ‰§è¡Œå±‚ï¼šèŠ‚ç‚¹æ‰§è¡Œä¸åˆ†æ”¯ç®¡ç†\r\n+\r\n+**è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n+- âœ… **ç»Ÿä¸€æ‰§è¡Œå™¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç±»å‹ä½¿ç”¨ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£\r\n+- âœ… **åˆ†æ”¯é€‰æ‹©**ï¼šæ”¯æŒæ¡ä»¶åˆ†æ”¯å’Œç©å®¶é€‰æ‹©åˆ†æ”¯\r\n+- âœ… **èŠ‚ç‚¹æ ˆç®¡ç†**ï¼šæ”¯æŒåµŒå¥—å‰§æƒ…ï¼ˆå‰§æƒ…A â†’ å‰§æƒ…B â†’ è¿”å›å‰§æƒ…Aï¼‰\r\n+- âœ… **çŠ¶æ€é©±åŠ¨**ï¼šé€šè¿‡çŠ¶æ€ç®¡ç†æ§åˆ¶æ‰§è¡Œæµç¨‹\r\n+\r\n+### 3. è¡¨ç°å±‚ï¼šä¸ç°æœ‰ç³»ç»Ÿè§£è€¦\r\n+\r\n+**è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n+- âœ… **Visual ç³»ç»Ÿé›†æˆ**ï¼šé€šè¿‡ Visual ç³»ç»Ÿç»Ÿä¸€ç®¡ç†è¡¨ç°\r\n+- âœ… **å¤šç±»å‹æ”¯æŒ**ï¼šTimelineã€UIã€Audioã€Animationã€VFX ç­‰\r\n+- âœ… **èµ„æºç®¡ç†**ï¼šVisual ç³»ç»Ÿè´Ÿè´£èµ„æºåŠ è½½å’Œç”Ÿå‘½å‘¨æœŸ\r\n+- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šVisual ç³»ç»Ÿè´Ÿè´£å¯¹è±¡æ± å’Œæ€§èƒ½ä¼˜åŒ–\r\n+\r\n+### 4. çŠ¶æ€å±‚ï¼šä¿å­˜/æ¢å¤ä¸è¿›åº¦è¿½è¸ª\r\n+\r\n+**è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n+- âœ… **å®Œæ•´çŠ¶æ€ç®¡ç†**ï¼šå‰§æƒ…çŠ¶æ€ã€èŠ‚ç‚¹çŠ¶æ€ã€åˆ†æ”¯å†å²ã€å˜é‡çŠ¶æ€\r\n+- âœ… **è¿›åº¦è¿½è¸ª**ï¼šè¿½è¸ªå‰§æƒ…è¿›åº¦ã€åˆ†æ”¯è¿›åº¦ã€å®Œæˆåº¦\r\n+- âœ… **ä¿å­˜/æ¢å¤**ï¼šæ”¯æŒå­˜æ¡£ç³»ç»Ÿé›†æˆï¼Œæ”¯æŒå¢é‡ä¿å­˜\r\n+- âœ… **ç‰ˆæœ¬å…¼å®¹**ï¼šæ”¯æŒæ—§å­˜æ¡£å…¼å®¹\r\n+\r\n+### 5. æ•°æ®å±‚ï¼šé…ç½®æ•°æ®ç®¡ç†\r\n+\r\n+**è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n+- âœ… **åˆ†å±‚æ•°æ®**ï¼šé…ç½®æ•°æ®ï¼ˆé™æ€ï¼‰å’Œè¿è¡Œæ—¶æ•°æ®ï¼ˆåŠ¨æ€ï¼‰åˆ†ç¦»\r\n+- âœ… **èµ„æºç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç† Timelineã€éŸ³é¢‘ã€åŠ¨ç”»ç­‰èµ„æºè·¯å¾„\r\n+- âœ… **æ•°æ®æŸ¥è¯¢**ï¼šæä¾›é«˜æ•ˆçš„æ•°æ®æŸ¥è¯¢æ¥å£\r\n+- âœ… **æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°å¢èŠ‚ç‚¹ç±»å‹å’Œé…ç½®å­—æ®µ\r\n+\r\n+---\r\n+\r\n+## æ€»ç»“\r\n+\r\n+### æ¶æ„è®¾è®¡ä»·å€¼\r\n+\r\n+è¯¥æ¶æ„è®¾è®¡æ–‡æ¡£çš„ä»·å€¼åœ¨äºï¼š\r\n+- âœ… **å®Œæ•´è§£æ„**ï¼šå®Œæ•´è§£æ„å‰§æƒ…æ¼”å‡ºç³»ç»Ÿçš„æ­å»ºæ€è·¯\r\n+- âœ… **äº”å±‚æ¶æ„**ï¼šè„šæœ¬å±‚ã€æ‰§è¡Œå±‚ã€è¡¨ç°å±‚ã€çŠ¶æ€å±‚ã€æ•°æ®å±‚æ¸…æ™°åˆ†ç¦»\r\n+- âœ… **ç³»ç»Ÿé›†æˆ**ï¼šä¸ Visualã€Dialogueã€Conditionã€DataHandleQueue ç­‰ç³»ç»Ÿæ— ç¼é›†æˆ\r\n+- âœ… **æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°å¢èŠ‚ç‚¹ç±»å‹ã€è¡¨ç°ç±»å‹ã€åˆ†æ”¯ç±»å‹ç­‰\r\n+\r\n+### è®¾è®¡åŸåˆ™\r\n+\r\n+- âœ… **è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ**ï¼šå‰§æƒ…è„šæœ¬è§£æå’Œæ‰§è¡Œæ˜¯ç³»ç»Ÿæ ¸å¿ƒ\r\n+- âœ… **æ•°æ®é©±åŠ¨æ¶æ„**ï¼šå‰§æƒ…ç‰¹æ€§é€šè¿‡é…ç½®æ•°æ®å®ç°\r\n+- âœ… **äº”å±‚æ¶æ„ + ç®¡é“è¿‡æ»¤å™¨**ï¼šåˆ†å±‚æ¶æ„å®ç°èŒè´£åˆ†ç¦»\r\n+- âœ… **è¡¨ç°å±‚è§£è€¦**ï¼šé€šè¿‡ Visual ç³»ç»Ÿç»Ÿä¸€ç®¡ç†è¡¨ç°\r\n+\r\n+### æ¶æ„ç‰¹ç‚¹\r\n+\r\n+- âœ… **å¯¹è¯æ ‘/èŠ‚ç‚¹å›¾**ï¼šæ”¯æŒç»“æ„åŒ–è„šæœ¬æ•°æ®\r\n+- âœ… **ç»Ÿä¸€æ‰§è¡Œå™¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç±»å‹ä½¿ç”¨ç»Ÿä¸€æ¥å£\r\n+- âœ… **Visual ç³»ç»Ÿé›†æˆ**ï¼šè¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦\r\n+- âœ… **å®Œæ•´çŠ¶æ€ç®¡ç†**ï¼šæ”¯æŒä¿å­˜/æ¢å¤å’Œè¿›åº¦è¿½è¸ª\r\n+- âœ… **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰ç‰¹æ€§é€šè¿‡é…ç½®æ•°æ®å®ç°\r\n+\r\n+ç»†èŠ‚å®ç°æ˜¯åç»­å¼€å‘é˜¶æ®µçš„å·¥ä½œï¼Œå½“å‰æ¶æ„è®¾è®¡å·²è¶³å¤ŸæŒ‡å¯¼æ•´ä¸ªå‰§æƒ…æ¼”å‡ºç³»ç»Ÿçš„å¼€å‘ã€‚\r\n"
                },
                {
                    "date": 1767379931569,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n \r\n ## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n \r\n ```mermaid\r\n-graph TB\r\n+flowchart TB\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n         direction LR\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n"
                },
                {
                    "date": 1767379982261,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,16 +25,14 @@\n         ScriptValidator[\"è„šæœ¬éªŒè¯å™¨<br/>ScriptValidator\"]\r\n     end\r\n     \r\n     subgraph ExecutionLayer[\"æ‰§è¡Œå±‚ | ExecutionLayer\"]\r\n-        direction LR\r\n         StoryExecutor[\"å‰§æƒ…æ‰§è¡Œå™¨<br/>StoryExecutor\"]\r\n         NodeExecutor[\"èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>NodeExecutor\"]\r\n         BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n     end\r\n     \r\n     subgraph StateLayer[\"çŠ¶æ€å±‚ | StateLayer\"]\r\n-        direction LR\r\n         StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n         StoryVariable[\"å‰§æƒ…å˜é‡<br/>StoryVariable\"]\r\n         StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n     end\r\n"
                },
                {
                    "date": 1767379987672,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,17 +10,15 @@\n \r\n ```mermaid\r\n flowchart TB\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n-        direction LR\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n         DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n         ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n     end\r\n     \r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚ | ScriptLayer\"]\r\n-        direction LR\r\n         StoryParser[\"å‰§æƒ…è§£æå™¨<br/>StoryParser\"]\r\n         NodeGraph[\"èŠ‚ç‚¹å›¾ç®¡ç†<br/>NodeGraph\"]\r\n         ScriptValidator[\"è„šæœ¬éªŒè¯å™¨<br/>ScriptValidator\"]\r\n     end\r\n@@ -37,9 +35,8 @@\n         StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n     end\r\n     \r\n     subgraph PresentationLayer[\"è¡¨ç°å±‚ | PresentationLayer\"]\r\n-        direction LR\r\n         TimelinePlayer[\"Timelineæ’­æ”¾å™¨\"]\r\n         UIPresenter[\"UIè¡¨ç°å™¨\"]\r\n         AudioPlayer[\"éŸ³é¢‘æ’­æ”¾å™¨\"]\r\n         VisualPlayer[\"è§†è§‰è¡¨ç°å™¨\"]\r\n"
                },
                {
                    "date": 1767380011598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n \r\n ## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n \r\n ```mermaid\r\n-flowchart TB\r\n+flowchart TD\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n         DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n"
                },
                {
                    "date": 1767380016910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n \r\n ## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n \r\n ```mermaid\r\n-flowchart TD\r\n+flowchart LR\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n         DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n"
                },
                {
                    "date": 1767380036068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n \r\n ## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n \r\n ```mermaid\r\n-flowchart LR\r\n+flowchart TD\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n         DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n"
                },
                {
                    "date": 1767380612111,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,10 +78,8 @@\n - ä¸ç°æœ‰ç³»ç»Ÿï¼ˆTimelineã€UIã€Audioï¼‰é€šè¿‡æ¥å£äº¤äº’\r\n \r\n ---\r\n \r\n----\r\n-\r\n ## æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n \r\n ### 1. è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ\r\n \r\n"
                },
                {
                    "date": 1767380711323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,11 +29,13 @@\n         BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n     end\r\n     \r\n     subgraph StateLayer[\"çŠ¶æ€å±‚ | StateLayer\"]\r\n+        direction LR\r\n         StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n         StoryVariable[\"å‰§æƒ…å˜é‡<br/>StoryVariable\"]\r\n         StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n+        StateSync[\"çŠ¶æ€åŒæ­¥å™¨<br/>StateSync<br/>åŒæ­¥å…¶ä»–æ¨¡å—çŠ¶æ€/æ•ˆæœ\"]\r\n     end\r\n     \r\n     subgraph PresentationLayer[\"è¡¨ç°å±‚ | PresentationLayer\"]\r\n         TimelinePlayer[\"Timelineæ’­æ”¾å™¨\"]\r\n"
                },
                {
                    "date": 1767380719972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -47,9 +47,12 @@\n     DataLayer -->|åŠ è½½é…ç½®| ScriptLayer\r\n     ScriptLayer -->|è§£æå®Œæˆ| ExecutionLayer\r\n     ExecutionLayer -->|æ›´æ–°çŠ¶æ€| StateLayer\r\n     ExecutionLayer -->|è¯·æ±‚è¡¨ç°| PresentationLayer\r\n+    ExecutionLayer -->|åŒæ­¥è¯·æ±‚| StateLayer\r\n     StateLayer -.->|æŸ¥è¯¢çŠ¶æ€| ExecutionLayer\r\n+    StateLayer -.->|è¯»å–æ•ˆæœå‚æ•°| DataLayer\r\n+    StateLayer -.->|åŒæ­¥å¤–éƒ¨çŠ¶æ€| ExecutionLayer\r\n     PresentationLayer -.->|æ‰§è¡Œå®Œæˆ| ExecutionLayer\r\n     \r\n     style DataLayer fill:#e1f5ff,stroke:#01579b,stroke-width:2px\r\n     style ScriptLayer fill:#fff4e1,stroke:#e65100,stroke-width:2px\r\n"
                },
                {
                    "date": 1767380731877,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,12 +65,12 @@\n \r\n ## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n \r\n ### 1. åˆ†å±‚æ¶æ„\r\n-- **æ•°æ®å±‚**ï¼šé™æ€é…ç½®æ•°æ®ï¼Œæ¥è‡ªé…ç½®è¡¨\r\n+- **æ•°æ®å±‚**ï¼šé™æ€é…ç½®æ•°æ®ï¼Œæ¥è‡ªé…ç½®è¡¨ï¼ˆåŒ…æ‹¬æ•ˆæœå‚æ•°é…ç½®ï¼‰\r\n - **è„šæœ¬å±‚**ï¼šè§£æå’ŒéªŒè¯å‰§æƒ…è„šæœ¬\r\n - **æ‰§è¡Œå±‚**ï¼šæ‰§è¡Œå‰§æƒ…é€»è¾‘ï¼Œç®¡ç†èŠ‚ç‚¹æµè½¬\r\n-- **çŠ¶æ€å±‚**ï¼šç®¡ç†å‰§æƒ…çŠ¶æ€å’Œå˜é‡\r\n+- **çŠ¶æ€å±‚**ï¼šç®¡ç†å‰§æƒ…çŠ¶æ€å’Œå˜é‡ï¼ŒåŒæ­¥å…¶ä»–æ¨¡å—çŠ¶æ€æˆ–æ•ˆæœ\r\n - **è¡¨ç°å±‚**ï¼šä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼Œè´Ÿè´£è§†è§‰å’Œå¬è§‰è¡¨ç°\r\n \r\n ### 2. æ•°æ®é©±åŠ¨\r\n - å‰§æƒ…é€»è¾‘é€šè¿‡é…ç½®æ•°æ®å®šä¹‰ï¼Œæ— éœ€ç¡¬ç¼–ç \r\n"
                },
                {
                    "date": 1767380742280,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,8 +75,9 @@\n ### 2. æ•°æ®é©±åŠ¨\r\n - å‰§æƒ…é€»è¾‘é€šè¿‡é…ç½®æ•°æ®å®šä¹‰ï¼Œæ— éœ€ç¡¬ç¼–ç \r\n - èŠ‚ç‚¹ç±»å‹å¯æ‰©å±•ï¼Œé€šè¿‡é…ç½®å®ç°ä¸åŒè¡Œä¸º\r\n - åˆ†æ”¯ã€æ¡ä»¶ã€æ•ˆæœéƒ½é€šè¿‡é…ç½®å®ç°\r\n+- æ•ˆæœå‚æ•°é…ç½®ç”¨äºåŒæ­¥å…¶ä»–æ¨¡å—çš„çŠ¶æ€æˆ–æ•ˆæœç±»\r\n \r\n ### 3. ç³»ç»Ÿè§£è€¦\r\n - è¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦ï¼Œé€šè¿‡å›è°ƒé€šä¿¡\r\n - çŠ¶æ€å±‚ç‹¬ç«‹ç®¡ç†ï¼Œæ”¯æŒä¿å­˜å’Œæ¢å¤\r\n"
                },
                {
                    "date": 1767380751337,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,8 +80,9 @@\n \r\n ### 3. ç³»ç»Ÿè§£è€¦\r\n - è¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦ï¼Œé€šè¿‡å›è°ƒé€šä¿¡\r\n - çŠ¶æ€å±‚ç‹¬ç«‹ç®¡ç†ï¼Œæ”¯æŒä¿å­˜å’Œæ¢å¤\r\n+- çŠ¶æ€åŒæ­¥å™¨é€šè¿‡é…ç½®çš„æ•ˆæœå‚æ•°ï¼Œä¸å…¶ä»–æ¨¡å—ï¼ˆæ•ˆæœç³»ç»Ÿã€çŠ¶æ€ç³»ç»Ÿç­‰ï¼‰è§£è€¦äº¤äº’\r\n - ä¸ç°æœ‰ç³»ç»Ÿï¼ˆTimelineã€UIã€Audioï¼‰é€šè¿‡æ¥å£äº¤äº’\r\n \r\n ---\r\n \r\n"
                },
                {
                    "date": 1767380779702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,9 +29,8 @@\n         BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n     end\r\n     \r\n     subgraph StateLayer[\"çŠ¶æ€å±‚ | StateLayer\"]\r\n-        direction LR\r\n         StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n         StoryVariable[\"å‰§æƒ…å˜é‡<br/>StoryVariable\"]\r\n         StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n         StateSync[\"çŠ¶æ€åŒæ­¥å™¨<br/>StateSync<br/>åŒæ­¥å…¶ä»–æ¨¡å—çŠ¶æ€/æ•ˆæœ\"]\r\n"
                },
                {
                    "date": 1767380800167,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,9 @@\n \r\n ```mermaid\r\n flowchart TD\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n+        direction LR\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n         DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n         ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n"
                },
                {
                    "date": 1767380825907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,27 +18,31 @@\n         ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n     end\r\n     \r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚ | ScriptLayer\"]\r\n+        direction LR\r\n         StoryParser[\"å‰§æƒ…è§£æå™¨<br/>StoryParser\"]\r\n         NodeGraph[\"èŠ‚ç‚¹å›¾ç®¡ç†<br/>NodeGraph\"]\r\n         ScriptValidator[\"è„šæœ¬éªŒè¯å™¨<br/>ScriptValidator\"]\r\n     end\r\n     \r\n     subgraph ExecutionLayer[\"æ‰§è¡Œå±‚ | ExecutionLayer\"]\r\n+        direction LR\r\n         StoryExecutor[\"å‰§æƒ…æ‰§è¡Œå™¨<br/>StoryExecutor\"]\r\n         NodeExecutor[\"èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>NodeExecutor\"]\r\n         BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n     end\r\n     \r\n     subgraph StateLayer[\"çŠ¶æ€å±‚ | StateLayer\"]\r\n+        direction LR\r\n         StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n         StoryVariable[\"å‰§æƒ…å˜é‡<br/>StoryVariable\"]\r\n         StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n         StateSync[\"çŠ¶æ€åŒæ­¥å™¨<br/>StateSync<br/>åŒæ­¥å…¶ä»–æ¨¡å—çŠ¶æ€/æ•ˆæœ\"]\r\n     end\r\n     \r\n     subgraph PresentationLayer[\"è¡¨ç°å±‚ | PresentationLayer\"]\r\n+        direction LR\r\n         TimelinePlayer[\"Timelineæ’­æ”¾å™¨\"]\r\n         UIPresenter[\"UIè¡¨ç°å™¨\"]\r\n         AudioPlayer[\"éŸ³é¢‘æ’­æ”¾å™¨\"]\r\n         VisualPlayer[\"è§†è§‰è¡¨ç°å™¨\"]\r\n"
                },
                {
                    "date": 1767380831750,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n \r\n ## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n \r\n ```mermaid\r\n-flowchart TD\r\n+flowchart TB\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n         direction LR\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n"
                },
                {
                    "date": 1767380852440,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,9 @@\n \r\n ```mermaid\r\n flowchart TB\r\n     subgraph DataLayer[\"æ•°æ®å±‚ | DataLayer\"]\r\n-        direction LR\r\n+        direction TB\r\n         StoryConfig[\"å‰§æƒ…é…ç½®<br/>StoryConfig\"]\r\n         NodeConfig[\"èŠ‚ç‚¹é…ç½®<br/>NodeConfig\"]\r\n         DialogueConfig[\"å¯¹è¯é…ç½®<br/>DialogueConfig\"]\r\n         ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n"
                },
                {
                    "date": 1767380861826,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n         ResourceConfig[\"èµ„æºé…ç½®<br/>ResourceConfig\"]\r\n     end\r\n     \r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚ | ScriptLayer\"]\r\n-        direction LR\r\n+        direction TB\r\n         StoryParser[\"å‰§æƒ…è§£æå™¨<br/>StoryParser\"]\r\n         NodeGraph[\"èŠ‚ç‚¹å›¾ç®¡ç†<br/>NodeGraph\"]\r\n         ScriptValidator[\"è„šæœ¬éªŒè¯å™¨<br/>ScriptValidator\"]\r\n     end\r\n"
                },
                {
                    "date": 1767380871186,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,16 +25,16 @@\n         ScriptValidator[\"è„šæœ¬éªŒè¯å™¨<br/>ScriptValidator\"]\r\n     end\r\n     \r\n     subgraph ExecutionLayer[\"æ‰§è¡Œå±‚ | ExecutionLayer\"]\r\n-        direction LR\r\n+        direction TB\r\n         StoryExecutor[\"å‰§æƒ…æ‰§è¡Œå™¨<br/>StoryExecutor\"]\r\n         NodeExecutor[\"èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>NodeExecutor\"]\r\n         BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n     end\r\n     \r\n     subgraph StateLayer[\"çŠ¶æ€å±‚ | StateLayer\"]\r\n-        direction LR\r\n+        direction TB\r\n         StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n         StoryVariable[\"å‰§æƒ…å˜é‡<br/>StoryVariable\"]\r\n         StatePersistence[\"çŠ¶æ€æŒä¹…åŒ–<br/>StatePersistence\"]\r\n         StateSync[\"çŠ¶æ€åŒæ­¥å™¨<br/>StateSync<br/>åŒæ­¥å…¶ä»–æ¨¡å—çŠ¶æ€/æ•ˆæœ\"]\r\n"
                },
                {
                    "date": 1767381170531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,9 +40,9 @@\n         StateSync[\"çŠ¶æ€åŒæ­¥å™¨<br/>StateSync<br/>åŒæ­¥å…¶ä»–æ¨¡å—çŠ¶æ€/æ•ˆæœ\"]\r\n     end\r\n     \r\n     subgraph PresentationLayer[\"è¡¨ç°å±‚ | PresentationLayer\"]\r\n-        direction LR\r\n+        direction TB\r\n         TimelinePlayer[\"Timelineæ’­æ”¾å™¨\"]\r\n         UIPresenter[\"UIè¡¨ç°å™¨\"]\r\n         AudioPlayer[\"éŸ³é¢‘æ’­æ”¾å™¨\"]\r\n         VisualPlayer[\"è§†è§‰è¡¨ç°å™¨\"]\r\n@@ -51,12 +51,12 @@\n     DataLayer -->|åŠ è½½é…ç½®| ScriptLayer\r\n     ScriptLayer -->|è§£æå®Œæˆ| ExecutionLayer\r\n     ExecutionLayer -->|æ›´æ–°çŠ¶æ€| StateLayer\r\n     ExecutionLayer -->|è¯·æ±‚è¡¨ç°| PresentationLayer\r\n-    ExecutionLayer -->|åŒæ­¥è¯·æ±‚| StateLayer\r\n+    ExecutionLayer -->|è§¦å‘åŒæ­¥| StateLayer\r\n+    ExecutionLayer -.->|ä¼ é€’æ•ˆæœå‚æ•°| StateLayer\r\n     StateLayer -.->|æŸ¥è¯¢çŠ¶æ€| ExecutionLayer\r\n-    StateLayer -.->|è¯»å–æ•ˆæœå‚æ•°| DataLayer\r\n-    StateLayer -.->|åŒæ­¥å¤–éƒ¨çŠ¶æ€| ExecutionLayer\r\n+    StateLayer -.->|åŒæ­¥å¤–éƒ¨æ¨¡å—| ExternalModules[\"å¤–éƒ¨æ¨¡å—<br/>æ•ˆæœç³»ç»Ÿ/çŠ¶æ€ç³»ç»Ÿ\"]\r\n     PresentationLayer -.->|æ‰§è¡Œå®Œæˆ| ExecutionLayer\r\n     \r\n     style DataLayer fill:#e1f5ff,stroke:#01579b,stroke-width:2px\r\n     style ScriptLayer fill:#fff4e1,stroke:#e65100,stroke-width:2px\r\n"
                },
                {
                    "date": 1767381184470,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -51,12 +51,10 @@\n     DataLayer -->|åŠ è½½é…ç½®| ScriptLayer\r\n     ScriptLayer -->|è§£æå®Œæˆ| ExecutionLayer\r\n     ExecutionLayer -->|æ›´æ–°çŠ¶æ€| StateLayer\r\n     ExecutionLayer -->|è¯·æ±‚è¡¨ç°| PresentationLayer\r\n-    ExecutionLayer -->|è§¦å‘åŒæ­¥| StateLayer\r\n-    ExecutionLayer -.->|ä¼ é€’æ•ˆæœå‚æ•°| StateLayer\r\n+    ExecutionLayer -->|è§¦å‘åŒæ­¥<br/>ä¼ é€’æ•ˆæœå‚æ•°| StateLayer\r\n     StateLayer -.->|æŸ¥è¯¢çŠ¶æ€| ExecutionLayer\r\n-    StateLayer -.->|åŒæ­¥å¤–éƒ¨æ¨¡å—| ExternalModules[\"å¤–éƒ¨æ¨¡å—<br/>æ•ˆæœç³»ç»Ÿ/çŠ¶æ€ç³»ç»Ÿ\"]\r\n     PresentationLayer -.->|æ‰§è¡Œå®Œæˆ| ExecutionLayer\r\n     \r\n     style DataLayer fill:#e1f5ff,stroke:#01579b,stroke-width:2px\r\n     style ScriptLayer fill:#fff4e1,stroke:#e65100,stroke-width:2px\r\n"
                },
                {
                    "date": 1767381193537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,8 +83,11 @@\n ### 3. ç³»ç»Ÿè§£è€¦\r\n - è¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦ï¼Œé€šè¿‡å›è°ƒé€šä¿¡\r\n - çŠ¶æ€å±‚ç‹¬ç«‹ç®¡ç†ï¼Œæ”¯æŒä¿å­˜å’Œæ¢å¤\r\n - çŠ¶æ€åŒæ­¥å™¨é€šè¿‡é…ç½®çš„æ•ˆæœå‚æ•°ï¼Œä¸å…¶ä»–æ¨¡å—ï¼ˆæ•ˆæœç³»ç»Ÿã€çŠ¶æ€ç³»ç»Ÿç­‰ï¼‰è§£è€¦äº¤äº’\r\n+  - æ‰§è¡Œå±‚è§¦å‘åŒæ­¥æ—¶ï¼Œä¼ é€’èŠ‚ç‚¹é…ç½®ä¸­çš„æ•ˆæœå‚æ•°\r\n+  - çŠ¶æ€åŒæ­¥å™¨æ ¹æ®æ•ˆæœå‚æ•°ï¼Œè°ƒç”¨å¤–éƒ¨æ¨¡å—æ¥å£åŒæ­¥çŠ¶æ€/æ•ˆæœ\r\n+  - æ— éœ€çŠ¶æ€åŒæ­¥å™¨å›ä¼ ç»“æœï¼Œå®ç°å•å‘æ•°æ®æµ\r\n - ä¸ç°æœ‰ç³»ç»Ÿï¼ˆTimelineã€UIã€Audioï¼‰é€šè¿‡æ¥å£äº¤äº’\r\n \r\n ---\r\n \r\n"
                },
                {
                    "date": 1767381224739,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -446,8 +446,9 @@\n     subgraph StateLayer[\"çŠ¶æ€å±‚\"]\r\n         StateManager[\"çŠ¶æ€ç®¡ç†å™¨<br/>StoryStateManager\"]\r\n         ProgressTracker[\"è¿›åº¦è¿½è¸ªå™¨<br/>ProgressTracker\"]\r\n         SaveLoader[\"ä¿å­˜åŠ è½½å™¨<br/>SaveLoader\"]\r\n+        StateSync[\"çŠ¶æ€åŒæ­¥å™¨<br/>StateSync\"]\r\n     end\r\n     \r\n     subgraph StateData[\"çŠ¶æ€æ•°æ®\"]\r\n         StoryState[\"å‰§æƒ…çŠ¶æ€<br/>StoryState\"]\r\n@@ -464,12 +465,14 @@\n     StateManager --> StateData\r\n     ProgressTracker --> StateData\r\n     SaveLoader --> Persistence\r\n     Persistence --> StateData\r\n+    StateSync -.->|åŒæ­¥å¤–éƒ¨æ¨¡å—| ExternalModules[\"å¤–éƒ¨æ¨¡å—<br/>æ•ˆæœç³»ç»Ÿ/çŠ¶æ€ç³»ç»Ÿ\"]\r\n     \r\n     style StateLayer fill:#f3e5f5\r\n     style StateData fill:#c8e6c9\r\n     style Persistence fill:#e1f5ff\r\n+    style ExternalModules fill:#fff4e1\r\n ```\r\n \r\n ### çŠ¶æ€ç®¡ç†æµç¨‹\r\n \r\n@@ -517,8 +520,14 @@\n    - ä»å­˜æ¡£åŠ è½½å‰§æƒ…çŠ¶æ€\r\n    - æ”¯æŒå¢é‡ä¿å­˜ï¼ˆåªä¿å­˜å˜æ›´ï¼‰\r\n    - æ”¯æŒç‰ˆæœ¬å…¼å®¹ï¼ˆæ—§å­˜æ¡£å…¼å®¹ï¼‰\r\n \r\n+4. **çŠ¶æ€åŒæ­¥å™¨ï¼ˆStateSyncï¼‰**\r\n+   - æ¥æ”¶æ‰§è¡Œå±‚çš„åŒæ­¥è¯·æ±‚å’Œæ•ˆæœå‚æ•°\r\n+   - æ ¹æ®æ•ˆæœå‚æ•°é…ç½®ï¼Œè°ƒç”¨å¤–éƒ¨æ¨¡å—æ¥å£åŒæ­¥çŠ¶æ€/æ•ˆæœ\r\n+   - æ”¯æŒåŒæ­¥æ•ˆæœç³»ç»Ÿã€çŠ¶æ€ç³»ç»Ÿç­‰å…¶ä»–æ¨¡å—\r\n+   - å®ç°å•å‘æ•°æ®æµï¼Œæ— éœ€å›ä¼ ç»“æœç»™æ‰§è¡Œå±‚\r\n+\r\n ---\r\n \r\n ## æ•°æ®å±‚æ¶æ„è®¾è®¡\r\n \r\n"
                },
                {
                    "date": 1767381403810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -156,8 +156,9 @@\n \r\n ```mermaid\r\n graph TB\r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚\"]\r\n+        direction TB\r\n         ScriptParser[\"è„šæœ¬è§£æå™¨<br/>StoryScriptParser\"]\r\n         NodeGraphBuilder[\"èŠ‚ç‚¹å›¾æ„å»ºå™¨<br/>NodeGraphBuilder\"]\r\n         NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381415671,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,13 +163,15 @@\n         NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n     end\r\n     \r\n     subgraph DataSource[\"æ•°æ®æº\"]\r\n+        direction TB\r\n         StoryConfig[\"StoryConfig<br/>å‰§æƒ…é…ç½®\"]\r\n         NodeConfig[\"NodeConfig<br/>èŠ‚ç‚¹é…ç½®\"]\r\n     end\r\n     \r\n     subgraph NodeGraph[\"èŠ‚ç‚¹å›¾ç»“æ„\"]\r\n+        direction TB\r\n         Nodes[\"èŠ‚ç‚¹åˆ—è¡¨<br/>nodes\"]\r\n         Edges[\"è¿æ¥å…³ç³»<br/>edges\"]\r\n         EntryNode[\"å…¥å£èŠ‚ç‚¹<br/>entryNode\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381436921,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -169,9 +169,8 @@\n         NodeConfig[\"NodeConfig<br/>èŠ‚ç‚¹é…ç½®\"]\r\n     end\r\n     \r\n     subgraph NodeGraph[\"èŠ‚ç‚¹å›¾ç»“æ„\"]\r\n-        direction TB\r\n         Nodes[\"èŠ‚ç‚¹åˆ—è¡¨<br/>nodes\"]\r\n         Edges[\"è¿æ¥å…³ç³»<br/>edges\"]\r\n         EntryNode[\"å…¥å£èŠ‚ç‚¹<br/>entryNode\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381443048,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -169,8 +169,9 @@\n         NodeConfig[\"NodeConfig<br/>èŠ‚ç‚¹é…ç½®\"]\r\n     end\r\n     \r\n     subgraph NodeGraph[\"èŠ‚ç‚¹å›¾ç»“æ„\"]\r\n+        direction TB\r\n         Nodes[\"èŠ‚ç‚¹åˆ—è¡¨<br/>nodes\"]\r\n         Edges[\"è¿æ¥å…³ç³»<br/>edges\"]\r\n         EntryNode[\"å…¥å£èŠ‚ç‚¹<br/>entryNode\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381451582,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -156,9 +156,8 @@\n \r\n ```mermaid\r\n graph TB\r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚\"]\r\n-        direction TB\r\n         ScriptParser[\"è„šæœ¬è§£æå™¨<br/>StoryScriptParser\"]\r\n         NodeGraphBuilder[\"èŠ‚ç‚¹å›¾æ„å»ºå™¨<br/>NodeGraphBuilder\"]\r\n         NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381461954,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -156,8 +156,9 @@\n \r\n ```mermaid\r\n graph TB\r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚\"]\r\n+        direction TD\r\n         ScriptParser[\"è„šæœ¬è§£æå™¨<br/>StoryScriptParser\"]\r\n         NodeGraphBuilder[\"èŠ‚ç‚¹å›¾æ„å»ºå™¨<br/>NodeGraphBuilder\"]\r\n         NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381482516,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -156,9 +156,9 @@\n \r\n ```mermaid\r\n graph TB\r\n     subgraph ScriptLayer[\"è„šæœ¬å±‚\"]\r\n-        direction TD\r\n+        direction LR\r\n         ScriptParser[\"è„šæœ¬è§£æå™¨<br/>StoryScriptParser\"]\r\n         NodeGraphBuilder[\"èŠ‚ç‚¹å›¾æ„å»ºå™¨<br/>NodeGraphBuilder\"]\r\n         NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n     end\r\n"
                },
                {
                    "date": 1767381581189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -205,27 +205,61 @@\n    - èŠ‚ç‚¹å·¥å‚æ¨¡å¼ï¼ˆåˆ›å»ºèŠ‚ç‚¹æ‰§è¡Œå™¨ï¼‰\r\n \r\n ### èŠ‚ç‚¹ç±»å‹å®šä¹‰\r\n \r\n+**è®¾è®¡ç†å¿µ**ï¼šå‚è€ƒæˆ˜æ–—æ¶æ„è®¾è®¡ï¼ŒèŠ‚ç‚¹æŒ‰èŒè´£åˆ†ä¸ºå››ç±»ï¼Œæ¯ç±»èŠ‚ç‚¹èŒè´£å•ä¸€ã€å¯å¤ç”¨\r\n+\r\n+#### èŠ‚ç‚¹åˆ†ç±»\r\n+\r\n+- **è¾“å…¥èŠ‚ç‚¹ï¼ˆInput Nodeï¼‰**ï¼šè´Ÿè´£æ¥æ”¶ç©å®¶è¾“å…¥ï¼ˆå¦‚ï¼šæ¥æ”¶åˆ†æ”¯é€‰æ‹©ã€æ¥æ”¶å¯¹è¯ç¡®è®¤ã€æ¥æ”¶è·³è¿‡æ“ä½œç­‰ï¼‰\r\n+- **æ¡ä»¶èŠ‚ç‚¹ï¼ˆCondition Nodeï¼‰**ï¼šè´Ÿè´£éªŒè¯ã€æ£€æŸ¥ã€åˆ¤æ–­ï¼Œè¿”å›åˆ¤æ–­ç»“æœå’Œæµç¨‹æ§åˆ¶å»ºè®®ï¼ˆå¦‚ï¼šæ£€æŸ¥å‰§æƒ…å˜é‡ã€éªŒè¯åˆ†æ”¯æ¡ä»¶ã€æ£€æŸ¥å‰ç½®æ¡ä»¶ç­‰ï¼‰\r\n+- **æ‰§è¡ŒèŠ‚ç‚¹ï¼ˆExecution Nodeï¼‰**ï¼šè´Ÿè´£å®é™…æ‰§è¡Œæ“ä½œï¼Œä¿®æ”¹æ•°æ®ï¼ˆå¦‚ï¼šæ‰§è¡Œå¯¹è¯é€»è¾‘ã€æ‰§è¡ŒåŠ¨ä½œé€»è¾‘ã€æ›´æ–°å‰§æƒ…å˜é‡ã€è§¦å‘æ•ˆæœåŒæ­¥ç­‰ï¼‰\r\n+- **å¯è§†åŒ–èŠ‚ç‚¹ï¼ˆVisual Nodeï¼‰**ï¼šè´Ÿè´£è¡¨ç°æ’­æ”¾ï¼ˆå¦‚ï¼šæ’­æ”¾å¯¹è¯UIã€æ’­æ”¾Timelineã€æ’­æ”¾éŸ³é¢‘ã€æ’­æ”¾åŠ¨ç”»/ç‰¹æ•ˆç­‰ï¼‰\r\n+\r\n ```mermaid\r\n graph TB\r\n     subgraph NodeTypes[\"èŠ‚ç‚¹ç±»å‹\"]\r\n-        DialogueNode[\"å¯¹è¯èŠ‚ç‚¹<br/>DialogueNode\"]\r\n-        ActionNode[\"åŠ¨ä½œèŠ‚ç‚¹<br/>ActionNode\"]\r\n-        BranchNode[\"åˆ†æ”¯èŠ‚ç‚¹<br/>BranchNode\"]\r\n-        ConditionNode[\"æ¡ä»¶èŠ‚ç‚¹<br/>ConditionNode\"]\r\n-        TimelineNode[\"TimelineèŠ‚ç‚¹<br/>TimelineNode\"]\r\n-        EndNode[\"ç»“æŸèŠ‚ç‚¹<br/>EndNode\"]\r\n+        subgraph InputNodes[\"è¾“å…¥èŠ‚ç‚¹ç»„<br/>Input Nodes\"]\r\n+            ReceiveBranchSelectNode[\"æ¥æ”¶åˆ†æ”¯é€‰æ‹©èŠ‚ç‚¹<br/>ReceiveBranchSelectNode\"]\r\n+            ReceiveDialogueConfirmNode[\"æ¥æ”¶å¯¹è¯ç¡®è®¤èŠ‚ç‚¹<br/>ReceiveDialogueConfirmNode\"]\r\n+            ReceiveSkipNode[\"æ¥æ”¶è·³è¿‡æ“ä½œèŠ‚ç‚¹<br/>ReceiveSkipNode\"]\r\n+        end\r\n+        \r\n+        subgraph ConditionNodes[\"æ¡ä»¶èŠ‚ç‚¹ç»„<br/>Condition Nodes\"]\r\n+            CheckVariableNode[\"æ£€æŸ¥å‰§æƒ…å˜é‡èŠ‚ç‚¹<br/>CheckVariableNode\"]\r\n+            CheckBranchConditionNode[\"æ£€æŸ¥åˆ†æ”¯æ¡ä»¶èŠ‚ç‚¹<br/>CheckBranchConditionNode\"]\r\n+            CheckPreconditionNode[\"æ£€æŸ¥å‰ç½®æ¡ä»¶èŠ‚ç‚¹<br/>CheckPreconditionNode\"]\r\n+            ValidateNodeExecutableNode[\"éªŒè¯èŠ‚ç‚¹å¯æ‰§è¡ŒèŠ‚ç‚¹<br/>ValidateNodeExecutableNode\"]\r\n+        end\r\n+        \r\n+        subgraph ExecutionNodes[\"æ‰§è¡ŒèŠ‚ç‚¹ç»„<br/>Execution Nodes\"]\r\n+            ExecuteDialogueNode[\"æ‰§è¡Œå¯¹è¯é€»è¾‘èŠ‚ç‚¹<br/>ExecuteDialogueNode\"]\r\n+            ExecuteActionNode[\"æ‰§è¡ŒåŠ¨ä½œé€»è¾‘èŠ‚ç‚¹<br/>ExecuteActionNode\"]\r\n+            UpdateVariableNode[\"æ›´æ–°å‰§æƒ…å˜é‡èŠ‚ç‚¹<br/>UpdateVariableNode\"]\r\n+            TriggerEffectNode[\"è§¦å‘æ•ˆæœåŒæ­¥èŠ‚ç‚¹<br/>TriggerEffectNode\"]\r\n+            JumpStoryNode[\"æ‰§è¡Œå‰§æƒ…è·³è½¬èŠ‚ç‚¹<br/>JumpStoryNode\"]\r\n+            EndStoryNode[\"ç»“æŸå‰§æƒ…èŠ‚ç‚¹<br/>EndStoryNode\"]\r\n+        end\r\n+        \r\n+        subgraph VisualNodes[\"å¯è§†åŒ–èŠ‚ç‚¹ç»„<br/>Visual Nodes\"]\r\n+            PlayDialogueUINode[\"æ’­æ”¾å¯¹è¯UIèŠ‚ç‚¹<br/>PlayDialogueUINode\"]\r\n+            PlayTimelineNode[\"æ’­æ”¾TimelineèŠ‚ç‚¹<br/>PlayTimelineNode\"]\r\n+            PlayAudioNode[\"æ’­æ”¾éŸ³é¢‘èŠ‚ç‚¹<br/>PlayAudioNode\"]\r\n+            PlayAnimationNode[\"æ’­æ”¾åŠ¨ç”»èŠ‚ç‚¹<br/>PlayAnimationNode\"]\r\n+            PlayVFXNode[\"æ’­æ”¾ç‰¹æ•ˆèŠ‚ç‚¹<br/>PlayVFXNode\"]\r\n+        end\r\n     end\r\n     \r\n-    DialogueNode -->|ç»§æ‰¿| BaseNode\r\n-    ActionNode -->|ç»§æ‰¿| BaseNode\r\n-    BranchNode -->|ç»§æ‰¿| BaseNode\r\n-    ConditionNode -->|ç»§æ‰¿| BaseNode\r\n-    TimelineNode -->|ç»§æ‰¿| BaseNode\r\n-    EndNode -->|ç»§æ‰¿| BaseNode\r\n+    InputNodes -->|ç»§æ‰¿| BaseNode\r\n+    ConditionNodes -->|ç»§æ‰¿| BaseNode\r\n+    ExecutionNodes -->|ç»§æ‰¿| BaseNode\r\n+    VisualNodes -->|ç»§æ‰¿| BaseNode\r\n     \r\n     style BaseNode fill:#fff4e1\r\n+    style InputNodes fill:#ffebee\r\n+    style ConditionNodes fill:#fff4e1\r\n+    style ExecutionNodes fill:#c8e6c9\r\n+    style VisualNodes fill:#f3e5f5\r\n ```\r\n \r\n ---\r\n \r\n"
                },
                {
                    "date": 1767381611230,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -274,71 +274,101 @@\n ```mermaid\r\n graph TB\r\n     subgraph ExecutionLayer[\"æ‰§è¡Œå±‚\"]\r\n         StoryExecutor[\"å‰§æƒ…æ‰§è¡Œå™¨<br/>StoryExecutor\"]\r\n-        NodeExecutor[\"èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>NodeExecutor\"]\r\n-        BranchSelector[\"åˆ†æ”¯é€‰æ‹©å™¨<br/>BranchSelector\"]\r\n-        ConditionChecker[\"æ¡ä»¶æ£€æŸ¥å™¨<br/>ConditionChecker\"]\r\n+        NodeOrchestrator[\"èŠ‚ç‚¹ç¼–æ’å™¨<br/>NodeOrchestrator\"]\r\n+        \r\n+        subgraph NodeRegistry[\"èŠ‚ç‚¹æ³¨å†Œè¡¨<br/>NodeRegistry\"]\r\n+            subgraph InputNodes[\"è¾“å…¥èŠ‚ç‚¹ç»„\"]\r\n+                ReceiveBranchSelectNode[\"æ¥æ”¶åˆ†æ”¯é€‰æ‹©èŠ‚ç‚¹\"]\r\n+                ReceiveDialogueConfirmNode[\"æ¥æ”¶å¯¹è¯ç¡®è®¤èŠ‚ç‚¹\"]\r\n+            end\r\n+            \r\n+            subgraph ConditionNodes[\"æ¡ä»¶èŠ‚ç‚¹ç»„\"]\r\n+                CheckVariableNode[\"æ£€æŸ¥å‰§æƒ…å˜é‡èŠ‚ç‚¹\"]\r\n+                CheckBranchConditionNode[\"æ£€æŸ¥åˆ†æ”¯æ¡ä»¶èŠ‚ç‚¹\"]\r\n+                CheckPreconditionNode[\"æ£€æŸ¥å‰ç½®æ¡ä»¶èŠ‚ç‚¹\"]\r\n+            end\r\n+            \r\n+            subgraph ExecutionNodes[\"æ‰§è¡ŒèŠ‚ç‚¹ç»„\"]\r\n+                ExecuteDialogueNode[\"æ‰§è¡Œå¯¹è¯é€»è¾‘èŠ‚ç‚¹\"]\r\n+                ExecuteActionNode[\"æ‰§è¡ŒåŠ¨ä½œé€»è¾‘èŠ‚ç‚¹\"]\r\n+                UpdateVariableNode[\"æ›´æ–°å‰§æƒ…å˜é‡èŠ‚ç‚¹\"]\r\n+                TriggerEffectNode[\"è§¦å‘æ•ˆæœåŒæ­¥èŠ‚ç‚¹\"]\r\n+            end\r\n+            \r\n+            subgraph VisualNodes[\"å¯è§†åŒ–èŠ‚ç‚¹ç»„\"]\r\n+                PlayDialogueUINode[\"æ’­æ”¾å¯¹è¯UIèŠ‚ç‚¹\"]\r\n+                PlayTimelineNode[\"æ’­æ”¾TimelineèŠ‚ç‚¹\"]\r\n+                PlayAudioNode[\"æ’­æ”¾éŸ³é¢‘èŠ‚ç‚¹\"]\r\n+            end\r\n+        end\r\n+        \r\n+        ContextManager[\"ä¸Šä¸‹æ–‡ç®¡ç†å™¨<br/>ContextManager\"]\r\n     end\r\n     \r\n     subgraph NodeState[\"èŠ‚ç‚¹çŠ¶æ€\"]\r\n         CurrentNode[\"å½“å‰èŠ‚ç‚¹<br/>currentNode\"]\r\n         NodeStack[\"èŠ‚ç‚¹æ ˆ<br/>nodeStack\"]\r\n         ExecutionContext[\"æ‰§è¡Œä¸Šä¸‹æ–‡<br/>executionContext\"]\r\n     end\r\n     \r\n-    subgraph BranchLogic[\"åˆ†æ”¯é€»è¾‘\"]\r\n-        BranchList[\"åˆ†æ”¯åˆ—è¡¨<br/>branchList\"]\r\n-        ConditionList[\"æ¡ä»¶åˆ—è¡¨<br/>conditionList\"]\r\n-        SelectedBranch[\"é€‰ä¸­åˆ†æ”¯<br/>selectedBranch\"]\r\n-    end\r\n+    StoryExecutor --> NodeOrchestrator\r\n+    NodeOrchestrator --> NodeRegistry\r\n+    NodeOrchestrator --> ContextManager\r\n+    NodeOrchestrator --> NodeState\r\n     \r\n-    StoryExecutor --> NodeExecutor\r\n-    StoryExecutor --> BranchSelector\r\n-    BranchSelector --> ConditionChecker\r\n-    NodeExecutor --> NodeState\r\n-    BranchSelector --> BranchLogic\r\n-    \r\n     style ExecutionLayer fill:#fff4e1\r\n+    style NodeRegistry fill:#e1f5ff\r\n     style NodeState fill:#c8e6c9\r\n-    style BranchLogic fill:#e1f5ff\r\n+    style InputNodes fill:#ffebee\r\n+    style ConditionNodes fill:#fff4e1\r\n+    style ExecutionNodes fill:#c8e6c9\r\n+    style VisualNodes fill:#f3e5f5\r\n ```\r\n \r\n ### å·¥ä½œæµç¨‹\r\n \r\n+**è®¾è®¡ç†å¿µ**ï¼šèŠ‚ç‚¹ç¼–æ’å™¨æ ¹æ®é…ç½®åŠ¨æ€ç»„ç»‡èŠ‚ç‚¹æ‰§è¡Œï¼Œæµç¨‹æ§åˆ¶æ ¹æ®èŠ‚ç‚¹æ‰§è¡Œç»“æœå†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹\r\n+\r\n ```mermaid\r\n flowchart TD\r\n     Start[å‰§æƒ…å¼€å§‹] --> Load[åŠ è½½èŠ‚ç‚¹å›¾]\r\n     Load --> Init[åˆå§‹åŒ–æ‰§è¡Œå™¨]\r\n     Init --> GetEntry[è·å–å…¥å£èŠ‚ç‚¹]\r\n-    GetEntry --> Execute[æ‰§è¡Œå½“å‰èŠ‚ç‚¹]\r\n+    GetEntry --> Orchestrate[èŠ‚ç‚¹ç¼–æ’å™¨æ‰§è¡ŒèŠ‚ç‚¹åºåˆ—]\r\n     \r\n-    Execute --> CheckType{èŠ‚ç‚¹ç±»å‹?}\r\n-    CheckType -->|å¯¹è¯èŠ‚ç‚¹| Dialogue[æ‰§è¡Œå¯¹è¯]\r\n-    CheckType -->|åŠ¨ä½œèŠ‚ç‚¹| Action[æ‰§è¡ŒåŠ¨ä½œ]\r\n-    CheckType -->|åˆ†æ”¯èŠ‚ç‚¹| Branch[é€‰æ‹©åˆ†æ”¯]\r\n-    CheckType -->|TimelineèŠ‚ç‚¹| Timeline[æ’­æ”¾Timeline]\r\n-    CheckType -->|ç»“æŸèŠ‚ç‚¹| End[ç»“æŸå‰§æƒ…]\r\n+    Orchestrate --> CheckNodeType{èŠ‚ç‚¹ç±»å‹?}\r\n     \r\n-    Dialogue --> Wait[ç­‰å¾…å®Œæˆ]\r\n-    Action --> Wait\r\n-    Timeline --> Wait\r\n+    CheckNodeType -->|æ¡ä»¶èŠ‚ç‚¹| Condition[æ‰§è¡Œæ¡ä»¶æ£€æŸ¥]\r\n+    CheckNodeType -->|è¾“å…¥èŠ‚ç‚¹| Input[æ¥æ”¶ç©å®¶è¾“å…¥]\r\n+    CheckNodeType -->|æ‰§è¡ŒèŠ‚ç‚¹| Execution[æ‰§è¡Œé€»è¾‘æ“ä½œ]\r\n+    CheckNodeType -->|å¯è§†åŒ–èŠ‚ç‚¹| Visual[æ’­æ”¾è¡¨ç°æ•ˆæœ]\r\n     \r\n-    Wait --> CheckBranch{æœ‰åˆ†æ”¯?}\r\n-    CheckBranch -->|æ˜¯| Select[é€‰æ‹©åˆ†æ”¯]\r\n-    CheckBranch -->|å¦| Next[ä¸‹ä¸€ä¸ªèŠ‚ç‚¹]\r\n+    Condition --> CheckResult{æ¡ä»¶ç»“æœ?}\r\n+    CheckResult -->|æ»¡è¶³| NextNode[ä¸‹ä¸€ä¸ªèŠ‚ç‚¹]\r\n+    CheckResult -->|ä¸æ»¡è¶³| SkipNode[è·³è¿‡åç»­èŠ‚ç‚¹]\r\n     \r\n-    Select --> CheckCondition{æ£€æŸ¥æ¡ä»¶}\r\n-    CheckCondition -->|æ»¡è¶³| Next\r\n-    CheckCondition -->|ä¸æ»¡è¶³| Select\r\n+    Input --> WaitInput[ç­‰å¾…è¾“å…¥å®Œæˆ]\r\n+    WaitInput --> NextNode\r\n     \r\n-    Next --> Execute\r\n-    End --> Save[ä¿å­˜çŠ¶æ€]\r\n+    Execution --> UpdateState[æ›´æ–°çŠ¶æ€]\r\n+    UpdateState --> NextNode\r\n+    \r\n+    Visual --> WaitVisual[ç­‰å¾…è¡¨ç°å®Œæˆ]\r\n+    WaitVisual --> NextNode\r\n+    \r\n+    NextNode --> CheckEnd{æ˜¯å¦ç»“æŸ?}\r\n+    CheckEnd -->|å¦| Orchestrate\r\n+    CheckEnd -->|æ˜¯| Save[ä¿å­˜çŠ¶æ€]\r\n     Save --> Finish[å®Œæˆ]\r\n     \r\n-    style Execute fill:#fff4e1,stroke:#333,stroke-width:2px\r\n-    style CheckBranch fill:#fff4e1,stroke:#333,stroke-width:2px\r\n-    style CheckCondition fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    SkipNode --> CheckEnd\r\n+    \r\n+    style Orchestrate fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style CheckNodeType fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style CheckResult fill:#fff4e1,stroke:#333,stroke-width:2px\r\n+    style CheckEnd fill:#fff4e1,stroke:#333,stroke-width:2px\r\n ```\r\n \r\n ### æ ¸å¿ƒç»„ä»¶\r\n \r\n"
                },
                {
                    "date": 1767381622597,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -377,26 +377,33 @@\n    - æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œæµç¨‹\r\n    - å¤„ç†èŠ‚ç‚¹è·³è½¬\r\n    - ç®¡ç†èŠ‚ç‚¹æ ˆï¼ˆæ”¯æŒåµŒå¥—å‰§æƒ…ï¼‰\r\n \r\n-2. **èŠ‚ç‚¹æ‰§è¡Œå™¨ï¼ˆNodeExecutorï¼‰**\r\n-   - æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘\r\n-   - è°ƒç”¨è¡¨ç°å±‚æ’­æ”¾è¡¨ç°\r\n-   - ç­‰å¾…èŠ‚ç‚¹å®Œæˆ\r\n-   - è§¦å‘èŠ‚ç‚¹å®Œæˆäº‹ä»¶\r\n+2. **èŠ‚ç‚¹ç¼–æ’å™¨ï¼ˆNodeOrchestratorï¼‰**\r\n+   - ç®¡ç†èŠ‚ç‚¹æ³¨å†Œè¡¨ï¼ˆNodeRegistryï¼‰\r\n+   - æ ¹æ®é…ç½®åŠ¨æ€ç»„ç»‡èŠ‚ç‚¹æ‰§è¡Œ\r\n+   - æ ¹æ®èŠ‚ç‚¹æ‰§è¡Œç»“æœå†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹\r\n+   - ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆContextï¼‰\r\n+   - æ”¯æŒèŠ‚ç‚¹åºåˆ—ç¼–æ’ï¼ˆæ¡ä»¶èŠ‚ç‚¹ â†’ æ‰§è¡ŒèŠ‚ç‚¹ â†’ å¯è§†åŒ–èŠ‚ç‚¹ï¼‰\r\n \r\n-3. **åˆ†æ”¯é€‰æ‹©å™¨ï¼ˆBranchSelectorï¼‰**\r\n-   - è§£æåˆ†æ”¯åˆ—è¡¨\r\n-   - æ£€æŸ¥åˆ†æ”¯æ¡ä»¶\r\n-   - é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„åˆ†æ”¯\r\n-   - å¤„ç†ç©å®¶é€‰æ‹©åˆ†æ”¯\r\n+3. **èŠ‚ç‚¹æ³¨å†Œè¡¨ï¼ˆNodeRegistryï¼‰**\r\n+   - æ³¨å†Œå››ç±»èŠ‚ç‚¹ï¼ˆè¾“å…¥èŠ‚ç‚¹ã€æ¡ä»¶èŠ‚ç‚¹ã€æ‰§è¡ŒèŠ‚ç‚¹ã€å¯è§†åŒ–èŠ‚ç‚¹ï¼‰\r\n+   - èŠ‚ç‚¹ç±»å‹æ˜ å°„ï¼ˆnodeType â†’ NodeExecutorï¼‰\r\n+   - èŠ‚ç‚¹å·¥å‚æ¨¡å¼ï¼ˆåˆ›å»ºèŠ‚ç‚¹æ‰§è¡Œå™¨ï¼‰\r\n+   - æ”¯æŒåŠ¨æ€æ³¨å†Œæ–°èŠ‚ç‚¹ç±»å‹\r\n \r\n-4. **æ¡ä»¶æ£€æŸ¥å™¨ï¼ˆConditionCheckerï¼‰**\r\n-   - æ£€æŸ¥èŠ‚ç‚¹æ¡ä»¶ï¼ˆå‰ç½®æ¡ä»¶ï¼‰\r\n-   - æ£€æŸ¥åˆ†æ”¯æ¡ä»¶ï¼ˆåˆ†æ”¯é€‰æ‹©ï¼‰\r\n-   - ä½¿ç”¨ Condition ç³»ç»Ÿç»Ÿä¸€æ£€æŸ¥\r\n-   - è¿”å›æ¡ä»¶æ£€æŸ¥ç»“æœ\r\n+4. **èŠ‚ç‚¹æ‰§è¡Œå™¨ï¼ˆNodeExecutorï¼‰**\r\n+   - ç»Ÿä¸€çš„èŠ‚ç‚¹æ‰§è¡Œæ¥å£\r\n+   - è¾“å…¥èŠ‚ç‚¹ï¼šæ¥æ”¶ç©å®¶è¾“å…¥ï¼Œç­‰å¾…è¾“å…¥å®Œæˆ\r\n+   - æ¡ä»¶èŠ‚ç‚¹ï¼šæ‰§è¡Œæ¡ä»¶æ£€æŸ¥ï¼Œè¿”å›åˆ¤æ–­ç»“æœ\r\n+   - æ‰§è¡ŒèŠ‚ç‚¹ï¼šæ‰§è¡Œé€»è¾‘æ“ä½œï¼Œä¿®æ”¹æ•°æ®çŠ¶æ€\r\n+   - å¯è§†åŒ–èŠ‚ç‚¹ï¼šè°ƒç”¨è¡¨ç°å±‚æ’­æ”¾è¡¨ç°ï¼Œç­‰å¾…è¡¨ç°å®Œæˆ\r\n \r\n+5. **ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆContextManagerï¼‰**\r\n+   - ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆStoryContextï¼‰\r\n+   - åœ¨èŠ‚ç‚¹é—´ä¼ é€’æ•°æ®\r\n+   - æ”¯æŒä¸Šä¸‹æ–‡å¢å¼ºï¼ˆç®¡é“è¿‡æ»¤å™¨æ¨¡å¼ï¼‰\r\n+\r\n ---\r\n \r\n ## è¡¨ç°å±‚æ¶æ„è®¾è®¡\r\n \r\n"
                },
                {
                    "date": 1767381637353,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,15 +92,18 @@\n ---\r\n \r\n ## æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n \r\n-### 1. è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ\r\n+### 1. è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ + èŠ‚ç‚¹ç¼–æ’\r\n \r\n-**æœ¬è´¨**ï¼šå‰§æƒ…æ¼”å‡ºç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯è„šæœ¬è§£æå’Œæ‰§è¡Œ\r\n+**æœ¬è´¨**ï¼šå‰§æƒ…æ¼”å‡ºç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯è„šæœ¬è§£æå’Œæ‰§è¡Œï¼Œé€šè¿‡èŠ‚ç‚¹ç¼–æ’å®ç°çµæ´»æµç¨‹æ§åˆ¶\r\n - å‰§æƒ…è„šæœ¬ = å¯¹è¯æ ‘ã€èŠ‚ç‚¹å›¾ç­‰ç»“æ„åŒ–æ•°æ®\r\n - èŠ‚ç‚¹è¿æ¥ = é€šè¿‡ nextNodeIdã€branchList ç­‰å­—æ®µå®šä¹‰è¿æ¥å…³ç³»\r\n - æ¡ä»¶åˆ†æ”¯ = é€šè¿‡ conditions å­—æ®µå®ç°æ¡ä»¶åˆ¤æ–­å’Œåˆ†æ”¯é€‰æ‹©\r\n - è„šæœ¬è§£æ = å°†é…ç½®æ•°æ®è§£æä¸ºå¯æ‰§è¡Œçš„èŠ‚ç‚¹å›¾ç»“æ„\r\n+- èŠ‚ç‚¹ç¼–æ’ = èŠ‚ç‚¹ç¼–æ’å™¨æ ¹æ®é…ç½®åŠ¨æ€ç»„ç»‡èŠ‚ç‚¹æ‰§è¡Œ\r\n+- æµç¨‹æ§åˆ¶ = èŠ‚ç‚¹ç¼–æ’å™¨æ ¹æ®èŠ‚ç‚¹æ‰§è¡Œç»“æœå†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹\r\n+- èŠ‚ç‚¹åˆ†ç±» = è¾“å…¥èŠ‚ç‚¹ã€æ¡ä»¶èŠ‚ç‚¹ã€æ‰§è¡ŒèŠ‚ç‚¹ã€å¯è§†åŒ–èŠ‚ç‚¹å››ç±»ï¼ŒèŒè´£å•ä¸€ã€å¯å¤ç”¨\r\n \r\n ### 2. æ•°æ®é©±åŠ¨æ¶æ„\r\n \r\n **æœ¬è´¨**ï¼šå‰§æƒ…ç‰¹æ€§é€šè¿‡é…ç½®æ•°æ®å®ç°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç \r\n"
                },
                {
                    "date": 1767381656403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -976,12 +976,15 @@\n - âœ… **èŠ‚ç‚¹ç±»å‹ä¸°å¯Œ**ï¼šå¯¹è¯ã€åŠ¨ä½œã€åˆ†æ”¯ã€æ¡ä»¶ã€Timeline ç­‰å¤šç§èŠ‚ç‚¹ç±»å‹\r\n - âœ… **çµæ´»è¿æ¥**ï¼šæ”¯æŒçº¿æ€§ã€åˆ†æ”¯ã€å¾ªç¯ç­‰å¤šç§è¿æ¥æ–¹å¼\r\n - âœ… **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹é…ç½®é€šè¿‡æ•°æ®å±‚ç®¡ç†\r\n \r\n-### 2. æ‰§è¡Œå±‚ï¼šèŠ‚ç‚¹æ‰§è¡Œä¸åˆ†æ”¯ç®¡ç†\r\n+### 2. æ‰§è¡Œå±‚ï¼šèŠ‚ç‚¹ç¼–æ’ä¸æµç¨‹æ§åˆ¶\r\n \r\n **è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n-- âœ… **ç»Ÿä¸€æ‰§è¡Œå™¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç±»å‹ä½¿ç”¨ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£\r\n+- âœ… **èŠ‚ç‚¹ç¼–æ’å™¨**ï¼šèŠ‚ç‚¹ç¼–æ’å™¨æ ¹æ®é…ç½®åŠ¨æ€ç»„ç»‡èŠ‚ç‚¹æ‰§è¡Œ\r\n+- âœ… **èŠ‚ç‚¹åˆ†ç±»**ï¼šè¾“å…¥èŠ‚ç‚¹ã€æ¡ä»¶èŠ‚ç‚¹ã€æ‰§è¡ŒèŠ‚ç‚¹ã€å¯è§†åŒ–èŠ‚ç‚¹å››ç±»ï¼ŒèŒè´£å•ä¸€ã€å¯å¤ç”¨\r\n+- âœ… **ç»Ÿä¸€æ‰§è¡Œæ¥å£**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç±»å‹ä½¿ç”¨ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£\r\n+- âœ… **æµç¨‹æ§åˆ¶**ï¼šèŠ‚ç‚¹ç¼–æ’å™¨æ ¹æ®èŠ‚ç‚¹æ‰§è¡Œç»“æœå†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹\r\n - âœ… **åˆ†æ”¯é€‰æ‹©**ï¼šæ”¯æŒæ¡ä»¶åˆ†æ”¯å’Œç©å®¶é€‰æ‹©åˆ†æ”¯\r\n - âœ… **èŠ‚ç‚¹æ ˆç®¡ç†**ï¼šæ”¯æŒåµŒå¥—å‰§æƒ…ï¼ˆå‰§æƒ…A â†’ å‰§æƒ…B â†’ è¿”å›å‰§æƒ…Aï¼‰\r\n - âœ… **çŠ¶æ€é©±åŠ¨**ï¼šé€šè¿‡çŠ¶æ€ç®¡ç†æ§åˆ¶æ‰§è¡Œæµç¨‹\r\n \r\n"
                },
                {
                    "date": 1767381667141,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -972,9 +972,10 @@\n ### 1. è„šæœ¬å±‚ï¼šå¯¹è¯æ ‘/èŠ‚ç‚¹å›¾\r\n \r\n **è®¾è®¡ç‰¹ç‚¹**ï¼š\r\n - âœ… **ç»“æ„åŒ–è„šæœ¬**ï¼šæ”¯æŒå¯¹è¯æ ‘ã€èŠ‚ç‚¹å›¾ç­‰ç»“æ„åŒ–æ•°æ®\r\n-- âœ… **èŠ‚ç‚¹ç±»å‹ä¸°å¯Œ**ï¼šå¯¹è¯ã€åŠ¨ä½œã€åˆ†æ”¯ã€æ¡ä»¶ã€Timeline ç­‰å¤šç§èŠ‚ç‚¹ç±»å‹\r\n+- âœ… **èŠ‚ç‚¹åˆ†ç±»æ¸…æ™°**ï¼šæŒ‰èŒè´£åˆ†ä¸ºè¾“å…¥èŠ‚ç‚¹ã€æ¡ä»¶èŠ‚ç‚¹ã€æ‰§è¡ŒèŠ‚ç‚¹ã€å¯è§†åŒ–èŠ‚ç‚¹å››ç±»\r\n+- âœ… **èŠ‚ç‚¹ç±»å‹ä¸°å¯Œ**ï¼šæ¯ç±»èŠ‚ç‚¹ä¸‹æœ‰å¤šä¸ªå…·ä½“èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚ï¼šæ¥æ”¶åˆ†æ”¯é€‰æ‹©ã€æ£€æŸ¥å‰§æƒ…å˜é‡ã€æ‰§è¡Œå¯¹è¯é€»è¾‘ã€æ’­æ”¾å¯¹è¯UIç­‰ï¼‰\r\n - âœ… **çµæ´»è¿æ¥**ï¼šæ”¯æŒçº¿æ€§ã€åˆ†æ”¯ã€å¾ªç¯ç­‰å¤šç§è¿æ¥æ–¹å¼\r\n - âœ… **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹é…ç½®é€šè¿‡æ•°æ®å±‚ç®¡ç†\r\n \r\n ### 2. æ‰§è¡Œå±‚ï¼šèŠ‚ç‚¹ç¼–æ’ä¸æµç¨‹æ§åˆ¶\r\n"
                },
                {
                    "date": 1767381682230,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1026,17 +1026,20 @@\n - âœ… **æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°å¢èŠ‚ç‚¹ç±»å‹ã€è¡¨ç°ç±»å‹ã€åˆ†æ”¯ç±»å‹ç­‰\r\n \r\n ### è®¾è®¡åŸåˆ™\r\n \r\n-- âœ… **è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ**ï¼šå‰§æƒ…è„šæœ¬è§£æå’Œæ‰§è¡Œæ˜¯ç³»ç»Ÿæ ¸å¿ƒ\r\n+- âœ… **è„šæœ¬å±‚ä¸ºæ ¸å¿ƒ + èŠ‚ç‚¹ç¼–æ’**ï¼šå‰§æƒ…è„šæœ¬è§£æå’Œæ‰§è¡Œæ˜¯ç³»ç»Ÿæ ¸å¿ƒï¼Œé€šè¿‡èŠ‚ç‚¹ç¼–æ’å®ç°çµæ´»æµç¨‹æ§åˆ¶\r\n - âœ… **æ•°æ®é©±åŠ¨æ¶æ„**ï¼šå‰§æƒ…ç‰¹æ€§é€šè¿‡é…ç½®æ•°æ®å®ç°\r\n - âœ… **äº”å±‚æ¶æ„ + ç®¡é“è¿‡æ»¤å™¨**ï¼šåˆ†å±‚æ¶æ„å®ç°èŒè´£åˆ†ç¦»\r\n - âœ… **è¡¨ç°å±‚è§£è€¦**ï¼šé€šè¿‡ Visual ç³»ç»Ÿç»Ÿä¸€ç®¡ç†è¡¨ç°\r\n+- âœ… **èŠ‚ç‚¹åˆ†ç±»è®¾è®¡**ï¼šæŒ‰èŒè´£åˆ†ä¸ºè¾“å…¥èŠ‚ç‚¹ã€æ¡ä»¶èŠ‚ç‚¹ã€æ‰§è¡ŒèŠ‚ç‚¹ã€å¯è§†åŒ–èŠ‚ç‚¹å››ç±»\r\n \r\n ### æ¶æ„ç‰¹ç‚¹\r\n \r\n - âœ… **å¯¹è¯æ ‘/èŠ‚ç‚¹å›¾**ï¼šæ”¯æŒç»“æ„åŒ–è„šæœ¬æ•°æ®\r\n-- âœ… **ç»Ÿä¸€æ‰§è¡Œå™¨**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç±»å‹ä½¿ç”¨ç»Ÿä¸€æ¥å£\r\n+- âœ… **èŠ‚ç‚¹ç¼–æ’å™¨**ï¼šèŠ‚ç‚¹ç¼–æ’å™¨æ ¹æ®é…ç½®åŠ¨æ€ç»„ç»‡èŠ‚ç‚¹æ‰§è¡Œ\r\n+- âœ… **èŠ‚ç‚¹åˆ†ç±»æ¸…æ™°**ï¼šè¾“å…¥èŠ‚ç‚¹ã€æ¡ä»¶èŠ‚ç‚¹ã€æ‰§è¡ŒèŠ‚ç‚¹ã€å¯è§†åŒ–èŠ‚ç‚¹å››ç±»ï¼ŒèŒè´£å•ä¸€ã€å¯å¤ç”¨\r\n+- âœ… **ç»Ÿä¸€æ‰§è¡Œæ¥å£**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç±»å‹ä½¿ç”¨ç»Ÿä¸€æ¥å£\r\n - âœ… **Visual ç³»ç»Ÿé›†æˆ**ï¼šè¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦\r\n - âœ… **å®Œæ•´çŠ¶æ€ç®¡ç†**ï¼šæ”¯æŒä¿å­˜/æ¢å¤å’Œè¿›åº¦è¿½è¸ª\r\n - âœ… **é…ç½®é©±åŠ¨**ï¼šæ‰€æœ‰ç‰¹æ€§é€šè¿‡é…ç½®æ•°æ®å®ç°\r\n \r\n"
                },
                {
                    "date": 1767381720816,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -647,53 +647,8 @@\n     style ConfigData fill:#c8e6c9\r\n     style RuntimeData fill:#e1f5ff\r\n ```\r\n \r\n-### æ•°æ®ç»“æ„è®¾è®¡\r\n-\r\n-#### StoryConfigï¼ˆå‰§æƒ…é…ç½®ï¼‰\r\n-\r\n-```mermaid\r\n-graph LR\r\n-    StoryConfig --> StoryId[å‰§æƒ…ID]\r\n-    StoryConfig --> StoryName[å‰§æƒ…åç§°]\r\n-    StoryConfig --> EntryNode[å…¥å£èŠ‚ç‚¹ID]\r\n-    StoryConfig --> NodeList[èŠ‚ç‚¹åˆ—è¡¨]\r\n-    StoryConfig --> VariableList[å˜é‡åˆ—è¡¨]\r\n-    StoryConfig --> ResourceList[èµ„æºåˆ—è¡¨]\r\n-    \r\n-    style StoryConfig fill:#ffebee\r\n-```\r\n-\r\n-#### NodeConfigï¼ˆèŠ‚ç‚¹é…ç½®ï¼‰\r\n-\r\n-```mermaid\r\n-graph LR\r\n-    NodeConfig --> NodeId[èŠ‚ç‚¹ID]\r\n-    NodeConfig --> NodeType[èŠ‚ç‚¹ç±»å‹]\r\n-    NodeConfig --> NodeParams[èŠ‚ç‚¹å‚æ•°]\r\n-    NodeConfig --> NextNodeId[ä¸‹ä¸€èŠ‚ç‚¹ID]\r\n-    NodeConfig --> BranchList[åˆ†æ”¯åˆ—è¡¨]\r\n-    NodeConfig --> Conditions[æ¡ä»¶åˆ—è¡¨]\r\n-    NodeConfig --> Effects[æ•ˆæœåˆ—è¡¨]\r\n-    \r\n-    style NodeConfig fill:#c8e6c9\r\n-```\r\n-\r\n-#### DialogueConfigï¼ˆå¯¹è¯é…ç½®ï¼‰\r\n-\r\n-```mermaid\r\n-graph LR\r\n-    DialogueConfig --> DialogueId[å¯¹è¯ID]\r\n-    DialogueConfig --> NpcId[è¯´è¯è€…ID]\r\n-    DialogueConfig --> Content[å¯¹è¯å†…å®¹]\r\n-    DialogueConfig --> ShowType[æ˜¾ç¤ºç±»å‹]\r\n-    DialogueConfig --> ShowParams[æ˜¾ç¤ºå‚æ•°]\r\n-    DialogueConfig --> Emotion[è¡¨æƒ…åºå·]\r\n-    \r\n-    style DialogueConfig fill:#e1f5ff\r\n-```\r\n-\r\n ---\r\n \r\n ## æ•°æ®æµè®¾è®¡\r\n \r\n"
                }
            ],
            "date": 1767379748424,
            "name": "Commit-0",
            "content": "# å‰§æƒ…æ¼”å‡ºæ¶æ„è®¾è®¡\r\n\r\n## ğŸ“‹ æ¦‚è¿°\r\n\r\nå‰§æƒ…æ¼”å‡ºç³»ç»Ÿæ˜¯æ¸¸æˆå™äº‹ä½“éªŒçš„æ ¸å¿ƒç³»ç»Ÿï¼Œè´Ÿè´£ç®¡ç†å‰§æƒ…è„šæœ¬çš„è§£æã€æ‰§è¡Œã€è¡¨ç°å’ŒçŠ¶æ€ç®¡ç†ã€‚ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œé€šè¿‡æ•°æ®é©±åŠ¨çš„æ–¹å¼å®ç°å‰§æƒ…æ¼”å‡ºçš„å®Œæ•´æµç¨‹ã€‚\r\n\r\n---\r\n\r\n## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph DataLayer[\"æ•°æ®å±‚<br/>DataLayer<br/>é™æ€é…ç½®æ•°æ®\"]\r\n        StoryConfig[\"StoryConfig<br/>å‰§æƒ…é…ç½®<br/>id/name/entryNodeId\"]\r\n        NodeConfig[\"NodeConfig<br/>èŠ‚ç‚¹é…ç½®<br/>nodeId/type/params/connections\"]\r\n        DialogueConfig[\"DialogueConfig<br/>å¯¹è¯é…ç½®<br/>å¤ç”¨ç°æœ‰CfgDialogue\"]\r\n        ResourceConfig[\"ResourceConfig<br/>èµ„æºé…ç½®<br/>timeline/audio/animation\"]\r\n    end\r\n    \r\n    subgraph ScriptLayer[\"è„šæœ¬å±‚<br/>ScriptLayer<br/>å‰§æƒ…è„šæœ¬è§£æ\"]\r\n        StoryParser[\"StoryParser<br/>å‰§æƒ…è§£æå™¨\"]\r\n        NodeGraph[\"NodeGraph<br/>èŠ‚ç‚¹å›¾ç®¡ç†<br/>èŠ‚ç‚¹è¿æ¥å…³ç³»\"]\r\n        ScriptValidator[\"ScriptValidator<br/>è„šæœ¬éªŒè¯å™¨\"]\r\n    end\r\n    \r\n    subgraph ExecutionLayer[\"æ‰§è¡Œå±‚<br/>ExecutionLayer<br/>å‰§æƒ…æ‰§è¡Œå™¨\"]\r\n        StoryExecutor[\"StoryExecutor<br/>å‰§æƒ…æ‰§è¡Œå™¨<br/>ç®¡ç†å½“å‰èŠ‚ç‚¹\"]\r\n        NodeExecutor[\"NodeExecutor<br/>èŠ‚ç‚¹æ‰§è¡Œå™¨<br/>æ‰§è¡Œå…·ä½“èŠ‚ç‚¹\"]\r\n        BranchSelector[\"BranchSelector<br/>åˆ†æ”¯é€‰æ‹©å™¨<br/>å¤„ç†åˆ†æ”¯é€»è¾‘\"]\r\n    end\r\n    \r\n    subgraph StateLayer[\"çŠ¶æ€å±‚<br/>StateLayer<br/>å‰§æƒ…çŠ¶æ€ç®¡ç†\"]\r\n        StoryState[\"StoryState<br/>å‰§æƒ…çŠ¶æ€<br/>currentNode/progress\"]\r\n        StoryVariable[\"StoryVariable<br/>å‰§æƒ…å˜é‡<br/>å…¨å±€/å±€éƒ¨å˜é‡\"]\r\n        StatePersistence[\"StatePersistence<br/>çŠ¶æ€æŒä¹…åŒ–<br/>ä¿å­˜/æ¢å¤\"]\r\n    end\r\n    \r\n    subgraph PresentationLayer[\"è¡¨ç°å±‚<br/>PresentationLayer<br/>ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’\"]\r\n        TimelinePlayer[\"TimelinePlayer<br/>Timelineæ’­æ”¾å™¨\"]\r\n        UIPresenter[\"UIPresenter<br/>UIè¡¨ç°å™¨<br/>å¯¹è¯UI/é€‰æ‹©UI\"]\r\n        AudioPlayer[\"AudioPlayer<br/>éŸ³é¢‘æ’­æ”¾å™¨\"]\r\n        VisualPlayer[\"VisualPlayer<br/>è§†è§‰è¡¨ç°å™¨<br/>åŠ¨ç”»/ç‰¹æ•ˆ\"]\r\n    end\r\n    \r\n    DataLayer -->|é…ç½®åŠ è½½| ScriptLayer\r\n    ScriptLayer -->|è§£æç»“æœ| ExecutionLayer\r\n    ExecutionLayer -->|æ‰§è¡ŒçŠ¶æ€| StateLayer\r\n    ExecutionLayer -->|è¡¨ç°è¯·æ±‚| PresentationLayer\r\n    StateLayer -->|çŠ¶æ€æŸ¥è¯¢| ExecutionLayer\r\n    PresentationLayer -->|å®Œæˆå›è°ƒ| ExecutionLayer\r\n    \r\n    style DataLayer fill:#e1f5ff\r\n    style ScriptLayer fill:#fff4e1\r\n    style ExecutionLayer fill:#c8e6c9\r\n    style StateLayer fill:#f3e5f5\r\n    style PresentationLayer fill:#ffebee\r\n```\r\n\r\n---\r\n\r\n## ğŸ“Š æ•°æ®æµå›¾\r\n\r\n```mermaid\r\nsequenceDiagram\r\n    participant Config as é…ç½®æ•°æ®\r\n    participant Parser as è„šæœ¬è§£æå™¨\r\n    participant Executor as å‰§æƒ…æ‰§è¡Œå™¨\r\n    participant State as çŠ¶æ€ç®¡ç†\r\n    participant Presenter as è¡¨ç°å±‚\r\n    \r\n    Config->>Parser: åŠ è½½å‰§æƒ…é…ç½®\r\n    Parser->>Parser: è§£æèŠ‚ç‚¹å›¾\r\n    Parser->>Executor: åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡\r\n    \r\n    Executor->>State: æŸ¥è¯¢å½“å‰çŠ¶æ€\r\n    State->>Executor: è¿”å›å½“å‰èŠ‚ç‚¹\r\n    \r\n    Executor->>Executor: æ‰§è¡Œå½“å‰èŠ‚ç‚¹\r\n    Executor->>Presenter: è¯·æ±‚è¡¨ç°ï¼ˆTimeline/UI/Audioï¼‰\r\n    \r\n    Presenter->>Presenter: æ’­æ”¾è¡¨ç°\r\n    Presenter->>Executor: è¡¨ç°å®Œæˆå›è°ƒ\r\n    \r\n    Executor->>State: æ›´æ–°çŠ¶æ€ï¼ˆèŠ‚ç‚¹å®Œæˆï¼‰\r\n    Executor->>Executor: é€‰æ‹©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\r\n    \r\n    alt åˆ†æ”¯èŠ‚ç‚¹\r\n        Executor->>Presenter: æ˜¾ç¤ºåˆ†æ”¯é€‰æ‹©UI\r\n        Presenter->>Executor: è¿”å›ç©å®¶é€‰æ‹©\r\n        Executor->>Executor: æ ¹æ®é€‰æ‹©è·³è½¬èŠ‚ç‚¹\r\n    end\r\n    \r\n    Executor->>State: ä¿å­˜è¿›åº¦\r\n```\r\n\r\n---\r\n\r\n## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ\r\n\r\n### 1. åˆ†å±‚æ¶æ„\r\n- **æ•°æ®å±‚**ï¼šé™æ€é…ç½®æ•°æ®ï¼Œæ¥è‡ªé…ç½®è¡¨\r\n- **è„šæœ¬å±‚**ï¼šè§£æå’ŒéªŒè¯å‰§æƒ…è„šæœ¬\r\n- **æ‰§è¡Œå±‚**ï¼šæ‰§è¡Œå‰§æƒ…é€»è¾‘ï¼Œç®¡ç†èŠ‚ç‚¹æµè½¬\r\n- **çŠ¶æ€å±‚**ï¼šç®¡ç†å‰§æƒ…çŠ¶æ€å’Œå˜é‡\r\n- **è¡¨ç°å±‚**ï¼šä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼Œè´Ÿè´£è§†è§‰å’Œå¬è§‰è¡¨ç°\r\n\r\n### 2. æ•°æ®é©±åŠ¨\r\n- å‰§æƒ…é€»è¾‘é€šè¿‡é…ç½®æ•°æ®å®šä¹‰ï¼Œæ— éœ€ç¡¬ç¼–ç \r\n- èŠ‚ç‚¹ç±»å‹å¯æ‰©å±•ï¼Œé€šè¿‡é…ç½®å®ç°ä¸åŒè¡Œä¸º\r\n- åˆ†æ”¯ã€æ¡ä»¶ã€æ•ˆæœéƒ½é€šè¿‡é…ç½®å®ç°\r\n\r\n### 3. ç³»ç»Ÿè§£è€¦\r\n- è¡¨ç°å±‚ä¸æ‰§è¡Œå±‚è§£è€¦ï¼Œé€šè¿‡å›è°ƒé€šä¿¡\r\n- çŠ¶æ€å±‚ç‹¬ç«‹ç®¡ç†ï¼Œæ”¯æŒä¿å­˜å’Œæ¢å¤\r\n- ä¸ç°æœ‰ç³»ç»Ÿï¼ˆTimelineã€UIã€Audioï¼‰é€šè¿‡æ¥å£äº¤äº’\r\n\r\n---\r\n\r\n## ğŸ“ åç»­è¯¦ç»†è®¾è®¡\r\n\r\nå¾…æ¶æ„å›¾ç¡®è®¤åï¼Œå°†è¯¦ç»†è®¾è®¡ï¼š\r\n- å„å±‚çš„å…·ä½“å®ç°\r\n- èŠ‚ç‚¹ç±»å‹å®šä¹‰\r\n- æ•°æ®æ ¼å¼è®¾è®¡\r\n- APIæ¥å£è®¾è®¡\r\n- ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ\r\n"
        }
    ]
}