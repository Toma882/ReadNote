{
    "sourceFile": "è½¯ä»¶æ¶æ„è®¾è®¡/æ¶æ„æ¨¡å¼/CQRSæ¶æ„æ¨¡å¼.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767096675497,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767096675497,
            "name": "Commit-0",
            "content": "# CQRSæ¶æ„æ¨¡å¼ï¼ˆCommand Query Responsibility Segregation Patternï¼‰\r\n\r\n## ç›®å½•\r\n\r\n- [æ¦‚è¿°](#æ¦‚è¿°)\r\n- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)\r\n- [æ¶æ„ç»“æ„](#æ¶æ„ç»“æ„)\r\n- [è®¾è®¡è§„åˆ™](#è®¾è®¡è§„åˆ™)\r\n- [ä¼˜ç¼ºç‚¹åˆ†æ](#ä¼˜ç¼ºç‚¹åˆ†æ)\r\n- [å®è·µæŒ‡å—](#å®è·µæŒ‡å—)\r\n- [ä¸å…¶ä»–æ¶æ„æ¨¡å¼çš„å…³ç³»](#ä¸å…¶ä»–æ¶æ„æ¨¡å¼çš„å…³ç³»)\r\n- [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)\r\n- [å®é™…æ¡ˆä¾‹](#å®é™…æ¡ˆä¾‹)\r\n- [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)\r\n- [æ€»ç»“](#æ€»ç»“)\r\n\r\n---\r\n\r\n## æ¦‚è¿°\r\n\r\n**CQRSæ¶æ„æ¨¡å¼ï¼ˆCommand Query Responsibility Segregation Patternï¼‰**ï¼Œå³**å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»æ¨¡å¼**ï¼Œæ˜¯ç”±Greg Youngæå‡ºçš„ä¸€ç§æ¶æ„æ¨¡å¼ã€‚å®ƒå°†ç³»ç»Ÿçš„è¯»å†™æ“ä½œåˆ†ç¦»ï¼Œä½¿ç”¨ä¸åŒçš„æ¨¡å‹æ¥å¤„ç†å‘½ä»¤ï¼ˆå†™æ“ä½œï¼‰å’ŒæŸ¥è¯¢ï¼ˆè¯»æ“ä½œï¼‰ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚\r\n\r\n### ä»€ä¹ˆæ˜¯CQRSï¼Ÿ\r\n\r\nCQRSå°†ç³»ç»Ÿçš„è¯»å†™æ“ä½œå®Œå…¨åˆ†ç¦»ï¼š\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"ä¼ ç»Ÿæ¶æ„\"\r\n        SingleModel[å•ä¸€æ¨¡å‹<br/>Single Model]\r\n        Read[è¯»æ“ä½œ<br/>Read]\r\n        Write[å†™æ“ä½œ<br/>Write]\r\n        \r\n        Read --> SingleModel\r\n        Write --> SingleModel\r\n    end\r\n    \r\n    subgraph \"CQRSæ¶æ„\"\r\n        CommandModel[å‘½ä»¤æ¨¡å‹<br/>Command Model]\r\n        QueryModel[æŸ¥è¯¢æ¨¡å‹<br/>Query Model]\r\n        Command[å‘½ä»¤<br/>Command]\r\n        Query[æŸ¥è¯¢<br/>Query]\r\n        \r\n        Command --> CommandModel\r\n        Query --> QueryModel\r\n    end\r\n    \r\n    style SingleModel fill:#ffcccb\r\n    style CommandModel fill:#ffebee\r\n    style QueryModel fill:#e1f5ff\r\n```\r\n\r\n**æ ¸å¿ƒåŸåˆ™**ï¼š\r\n- **è¯»å†™åˆ†ç¦»**ï¼šå‘½ä»¤å’ŒæŸ¥è¯¢ä½¿ç”¨ä¸åŒçš„æ¨¡å‹\r\n- **ç‹¬ç«‹ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–\r\n- **ç‹¬ç«‹æ‰©å±•**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹æ‰©å±•\r\n- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥æœ€ç»ˆä¸€è‡´\r\n\r\n### ä¸ºä»€ä¹ˆéœ€è¦CQRSï¼Ÿ\r\n\r\nCQRSè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š\r\n- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–ï¼ŒæŸ¥è¯¢å¯ä»¥é«˜åº¦ä¼˜åŒ–\r\n- **å¯æ‰©å±•æ€§**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼ŒæŸ¥è¯¢å¯ä»¥æ°´å¹³æ‰©å±•\r\n- **å¤æ‚åº¦ç®¡ç†**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥æœ‰ä¸åŒçš„å¤æ‚åº¦\r\n- **å®‰å…¨æ€§**ï¼šè¯»å†™å¯ä»¥æœ‰ä¸åŒçš„å®‰å…¨ç­–ç•¥\r\n- **çµæ´»æ€§**ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒåœºæ™¯ä¼˜åŒ–ä¸åŒæ¨¡å‹\r\n\r\n---\r\n\r\n## æ ¸å¿ƒæ¦‚å¿µ\r\n\r\n### æ ¸å¿ƒæ€æƒ³\r\n\r\nCQRSçš„æ ¸å¿ƒæ€æƒ³æ˜¯**èŒè´£åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰**ï¼š\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"CQRSæ ¸å¿ƒæ€æƒ³\"\r\n        Command[å‘½ä»¤<br/>Command<br/>æ”¹å˜çŠ¶æ€]\r\n        Query[æŸ¥è¯¢<br/>Query<br/>è¯»å–çŠ¶æ€]\r\n        \r\n        Command --> WriteModel[å†™æ¨¡å‹<br/>Write Model]\r\n        Query --> ReadModel[è¯»æ¨¡å‹<br/>Read Model]\r\n        \r\n        WriteModel -.åŒæ­¥.-> ReadModel\r\n    end\r\n    \r\n    style Command fill:#ffebee\r\n    style Query fill:#e1f5ff\r\n    style WriteModel fill:#fff4e1\r\n    style ReadModel fill:#c8e6c9\r\n```\r\n\r\n**å…³é”®åŸåˆ™**ï¼š\r\n1. **å‘½ä»¤å’ŒæŸ¥è¯¢åˆ†ç¦»**ï¼šå‘½ä»¤æ”¹å˜çŠ¶æ€ï¼ŒæŸ¥è¯¢è¯»å–çŠ¶æ€\r\n2. **ä¸åŒæ¨¡å‹**ï¼šå‘½ä»¤å’ŒæŸ¥è¯¢ä½¿ç”¨ä¸åŒçš„æ¨¡å‹\r\n3. **ç‹¬ç«‹ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–\r\n4. **æœ€ç»ˆä¸€è‡´æ€§**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥æœ€ç»ˆä¸€è‡´\r\n\r\n### åŸºæœ¬ç‰¹å¾\r\n\r\n- **è¯»å†™åˆ†ç¦»**ï¼šå‘½ä»¤å’ŒæŸ¥è¯¢å®Œå…¨åˆ†ç¦»\r\n- **ä¸åŒæ¨¡å‹**ï¼šè¯»å†™ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¨¡å‹\r\n- **ç‹¬ç«‹ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–\r\n- **ç‹¬ç«‹æ‰©å±•**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹æ‰©å±•\r\n- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥æœ€ç»ˆä¸€è‡´\r\n\r\n---\r\n\r\n## æ¶æ„ç»“æ„\r\n\r\n### CQRSå®Œæ•´æ¶æ„\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"å®¢æˆ·ç«¯å±‚\"\r\n        Client[å®¢æˆ·ç«¯<br/>Client]\r\n    end\r\n    \r\n    subgraph \"å‘½ä»¤ç«¯ï¼ˆå†™ï¼‰\"\r\n        CommandAPI[å‘½ä»¤API<br/>Command API]\r\n        CommandHandler[å‘½ä»¤å¤„ç†å™¨<br/>Command Handler]\r\n        DomainModel[é¢†åŸŸæ¨¡å‹<br/>Domain Model]\r\n        WriteDB[(å†™æ•°æ®åº“<br/>Write Database)]\r\n        EventStore[äº‹ä»¶å­˜å‚¨<br/>Event Store]\r\n    end\r\n    \r\n    subgraph \"æŸ¥è¯¢ç«¯ï¼ˆè¯»ï¼‰\"\r\n        QueryAPI[æŸ¥è¯¢API<br/>Query API]\r\n        QueryHandler[æŸ¥è¯¢å¤„ç†å™¨<br/>Query Handler]\r\n        ReadModel[è¯»æ¨¡å‹<br/>Read Model]\r\n        ReadDB[(è¯»æ•°æ®åº“<br/>Read Database)]\r\n        Cache[ç¼“å­˜<br/>Cache]\r\n    end\r\n    \r\n    subgraph \"åŒæ­¥æœºåˆ¶\"\r\n        EventBus[äº‹ä»¶æ€»çº¿<br/>Event Bus]\r\n        Projection[æŠ•å½±<br/>Projection]\r\n    end\r\n    \r\n    Client --> CommandAPI\r\n    Client --> QueryAPI\r\n    \r\n    CommandAPI --> CommandHandler\r\n    CommandHandler --> DomainModel\r\n    DomainModel --> WriteDB\r\n    DomainModel --> EventStore\r\n    \r\n    QueryAPI --> QueryHandler\r\n    QueryHandler --> ReadModel\r\n    ReadModel --> ReadDB\r\n    ReadModel --> Cache\r\n    \r\n    EventStore --> EventBus\r\n    EventBus --> Projection\r\n    Projection --> ReadModel\r\n    \r\n    style CommandHandler fill:#ffebee\r\n    style QueryHandler fill:#e1f5ff\r\n    style EventBus fill:#fff4e1\r\n```\r\n\r\n### æ ¸å¿ƒç»„ä»¶è¯¦è§£\r\n\r\n#### 1. å‘½ä»¤ï¼ˆCommandï¼‰\r\n\r\n**å®šä¹‰**ï¼šè¡¨ç¤ºæ”¹å˜ç³»ç»ŸçŠ¶æ€çš„æ„å›¾\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"å‘½ä»¤ç‰¹å¾\"\r\n        Intent[æ„å›¾<br/>Intent]\r\n        NoReturn[æ— è¿”å›å€¼<br/>No Return Value]\r\n        SideEffect[å‰¯ä½œç”¨<br/>Side Effect]\r\n        Idempotent[å¹‚ç­‰æ€§<br/>Idempotency]\r\n    end\r\n    \r\n    style Intent fill:#ffebee\r\n```\r\n\r\n**ç‰¹ç‚¹**ï¼š\r\n- è¡¨ç¤ºæ”¹å˜çŠ¶æ€çš„æ„å›¾\r\n- é€šå¸¸æ— è¿”å›å€¼ï¼ˆæˆ–è¿”å›ç»“æœï¼‰\r\n- æœ‰å‰¯ä½œç”¨ï¼ˆæ”¹å˜çŠ¶æ€ï¼‰\r\n- åº”è¯¥æ”¯æŒå¹‚ç­‰æ€§\r\n\r\n**ç¤ºä¾‹**ï¼š\r\n- CreateOrderï¼ˆåˆ›å»ºè®¢å•ï¼‰\r\n- UpdateOrderï¼ˆæ›´æ–°è®¢å•ï¼‰\r\n- CancelOrderï¼ˆå–æ¶ˆè®¢å•ï¼‰\r\n\r\n#### 2. æŸ¥è¯¢ï¼ˆQueryï¼‰\r\n\r\n**å®šä¹‰**ï¼šè¡¨ç¤ºè¯»å–ç³»ç»ŸçŠ¶æ€çš„è¯·æ±‚\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"æŸ¥è¯¢ç‰¹å¾\"\r\n        ReadOnly[åªè¯»<br/>Read Only]\r\n        ReturnValue[è¿”å›å€¼<br/>Return Value]\r\n        NoSideEffect[æ— å‰¯ä½œç”¨<br/>No Side Effect]\r\n        Optimized[å¯ä¼˜åŒ–<br/>Optimizable]\r\n    end\r\n    \r\n    style ReadOnly fill:#e1f5ff\r\n```\r\n\r\n**ç‰¹ç‚¹**ï¼š\r\n- åªè¯»å–çŠ¶æ€ï¼Œä¸æ”¹å˜çŠ¶æ€\r\n- æœ‰è¿”å›å€¼\r\n- æ— å‰¯ä½œç”¨\r\n- å¯ä»¥é«˜åº¦ä¼˜åŒ–\r\n\r\n**ç¤ºä¾‹**ï¼š\r\n- GetOrderï¼ˆè·å–è®¢å•ï¼‰\r\n- ListOrdersï¼ˆåˆ—å‡ºè®¢å•ï¼‰\r\n- GetOrderStatisticsï¼ˆè·å–è®¢å•ç»Ÿè®¡ï¼‰\r\n\r\n#### 3. å‘½ä»¤æ¨¡å‹ï¼ˆCommand Modelï¼‰\r\n\r\n**å®šä¹‰**ï¼šç”¨äºå¤„ç†å‘½ä»¤çš„é¢†åŸŸæ¨¡å‹\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"å‘½ä»¤æ¨¡å‹\"\r\n        DomainLogic[é¢†åŸŸé€»è¾‘<br/>Domain Logic]\r\n        Validation[éªŒè¯<br/>Validation]\r\n        BusinessRules[ä¸šåŠ¡è§„åˆ™<br/>Business Rules]\r\n        Consistency[ä¸€è‡´æ€§<br/>Consistency]\r\n    end\r\n    \r\n    style DomainLogic fill:#ffebee\r\n```\r\n\r\n**ç‰¹ç‚¹**ï¼š\r\n- åŒ…å«å®Œæ•´çš„é¢†åŸŸé€»è¾‘\r\n- ä¿è¯æ•°æ®ä¸€è‡´æ€§\r\n- éªŒè¯ä¸šåŠ¡è§„åˆ™\r\n- å¯ä»¥å¤æ‚\r\n\r\n#### 4. æŸ¥è¯¢æ¨¡å‹ï¼ˆQuery Modelï¼‰\r\n\r\n**å®šä¹‰**ï¼šç”¨äºå¤„ç†æŸ¥è¯¢çš„ä¼˜åŒ–æ¨¡å‹\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"æŸ¥è¯¢æ¨¡å‹\"\r\n        Denormalized[åè§„èŒƒåŒ–<br/>Denormalized]\r\n        Optimized[ä¼˜åŒ–<br/>Optimized]\r\n        Simple[ç®€å•<br/>Simple]\r\n        Fast[å¿«é€Ÿ<br/>Fast]\r\n    end\r\n    \r\n    style Optimized fill:#e1f5ff\r\n```\r\n\r\n**ç‰¹ç‚¹**ï¼š\r\n- å¯ä»¥åè§„èŒƒåŒ–\r\n- é«˜åº¦ä¼˜åŒ–\r\n- ç»“æ„ç®€å•\r\n- æŸ¥è¯¢å¿«é€Ÿ\r\n\r\n#### 5. äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰\r\n\r\n**å®šä¹‰**ï¼šåŒæ­¥è¯»å†™æ¨¡å‹çš„æœºåˆ¶\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"äº‹ä»¶æ€»çº¿\"\r\n        Event[é¢†åŸŸäº‹ä»¶<br/>Domain Event]\r\n        Publish[å‘å¸ƒ<br/>Publish]\r\n        Subscribe[è®¢é˜…<br/>Subscribe]\r\n        Sync[åŒæ­¥<br/>Synchronize]\r\n    end\r\n    \r\n    Event --> Publish\r\n    Publish --> Subscribe\r\n    Subscribe --> Sync\r\n    \r\n    style Event fill:#fff4e1\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- å‘å¸ƒé¢†åŸŸäº‹ä»¶\r\n- è®¢é˜…äº‹ä»¶\r\n- åŒæ­¥è¯»å†™æ¨¡å‹\r\n- ä¿è¯æœ€ç»ˆä¸€è‡´æ€§\r\n\r\n#### 6. æŠ•å½±ï¼ˆProjectionï¼‰\r\n\r\n**å®šä¹‰**ï¼šå°†å‘½ä»¤æ¨¡å‹çš„äº‹ä»¶æŠ•å½±åˆ°æŸ¥è¯¢æ¨¡å‹\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"æŠ•å½±\"\r\n        Event1[äº‹ä»¶1<br/>Event]\r\n        Event2[äº‹ä»¶2<br/>Event]\r\n        Projection[æŠ•å½±é€»è¾‘<br/>Projection Logic]\r\n        ReadModel[è¯»æ¨¡å‹<br/>Read Model]\r\n        \r\n        Event1 --> Projection\r\n        Event2 --> Projection\r\n        Projection --> ReadModel\r\n    end\r\n    \r\n    style Projection fill:#fff4e1\r\n```\r\n\r\n**èŒè´£**ï¼š\r\n- ç›‘å¬é¢†åŸŸäº‹ä»¶\r\n- æ›´æ–°æŸ¥è¯¢æ¨¡å‹\r\n- ä¿æŒè¯»å†™æ¨¡å‹åŒæ­¥\r\n- å¤„ç†äº‹ä»¶é‡æ”¾\r\n\r\n---\r\n\r\n## è®¾è®¡è§„åˆ™\r\n\r\n### è¯»å†™åˆ†ç¦»è§„åˆ™\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"åˆ†ç¦»è§„åˆ™\"\r\n        Rule1[å‘½ä»¤ä¸è¿”å›æ•°æ®<br/>Commands Don't Return Data]\r\n        Rule2[æŸ¥è¯¢ä¸æ”¹å˜çŠ¶æ€<br/>Queries Don't Change State]\r\n        Rule3[ä¸åŒæ¨¡å‹<br/>Different Models]\r\n        Rule4[ç‹¬ç«‹ä¼˜åŒ–<br/>Independent Optimization]\r\n    end\r\n    \r\n    style Rule1 fill:#ffebee\r\n    style Rule2 fill:#e1f5ff\r\n```\r\n\r\n**è§„åˆ™è¯´æ˜**ï¼š\r\n- âœ… **å‘½ä»¤ä¸è¿”å›æ•°æ®**ï¼šå‘½ä»¤åªè¿”å›æˆåŠŸ/å¤±è´¥ï¼Œä¸è¿”å›æ•°æ®\r\n- âœ… **æŸ¥è¯¢ä¸æ”¹å˜çŠ¶æ€**ï¼šæŸ¥è¯¢åªè¯»å–æ•°æ®ï¼Œä¸æ”¹å˜çŠ¶æ€\r\n- âœ… **ä¸åŒæ¨¡å‹**ï¼šå‘½ä»¤å’ŒæŸ¥è¯¢ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¨¡å‹\r\n- âœ… **ç‹¬ç«‹ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–\r\n\r\n### ä¸€è‡´æ€§è§„åˆ™\r\n\r\n```mermaid\r\ngraph LR\r\n    subgraph \"ä¸€è‡´æ€§è§„åˆ™\"\r\n        Strong[å¼ºä¸€è‡´æ€§<br/>Strong Consistency<br/>å‘½ä»¤ç«¯]\r\n        Eventual[æœ€ç»ˆä¸€è‡´æ€§<br/>Eventual Consistency<br/>æŸ¥è¯¢ç«¯]\r\n        Sync[åŒæ­¥æœºåˆ¶<br/>Synchronization<br/>äº‹ä»¶æ€»çº¿]\r\n    end\r\n    \r\n    Strong --> Sync\r\n    Sync --> Eventual\r\n    \r\n    style Strong fill:#ffebee\r\n    style Eventual fill:#e1f5ff\r\n```\r\n\r\n**è§„åˆ™è¯´æ˜**ï¼š\r\n- âœ… **å‘½ä»¤ç«¯å¼ºä¸€è‡´æ€§**ï¼šå†™æ“ä½œä¿è¯å¼ºä¸€è‡´æ€§\r\n- âœ… **æŸ¥è¯¢ç«¯æœ€ç»ˆä¸€è‡´æ€§**ï¼šè¯»æ“ä½œå¯ä»¥æœ€ç»ˆä¸€è‡´\r\n- âœ… **åŒæ­¥æœºåˆ¶**ï¼šé€šè¿‡äº‹ä»¶æ€»çº¿åŒæ­¥\r\n\r\n---\r\n\r\n## ä¼˜ç¼ºç‚¹åˆ†æ\r\n\r\n### ä¼˜ç‚¹\r\n\r\n```mermaid\r\nmindmap\r\n  root((CQRSä¼˜ç‚¹))\r\n    æ€§èƒ½ä¼˜åŒ–\r\n      è¯»å†™ç‹¬ç«‹ä¼˜åŒ–\r\n      æŸ¥è¯¢é«˜åº¦ä¼˜åŒ–\r\n      ç¼“å­˜å‹å¥½\r\n    å¯æ‰©å±•æ€§\r\n      è¯»å†™ç‹¬ç«‹æ‰©å±•\r\n      æŸ¥è¯¢æ°´å¹³æ‰©å±•\r\n      è´Ÿè½½åˆ†ç¦»\r\n    å¤æ‚åº¦ç®¡ç†\r\n      è¯»å†™æ¨¡å‹ç‹¬ç«‹\r\n      ä¸åŒå¤æ‚åº¦\r\n      ç®€åŒ–æ¨¡å‹\r\n    çµæ´»æ€§\r\n      ç‹¬ç«‹ä¼˜åŒ–\r\n      ç‹¬ç«‹éƒ¨ç½²\r\n      ç‹¬ç«‹å®‰å…¨ç­–ç•¥\r\n```\r\n\r\n**è¯¦ç»†è¯´æ˜**ï¼š\r\n- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–ï¼ŒæŸ¥è¯¢å¯ä»¥é«˜åº¦ä¼˜åŒ–\r\n- âœ… **å¯æ‰©å±•æ€§**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼ŒæŸ¥è¯¢å¯ä»¥æ°´å¹³æ‰©å±•\r\n- âœ… **å¤æ‚åº¦ç®¡ç†**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥æœ‰ä¸åŒçš„å¤æ‚åº¦\r\n- âœ… **çµæ´»æ€§**ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒåœºæ™¯ä¼˜åŒ–ä¸åŒæ¨¡å‹\r\n- âœ… **å®‰å…¨æ€§**ï¼šè¯»å†™å¯ä»¥æœ‰ä¸åŒçš„å®‰å…¨ç­–ç•¥\r\n\r\n### ç¼ºç‚¹\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"CQRSç¼ºç‚¹\"\r\n        Complexity[å¤æ‚åº¦é«˜<br/>éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ¨¡å‹]\r\n        Consistency[æœ€ç»ˆä¸€è‡´æ€§<br/>å¯èƒ½æ•°æ®ä¸ä¸€è‡´]\r\n        Overhead[å¼€å‘å¼€é”€å¤§<br/>éœ€è¦æ›´å¤šä»£ç ]\r\n        Learning[å­¦ä¹ æ›²çº¿é™¡å³­<br/>éœ€è¦ç†è§£CQRS]\r\n    end\r\n    \r\n    style Complexity fill:#ffcccb\r\n    style Consistency fill:#ffcccb\r\n```\r\n\r\n**è¯¦ç»†è¯´æ˜**ï¼š\r\n- âŒ **å¤æ‚åº¦é«˜**ï¼šéœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ¨¡å‹å’ŒåŒæ­¥æœºåˆ¶\r\n- âŒ **æœ€ç»ˆä¸€è‡´æ€§**ï¼šæŸ¥è¯¢ç«¯å¯èƒ½æ•°æ®ä¸ä¸€è‡´\r\n- âŒ **å¼€å‘å¼€é”€å¤§**ï¼šéœ€è¦æ›´å¤šä»£ç å’ŒåŸºç¡€è®¾æ–½\r\n- âŒ **å­¦ä¹ æ›²çº¿é™¡å³­**ï¼šéœ€è¦ç†è§£CQRSæ¦‚å¿µ\r\n- âŒ **å¯èƒ½è¿‡åº¦è®¾è®¡**ï¼šç®€å•ç³»ç»Ÿå¯èƒ½ä¸éœ€è¦CQRS\r\n\r\n---\r\n\r\n## å®è·µæŒ‡å—\r\n\r\n### CQRSå®æ–½æ­¥éª¤\r\n\r\n```mermaid\r\ngraph TD\r\n    Start[å¼€å§‹CQRS] --> Step1[1. è¯†åˆ«å‘½ä»¤å’ŒæŸ¥è¯¢<br/>Identify Commands and Queries]\r\n    Step1 --> Step2[2. è®¾è®¡å‘½ä»¤æ¨¡å‹<br/>Design Command Model]\r\n    Step2 --> Step3[3. è®¾è®¡æŸ¥è¯¢æ¨¡å‹<br/>Design Query Model]\r\n    Step3 --> Step4[4. å®ç°åŒæ­¥æœºåˆ¶<br/>Implement Synchronization]\r\n    Step4 --> Step5[5. ä¼˜åŒ–æŸ¥è¯¢æ¨¡å‹<br/>Optimize Query Model]\r\n    Step5 --> End[å®Œæˆ]\r\n    \r\n    style Step1 fill:#ffebee\r\n    style Step2 fill:#fff4e1\r\n    style Step3 fill:#e1f5ff\r\n```\r\n\r\n### ä½•æ—¶ä½¿ç”¨CQRS\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"ä½¿ç”¨åœºæ™¯åˆ¤æ–­\"\r\n        HighRead[é«˜è¯»è´Ÿè½½<br/>High Read Load]\r\n        ComplexWrite[å¤æ‚å†™é€»è¾‘<br/>Complex Write Logic]\r\n        DifferentScale[ä¸åŒæ‰©å±•éœ€æ±‚<br/>Different Scaling Needs]\r\n        Performance[æ€§èƒ½è¦æ±‚é«˜<br/>High Performance Requirements]\r\n        \r\n        HighRead --> UseCQRS[ä½¿ç”¨CQRS]\r\n        ComplexWrite --> UseCQRS\r\n        DifferentScale --> UseCQRS\r\n        Performance --> UseCQRS\r\n    end\r\n    \r\n    style UseCQRS fill:#90ee90\r\n```\r\n\r\n**ä½¿ç”¨å»ºè®®**ï¼š\r\n- âœ… **é«˜è¯»è´Ÿè½½**ï¼šè¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œ\r\n- âœ… **å¤æ‚å†™é€»è¾‘**ï¼šå†™æ“ä½œé€»è¾‘å¤æ‚\r\n- âœ… **ä¸åŒæ‰©å±•éœ€æ±‚**ï¼šè¯»å†™éœ€è¦ä¸åŒçš„æ‰©å±•ç­–ç•¥\r\n- âœ… **æ€§èƒ½è¦æ±‚é«˜**ï¼šéœ€è¦é«˜åº¦ä¼˜åŒ–çš„æŸ¥è¯¢æ€§èƒ½\r\n\r\n---\r\n\r\n## ä¸å…¶ä»–æ¶æ„æ¨¡å¼çš„å…³ç³»\r\n\r\n### CQRSä¸å…¶ä»–æ¶æ„çš„å…³ç³»\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"æ¶æ„å…³ç³»\"\r\n        CQRS[CQRS]\r\n        ES[äº‹ä»¶æº¯æº<br/>Event Sourcing]\r\n        DDD[é¢†åŸŸé©±åŠ¨è®¾è®¡<br/>DDD]\r\n        Micro[å¾®æœåŠ¡<br/>Microservices]\r\n        \r\n        CQRS --> ES\r\n        CQRS --> DDD\r\n        CQRS --> Micro\r\n        \r\n        ES -.å¸¸ç»“åˆ.-> CQRS\r\n        DDD -.å¸¸ç»“åˆ.-> CQRS\r\n    end\r\n    \r\n    style CQRS fill:#ffebee\r\n```\r\n\r\n**å…³ç³»è¯´æ˜**ï¼š\r\n- **äº‹ä»¶æº¯æº**ï¼šCQRSå¸¸ä¸äº‹ä»¶æº¯æºç»“åˆä½¿ç”¨\r\n- **é¢†åŸŸé©±åŠ¨è®¾è®¡**ï¼šCQRSå¸¸ä¸DDDç»“åˆä½¿ç”¨\r\n- **å¾®æœåŠ¡**ï¼šCQRSé€‚åˆå¾®æœåŠ¡æ¶æ„\r\n- **è¯»å†™åˆ†ç¦»**ï¼šCQRSæ˜¯è¯»å†™åˆ†ç¦»çš„æè‡´å®ç°\r\n\r\n---\r\n\r\n## åº”ç”¨åœºæ™¯\r\n\r\n### é€‚ç”¨åœºæ™¯\r\n\r\n```mermaid\r\nmindmap\r\n  root((CQRSé€‚ç”¨åœºæ™¯))\r\n    é«˜è¯»è´Ÿè½½ç³»ç»Ÿ\r\n      æŠ¥è¡¨ç³»ç»Ÿ\r\n      åˆ†æç³»ç»Ÿ\r\n      ä»ªè¡¨æ¿\r\n    å¤æ‚å†™é€»è¾‘\r\n      å·¥ä½œæµç³»ç»Ÿ\r\n      å®¡æ‰¹ç³»ç»Ÿ\r\n      çŠ¶æ€æœºç³»ç»Ÿ\r\n    ä¸åŒæ‰©å±•éœ€æ±‚\r\n      è¯»å¤šå†™å°‘\r\n      è¯»å†™åˆ†ç¦»\r\n      ç‹¬ç«‹æ‰©å±•\r\n    æ€§èƒ½è¦æ±‚é«˜\r\n      å®æ—¶æŸ¥è¯¢\r\n      å¤æ‚æŸ¥è¯¢\r\n      å¤§æ•°æ®é‡\r\n```\r\n\r\n**å…·ä½“åœºæ™¯**ï¼š\r\n- âœ… **æŠ¥è¡¨ç³»ç»Ÿ**ï¼šé«˜è¯»è´Ÿè½½ï¼Œå¤æ‚æŸ¥è¯¢\r\n- âœ… **åˆ†æç³»ç»Ÿ**ï¼šè¯»å¤šå†™å°‘ï¼Œéœ€è¦ä¼˜åŒ–æŸ¥è¯¢\r\n- âœ… **å·¥ä½œæµç³»ç»Ÿ**ï¼šå¤æ‚å†™é€»è¾‘ï¼Œç®€å•æŸ¥è¯¢\r\n- âœ… **ç”µå•†ç³»ç»Ÿ**ï¼šé«˜è¯»è´Ÿè½½ï¼Œéœ€è¦ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½\r\n\r\n### ä¸é€‚ç”¨åœºæ™¯\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"ä¸é€‚ç”¨åœºæ™¯\"\r\n        Simple[ç®€å•ç³»ç»Ÿ<br/>è¯»å†™é€»è¾‘ç®€å•]\r\n        LowRead[ä½è¯»è´Ÿè½½<br/>è¯»æ“ä½œä¸å¤š]\r\n        SameModel[ç›¸åŒæ¨¡å‹<br/>è¯»å†™æ¨¡å‹ç›¸åŒ]\r\n        StrongConsistency[å¼ºä¸€è‡´æ€§è¦æ±‚<br/>ä¸èƒ½æ¥å—æœ€ç»ˆä¸€è‡´æ€§]\r\n    end\r\n    \r\n    style Simple fill:#ffcccb\r\n```\r\n\r\n**ä¸é€‚ç”¨åœºæ™¯**ï¼š\r\n- âŒ **ç®€å•ç³»ç»Ÿ**ï¼šè¯»å†™é€»è¾‘ç®€å•ï¼Œä¸éœ€è¦åˆ†ç¦»\r\n- âŒ **ä½è¯»è´Ÿè½½**ï¼šè¯»æ“ä½œä¸å¤šï¼Œä¸éœ€è¦ä¼˜åŒ–\r\n- âŒ **ç›¸åŒæ¨¡å‹**ï¼šè¯»å†™æ¨¡å‹ç›¸åŒï¼Œä¸éœ€è¦åˆ†ç¦»\r\n- âŒ **å¼ºä¸€è‡´æ€§è¦æ±‚**ï¼šä¸èƒ½æ¥å—æœ€ç»ˆä¸€è‡´æ€§\r\n\r\n---\r\n\r\n## å®é™…æ¡ˆä¾‹\r\n\r\n### æ¡ˆä¾‹1ï¼šç”µå•†è®¢å•ç³»ç»Ÿ\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"å‘½ä»¤ç«¯\"\r\n        CreateOrder[åˆ›å»ºè®¢å•å‘½ä»¤<br/>CreateOrder Command]\r\n        UpdateOrder[æ›´æ–°è®¢å•å‘½ä»¤<br/>UpdateOrder Command]\r\n        CommandHandler[å‘½ä»¤å¤„ç†å™¨<br/>Command Handler]\r\n        OrderAggregate[è®¢å•èšåˆ<br/>Order Aggregate]\r\n        WriteDB[(å†™æ•°æ®åº“)]\r\n    end\r\n    \r\n    subgraph \"æŸ¥è¯¢ç«¯\"\r\n        GetOrder[è·å–è®¢å•æŸ¥è¯¢<br/>GetOrder Query]\r\n        ListOrders[åˆ—å‡ºè®¢å•æŸ¥è¯¢<br/>ListOrders Query]\r\n        QueryHandler[æŸ¥è¯¢å¤„ç†å™¨<br/>Query Handler]\r\n        OrderView[è®¢å•è§†å›¾<br/>Order View]\r\n        ReadDB[(è¯»æ•°æ®åº“)]\r\n        Cache[ç¼“å­˜]\r\n    end\r\n    \r\n    subgraph \"åŒæ­¥\"\r\n        EventBus[äº‹ä»¶æ€»çº¿]\r\n        Projection[æŠ•å½±<br/>Projection]\r\n    end\r\n    \r\n    CreateOrder --> CommandHandler\r\n    UpdateOrder --> CommandHandler\r\n    CommandHandler --> OrderAggregate\r\n    OrderAggregate --> WriteDB\r\n    OrderAggregate --> EventBus\r\n    \r\n    GetOrder --> QueryHandler\r\n    ListOrders --> QueryHandler\r\n    QueryHandler --> OrderView\r\n    OrderView --> ReadDB\r\n    OrderView --> Cache\r\n    \r\n    EventBus --> Projection\r\n    Projection --> OrderView\r\n    \r\n    style CommandHandler fill:#ffebee\r\n    style QueryHandler fill:#e1f5ff\r\n    style EventBus fill:#fff4e1\r\n```\r\n\r\n### æ¡ˆä¾‹2ï¼šæ¸¸æˆæˆ˜æ–—ç³»ç»Ÿ\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"å‘½ä»¤ç«¯\"\r\n        ExecuteAction[æ‰§è¡Œè¡ŒåŠ¨å‘½ä»¤<br/>ExecuteAction Command]\r\n        CommandHandler[å‘½ä»¤å¤„ç†å™¨<br/>Command Handler]\r\n        BattleAggregate[æˆ˜æ–—èšåˆ<br/>Battle Aggregate]\r\n        WriteDB[(å†™æ•°æ®åº“)]\r\n    end\r\n    \r\n    subgraph \"æŸ¥è¯¢ç«¯\"\r\n        GetBattleState[è·å–æˆ˜æ–—çŠ¶æ€æŸ¥è¯¢<br/>GetBattleState Query]\r\n        GetUnitInfo[è·å–å•ä½ä¿¡æ¯æŸ¥è¯¢<br/>GetUnitInfo Query]\r\n        QueryHandler[æŸ¥è¯¢å¤„ç†å™¨<br/>Query Handler]\r\n        BattleView[æˆ˜æ–—è§†å›¾<br/>Battle View]\r\n        ReadDB[(è¯»æ•°æ®åº“)]\r\n        Cache[ç¼“å­˜]\r\n    end\r\n    \r\n    subgraph \"åŒæ­¥\"\r\n        EventBus[äº‹ä»¶æ€»çº¿]\r\n        Projection[æŠ•å½±<br/>Projection]\r\n    end\r\n    \r\n    ExecuteAction --> CommandHandler\r\n    CommandHandler --> BattleAggregate\r\n    BattleAggregate --> WriteDB\r\n    BattleAggregate --> EventBus\r\n    \r\n    GetBattleState --> QueryHandler\r\n    GetUnitInfo --> QueryHandler\r\n    QueryHandler --> BattleView\r\n    BattleView --> ReadDB\r\n    BattleView --> Cache\r\n    \r\n    EventBus --> Projection\r\n    Projection --> BattleView\r\n    \r\n    style CommandHandler fill:#ffebee\r\n    style QueryHandler fill:#e1f5ff\r\n    style EventBus fill:#fff4e1\r\n```\r\n\r\n---\r\n\r\n## è®¾è®¡åŸåˆ™\r\n\r\n### CQRSè®¾è®¡åŸåˆ™\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph \"CQRSè®¾è®¡åŸåˆ™\"\r\n        Principle1[è¯»å†™åˆ†ç¦»<br/>Separate Read and Write]\r\n        Principle2[ç‹¬ç«‹ä¼˜åŒ–<br/>Independent Optimization]\r\n        Principle3[æœ€ç»ˆä¸€è‡´æ€§<br/>Eventual Consistency]\r\n        Principle4[äº‹ä»¶é©±åŠ¨<br/>Event-Driven]\r\n        Principle5[æ¨¡å‹ç‹¬ç«‹<br/>Independent Models]\r\n    end\r\n    \r\n    style Principle1 fill:#ffebee\r\n```\r\n\r\n**æ ¸å¿ƒåŸåˆ™**ï¼š\r\n- **è¯»å†™åˆ†ç¦»**ï¼šå‘½ä»¤å’ŒæŸ¥è¯¢å®Œå…¨åˆ†ç¦»\r\n- **ç‹¬ç«‹ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–\r\n- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šæŸ¥è¯¢ç«¯å¯ä»¥æœ€ç»ˆä¸€è‡´\r\n- **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡äº‹ä»¶åŒæ­¥è¯»å†™æ¨¡å‹\r\n- **æ¨¡å‹ç‹¬ç«‹**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥ç‹¬ç«‹è®¾è®¡\r\n\r\n---\r\n\r\n## æ€»ç»“\r\n\r\nCQRSæ¶æ„æ¨¡å¼é€šè¿‡å°†è¯»å†™æ“ä½œå®Œå…¨åˆ†ç¦»ï¼Œä½¿ç”¨ä¸åŒçš„æ¨¡å‹å¤„ç†å‘½ä»¤å’ŒæŸ¥è¯¢ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚\r\n\r\n**æ ¸å¿ƒä»·å€¼**ï¼š\r\n- ğŸš€ **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–ï¼ŒæŸ¥è¯¢å¯ä»¥é«˜åº¦ä¼˜åŒ–\r\n- ğŸ“ˆ **å¯æ‰©å±•æ€§**ï¼šè¯»å†™å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼ŒæŸ¥è¯¢å¯ä»¥æ°´å¹³æ‰©å±•\r\n- ğŸ¯ **å¤æ‚åº¦ç®¡ç†**ï¼šè¯»å†™æ¨¡å‹å¯ä»¥æœ‰ä¸åŒçš„å¤æ‚åº¦\r\n- ğŸ”„ **çµæ´»æ€§**ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒåœºæ™¯ä¼˜åŒ–ä¸åŒæ¨¡å‹\r\n\r\n**é€‚ç”¨åœºæ™¯**ï¼š\r\n- âœ… é«˜è¯»è´Ÿè½½ç³»ç»Ÿ\r\n- âœ… å¤æ‚å†™é€»è¾‘\r\n- âœ… ä¸åŒæ‰©å±•éœ€æ±‚\r\n- âœ… æ€§èƒ½è¦æ±‚é«˜\r\n\r\n**æ³¨æ„äº‹é¡¹**ï¼š\r\n- âš ï¸ å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ¨¡å‹\r\n- âš ï¸ æœ€ç»ˆä¸€è‡´æ€§ï¼ŒæŸ¥è¯¢ç«¯å¯èƒ½æ•°æ®ä¸ä¸€è‡´\r\n- âš ï¸ å¼€å‘å¼€é”€å¤§ï¼Œéœ€è¦æ›´å¤šä»£ç \r\n- âš ï¸ ç®€å•ç³»ç»Ÿå¯èƒ½ä¸éœ€è¦CQRS\r\n\r\nCQRSæ˜¯ä¼˜åŒ–é«˜æ€§èƒ½ã€é«˜å¯æ‰©å±•æ€§ç³»ç»Ÿçš„ä¼˜ç§€æ¶æ„æ¨¡å¼ï¼Œç‰¹åˆ«é€‚åˆè¯»å¤šå†™å°‘ã€éœ€è¦é«˜åº¦ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½çš„ç³»ç»Ÿã€‚\r\n\r\n"
        }
    ]
}