{
    "sourceFile": "软件架构设计/分层架构模式.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1764234743696,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764234752428,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-﻿# 分层架构模式\r\n+# 分层架构模式\r\n \r\n ### 分层架构模式的定义\r\n \r\n **分层架构模式（Layered Architecture Pattern）**是最常见和基础的架构模式之一，它将系统组织成多个层次（Layer），每一层都有明确的职责，层与层之间通过接口进行交互。\r\n"
                },
                {
                    "date": 1764234891841,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-﻿# 分层架构模式（Layered Architecture Pattern）\r\n+# 分层架构模式（Layered Architecture Pattern）\r\n \r\n ## 目录\r\n \r\n - [概述](#概述)\r\n"
                }
            ],
            "date": 1764234743696,
            "name": "Commit-0",
            "content": "## 第七章：分层架构模式\r\n\r\n### 分层架构模式的定义\r\n\r\n**分层架构模式（Layered Architecture Pattern）**是最常见和基础的架构模式之一，它将系统组织成多个层次（Layer），每一层都有明确的职责，层与层之间通过接口进行交互。\r\n\r\n#### 核心思想\r\n\r\n分层架构模式的核心思想是**关注点分离（Separation of Concerns）**：\r\n- 将系统按照职责和抽象层次划分为多个层次\r\n- 每一层只关注自己的职责，不关心其他层的实现细节\r\n- 上层可以调用下层，但下层不能直接调用上层\r\n- 通过接口定义层与层之间的交互契约\r\n\r\n### 分层架构的结构\r\n\r\n#### 典型的分层结构\r\n\r\n```\r\n┌─────────────────────────────────┐\r\n│   表现层（Presentation Layer）  │  用户界面、交互逻辑\r\n├─────────────────────────────────┤\r\n│   业务层（Business Layer）      │  业务逻辑、领域模型\r\n├─────────────────────────────────┤\r\n│   数据访问层（Data Access Layer）│  数据访问、持久化\r\n├─────────────────────────────────┤\r\n│   数据层（Data Layer）          │  数据库、文件系统\r\n└─────────────────────────────────┘\r\n```\r\n\r\n#### 常见的分层架构\r\n\r\n**三层架构（3-Tier Architecture）：**\r\n1. **表现层（Presentation Layer）**\r\n   - 职责：用户界面、用户交互、输入验证\r\n   - 示例：Web 前端、桌面应用 UI、移动应用界面\r\n   - 关注点：用户体验、界面展示\r\n\r\n2. **业务层（Business Layer）**\r\n   - 职责：业务逻辑、业务规则、领域模型\r\n   - 示例：业务服务、领域服务、业务实体\r\n   - 关注点：业务功能、业务规则\r\n\r\n3. **数据层（Data Layer）**\r\n   - 职责：数据存储、数据访问、持久化\r\n   - 示例：数据库、文件系统、缓存\r\n   - 关注点：数据管理、数据一致性\r\n\r\n**四层架构（4-Layer Architecture）：**\r\n在三层架构基础上，将数据访问层独立出来：\r\n\r\n1. **表现层（Presentation Layer）**\r\n2. **业务层（Business Layer）**\r\n3. **数据访问层（Data Access Layer）**\r\n   - 职责：数据访问抽象、ORM、数据访问接口\r\n   - 示例：DAO、Repository、数据访问服务\r\n   - 关注点：数据访问抽象、持久化技术\r\n4. **数据层（Data Layer）**\r\n\r\n### 分层架构的规则\r\n\r\n#### 依赖规则（Dependency Rule）\r\n\r\n**核心规则：**\r\n- **上层可以依赖下层，但下层不能依赖上层**\r\n- **同层之间应该避免直接依赖**\r\n- **跨层调用应该避免（除非有特殊需求）**\r\n\r\n```\r\n┌─────────┐\r\n│  上层   │ ──┐\r\n└─────────┘   │ 可以依赖\r\n              │\r\n┌─────────┐   │\r\n│  下层   │ ◄─┘\r\n└─────────┘\r\n```\r\n\r\n**依赖方向：**\r\n- ✅ **允许**：表现层 → 业务层 → 数据访问层 → 数据层\r\n- ❌ **禁止**：数据层 → 数据访问层 → 业务层 → 表现层\r\n- ❌ **避免**：表现层 → 数据层（跨层调用）\r\n\r\n#### 接口规则\r\n\r\n- **每一层通过接口向上一层提供服务**\r\n- **接口定义在调用层（上层），实现在被调用层（下层）**\r\n- **接口应该稳定，实现可以变化**\r\n\r\n### 分层架构的优点\r\n\r\n#### 1. 关注点分离\r\n- 每一层只关注自己的职责\r\n- 降低系统的复杂度\r\n- 提高代码的可读性和可维护性\r\n\r\n#### 2. 可维护性\r\n- 修改某一层不影响其他层\r\n- 便于定位问题和修改代码\r\n- 降低修改的风险\r\n\r\n#### 3. 可测试性\r\n- 每一层可以独立测试\r\n- 可以通过 Mock 对象测试上层\r\n- 提高测试的效率和覆盖率\r\n\r\n#### 4. 可复用性\r\n- 下层可以被多个上层复用\r\n- 业务层可以在不同表现层中复用\r\n- 数据访问层可以在不同业务层中复用\r\n\r\n#### 5. 团队协作\r\n- 不同团队可以负责不同的层\r\n- 降低团队之间的耦合\r\n- 提高并行开发的效率\r\n\r\n### 分层架构的缺点\r\n\r\n#### 1. 性能开销\r\n- 层与层之间的调用可能带来性能开销\r\n- 跨层调用需要额外的处理\r\n- 可能影响系统的响应时间\r\n\r\n#### 2. 过度设计\r\n- 对于简单系统，分层可能过度设计\r\n- 增加不必要的抽象和复杂度\r\n- 可能降低开发效率\r\n\r\n#### 3. 灵活性限制\r\n- 严格的依赖规则可能限制灵活性\r\n- 某些场景可能需要跨层调用\r\n- 可能影响系统的扩展性\r\n\r\n### 分层架构的实践\r\n\r\n#### 1. 确定分层数量\r\n- **简单系统**：2-3 层（表现层、业务层、数据层）\r\n- **中等系统**：3-4 层（表现层、业务层、数据访问层、数据层）\r\n- **复杂系统**：4-5 层或更多（根据业务需求划分）\r\n\r\n#### 2. 定义层间接口\r\n- 明确每一层的职责和接口\r\n- 定义清晰的接口契约\r\n- 使用依赖注入降低耦合\r\n\r\n#### 3. 控制依赖方向\r\n- 严格遵循依赖规则\r\n- 使用依赖倒置原则（DIP）\r\n- 通过接口解耦层与层之间的依赖\r\n\r\n#### 4. 避免跨层调用\r\n- 避免表现层直接调用数据层\r\n- 通过业务层协调层与层之间的交互\r\n- 必要时使用门面模式（Facade Pattern）\r\n\r\n### 分层架构与其他架构模式\r\n\r\n#### 分层架构 vs MVC\r\n- **分层架构**：关注系统的整体层次划分\r\n- **MVC**：关注表现层的内部结构\r\n- **关系**：MVC 通常应用在表现层中\r\n\r\n#### 分层架构 vs 微服务架构\r\n- **分层架构**：单体应用内部的层次划分\r\n- **微服务架构**：系统级别的服务划分\r\n- **关系**：每个微服务内部可以使用分层架构\r\n\r\n### 分层架构的应用场景\r\n\r\n#### 适用场景\r\n- ✅ **企业级应用**：需要清晰的职责划分\r\n- ✅ **业务系统**：业务逻辑复杂，需要分层管理\r\n- ✅ **Web 应用**：典型的 MVC + 分层架构\r\n- ✅ **桌面应用**：需要清晰的层次结构\r\n\r\n#### 不适用场景\r\n- ❌ **简单系统**：功能简单，分层可能过度设计\r\n- ❌ **实时系统**：性能要求高，分层可能带来延迟\r\n- ❌ **嵌入式系统**：资源受限，分层可能增加开销\r\n\r\n### 分层架构的示例\r\n\r\n#### Web 应用分层架构\r\n\r\n```\r\n┌─────────────────────────────────────┐\r\n│  表现层（Controller/View）           │\r\n│  - 处理 HTTP 请求                    │\r\n│  - 渲染视图                          │\r\n│  - 输入验证                          │\r\n├─────────────────────────────────────┤\r\n│  业务层（Service）                   │\r\n│  - 业务逻辑处理                      │\r\n│  - 业务规则验证                      │\r\n│  - 领域模型管理                      │\r\n├─────────────────────────────────────┤\r\n│  数据访问层（Repository/DAO）       │\r\n│  - 数据访问抽象                      │\r\n│  - ORM 映射                          │\r\n│  - 查询优化                          │\r\n├─────────────────────────────────────┤\r\n│  数据层（Database）                  │\r\n│  - 数据存储                          │\r\n│  - 数据持久化                        │\r\n└─────────────────────────────────────┘\r\n```\r\n\r\n#### Unity 游戏应用分层架构\r\n\r\n```\r\n┌─────────────────────────────────────┐\r\n│  表现层（UI/View）                   │\r\n│  - Unity UI 组件                     │\r\n│  - 用户交互处理                      │\r\n│  - 界面更新                          │\r\n├─────────────────────────────────────┤\r\n│  业务层（Game Logic）                │\r\n│  - 游戏逻辑（Lua/C#）                │\r\n│  - 业务规则                          │\r\n│  - 领域模型                          │\r\n├─────────────────────────────────────┤\r\n│  数据访问层（Data Access）           │\r\n│  - 配置加载                          │\r\n│  - 数据查询                          │\r\n│  - 数据缓存                          │\r\n├─────────────────────────────────────┤\r\n│  数据层（Config/Data）               │\r\n│  - Excel 配置表                      │\r\n│  - JSON 配置文件                     │\r\n│  - 运行时数据                        │\r\n└─────────────────────────────────────┘\r\n```\r\n\r\n### 分层架构的关键原则\r\n\r\n#### 1. 单一职责原则（SRP）\r\n- 每一层只负责一个明确的职责\r\n- 避免层的职责重叠\r\n- 保持层的内聚性\r\n\r\n#### 2. 依赖倒置原则（DIP）\r\n- 上层依赖下层的接口，而不是实现\r\n- 通过接口解耦层与层之间的依赖\r\n- 提高系统的灵活性和可扩展性\r\n\r\n#### 3. 开闭原则（OCP）\r\n- 对扩展开放，对修改关闭\r\n- 通过接口扩展功能\r\n- 减少对现有代码的修改\r\n\r\n#### 4. 接口隔离原则（ISP）\r\n- 定义清晰的接口\r\n- 避免接口过于庞大\r\n- 按需提供接口\r\n\r\n### 总结\r\n\r\n分层架构模式是软件架构设计中最基础和重要的模式之一，它通过**关注点分离**和**依赖规则**，将系统组织成清晰的层次结构，提高了系统的**可维护性**、**可测试性**和**可复用性**。\r\n\r\n**关键要点：**\r\n- 分层架构的核心是关注点分离\r\n- 依赖规则：上层可以依赖下层，下层不能依赖上层\r\n- 通过接口定义层与层之间的交互契约\r\n- 根据系统复杂度确定分层数量\r\n- 避免跨层调用，保持层的独立性"
        }
    ]
}