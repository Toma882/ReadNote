{
    "sourceFile": "模块架构设计/MDC工具架构设计.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767203831837,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767203831837,
            "name": "Commit-0",
            "content": "# MDC工具架构设计\r\n\r\n## 设计目标\r\n\r\n设计一套完整的游戏设计文档管理系统，支持11种规则类型、工作流管理（草稿→审核→通过→实现）、团队协作（评论、标签、版本控制），提供与Unity编辑器集成的设计文档管理解决方案。\r\n\r\n---\r\n\r\n## 核心设计理念\r\n\r\n### 1. 文档结构化 + 工作流管理为核心\r\n\r\n**本质**：MDC工具的核心是设计文档的结构化管理和工作流控制\r\n- 文档结构化 = 将设计文档按11种规则类型分类管理\r\n- 工作流管理 = 草稿 → 审核中 → 已通过/已拒绝 → 已实现的状态流转\r\n- 版本控制 = 设计文档的版本管理和历史记录\r\n- Unity集成 = 在Unity编辑器内管理设计文档，打通设计与实现\r\n\r\n### 2. 数据驱动架构\r\n\r\n**本质**：设计文档特性通过配置数据实现，无需修改代码\r\n- 规则类型、规则状态 → 通过配置数据定义\r\n- 工作流状态、评论标签 → 通过配置数据调整\r\n- 新增规则类型 → 扩展配置数据即可\r\n- 文档管理 → 调整配置数据即可\r\n\r\n### 3. 单例模式 + 编辑器工具\r\n\r\n**本质**：通过单例模式管理全局数据，通过编辑器工具提供可视化界面\r\n- 单例模式 = MDCTool作为单例管理所有文档数据\r\n- 编辑器工具 = Odin Inspector提供可视化编辑界面\r\n- 数据持久化 = 设计文档数据保存到ScriptableObject\r\n- 导入导出 = 支持JSON格式的导入导出\r\n\r\n---\r\n\r\n## 整体架构设计\r\n\r\n### 三层架构 + 单例模式\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph DataLayer[\"数据层<br/>MDCData\"]\r\n        RuleData[\"规则数据<br/>MDCRule\"]\r\n        CommentData[\"评论数据<br/>MDCComment\"]\r\n        ContainerData[\"容器数据<br/>MDCDataContainer\"]\r\n    end\r\n    \r\n    subgraph ServiceLayer[\"服务层<br/>MDCTool单例\"]\r\n        RuleManager[\"规则管理器<br/>AddRule/UpdateRule/DeleteRule\"]\r\n        WorkflowManager[\"工作流管理器<br/>状态流转管理\"]\r\n        ImportExport[\"导入导出<br/>Import/Export JSON\"]\r\n    end\r\n    \r\n    subgraph EditorLayer[\"编辑器层<br/>Odin Inspector\"]\r\n        OverviewPage[\"总览页面<br/>MDCOverviewPage\"]\r\n        RulesPage[\"规则管理页面<br/>MDCRulesPage\"]\r\n        CreateWindow[\"创建规则窗口<br/>MDCCreateRuleWindow\"]\r\n    end\r\n    \r\n    DataLayer -->|被管理| ServiceLayer\r\n    ServiceLayer -->|提供数据| EditorLayer\r\n    EditorLayer -->|操作数据| ServiceLayer\r\n    \r\n    style DataLayer fill:#e1f5ff\r\n    style ServiceLayer fill:#fff4e1\r\n    style EditorLayer fill:#c8e6c9\r\n```\r\n\r\n### 工作流数据流\r\n\r\n```mermaid\r\ngraph LR\r\n    Start[创建规则<br/>草稿状态] -->|1. 提交审核| Review[审核中状态<br/>Review]\r\n    Review -->|2. 审核通过| Approved[已通过状态<br/>Approved]\r\n    Review -->|2. 审核拒绝| Rejected[已拒绝状态<br/>Rejected]\r\n    Approved -->|3. 实现完成| Implemented[已实现状态<br/>Implemented]\r\n    \r\n    style Start fill:#e1f5ff\r\n    style Review fill:#fff4e1\r\n    style Approved fill:#c8e6c9\r\n    style Implemented fill:#c8e6c9\r\n```\r\n\r\n**数据流特性**：\r\n- ✅ **状态流转**：草稿 → 审核中 → 已通过/已拒绝 → 已实现\r\n- ✅ **规则分类**：11种规则类型（Player、Character、Quest、Battle等）\r\n- ✅ **团队协作**：评论系统、标签系统、版本控制\r\n- ✅ **Unity集成**：在Unity编辑器内管理设计文档\r\n\r\n---\r\n\r\n## 服务层架构设计\r\n\r\n### 核心职责\r\n\r\n规则管理 + 工作流管理 + 数据持久化\r\n\r\n### 架构图\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph MDCTool[\"MDCTool单例\"]\r\n        Instance[\"单例实例<br/>Instance\"]\r\n        DataContainer[\"数据容器<br/>MDCDataContainer\"]\r\n        RuleManager[\"规则管理器<br/>AddRule/UpdateRule/DeleteRule\"]\r\n        WorkflowManager[\"工作流管理器<br/>状态流转\"]\r\n        ImportExport[\"导入导出<br/>Import/Export\"]\r\n    end\r\n    \r\n    subgraph RuleOperations[\"规则操作\"]\r\n        AddRule[\"添加规则<br/>AddRule\"]\r\n        UpdateRule[\"更新规则<br/>UpdateRule\"]\r\n        DeleteRule[\"删除规则<br/>DeleteRule\"]\r\n        GetRule[\"获取规则<br/>GetRule\"]\r\n    end\r\n    \r\n    subgraph WorkflowOperations[\"工作流操作\"]\r\n        ChangeStatus[\"改变状态<br/>ChangeStatus\"]\r\n        ValidateTransition[\"验证状态转换<br/>ValidateTransition\"]\r\n    end\r\n    \r\n    MDCTool -->|管理| RuleOperations\r\n    MDCTool -->|管理| WorkflowOperations\r\n    \r\n    style MDCTool fill:#e1f5ff\r\n    style RuleOperations fill:#fff4e1\r\n    style WorkflowOperations fill:#c8e6c9\r\n```\r\n\r\n### 工作流程\r\n\r\n```mermaid\r\nflowchart TD\r\n    Start[创建规则请求] --> CreateRule[创建规则对象<br/>MDCRule]\r\n    CreateRule --> SetStatus[设置状态<br/>Status = Draft]\r\n    SetStatus --> AddToContainer[添加到容器<br/>DataContainer.AddRule]\r\n    AddToContainer --> SaveData[保存数据<br/>SaveData]\r\n    SaveData --> Complete[创建完成]\r\n    \r\n    ChangeStatus[改变状态请求<br/>ChangeStatus] --> Validate{验证状态转换<br/>ValidateTransition}\r\n    Validate -->|有效| UpdateStatus[更新状态<br/>rule.Status = newStatus]\r\n    Validate -->|无效| Error[错误：无效的状态转换]\r\n    UpdateStatus --> SaveData2[保存数据<br/>SaveData]\r\n    SaveData2 --> Complete2[状态改变完成]\r\n    \r\n    style Validate fill:#fff4e1,stroke:#333,stroke-width:2px\r\n    style UpdateStatus fill:#c8e6c9\r\n    style SaveData fill:#c8e6c9\r\n```\r\n\r\n---\r\n\r\n## 编辑器层架构设计\r\n\r\n### 核心职责\r\n\r\n可视化界面 + 规则编辑 + 工作流管理\r\n\r\n### 架构图\r\n\r\n```mermaid\r\ngraph TB\r\n    subgraph EditorPanel[\"MDCEditorPanel编辑器窗口\"]\r\n        OverviewPage[\"总览页面<br/>MDCOverviewPage\"]\r\n        RulesPage[\"规则管理页面<br/>MDCRulesPage\"]\r\n        FilterSystem[\"过滤系统<br/>按类型/状态过滤\"]\r\n    end\r\n    \r\n    subgraph CreateWindow[\"MDCCreateRuleWindow创建窗口\"]\r\n        TypeSelector[\"类型选择器<br/>选择规则类型\"]\r\n        ContentEditor[\"内容编辑器<br/>编辑规则内容\"]\r\n        CreateButton[\"创建按钮<br/>CreateRule\"]\r\n    end\r\n    \r\n    subgraph DataBinding[\"数据绑定\"]\r\n        MDCToolInstance[\"MDCTool.Instance<br/>单例实例\"]\r\n        DataContainer[\"数据容器<br/>MDCDataContainer\"]\r\n    end\r\n    \r\n    EditorPanel -->|读取数据| DataBinding\r\n    CreateWindow -->|创建规则| DataBinding\r\n    DataBinding -->|更新数据| MDCToolInstance\r\n    \r\n    style EditorPanel fill:#e1f5ff\r\n    style CreateWindow fill:#fff4e1\r\n    style DataBinding fill:#c8e6c9\r\n```\r\n\r\n---\r\n\r\n## 架构模式分析\r\n\r\n### 单例模式（Singleton Pattern）\r\n\r\n**核心思想**：MDCTool作为单例管理全局文档数据\r\n\r\n```mermaid\r\ngraph TB\r\n    Client[客户端<br/>编辑器/代码]\r\n    Singleton[单例<br/>MDCTool.Instance]\r\n    Data[数据<br/>MDCDataContainer]\r\n    \r\n    Client -->|访问| Singleton\r\n    Singleton -->|管理| Data\r\n    \r\n    style Singleton fill:#f3e5f5\r\n    style Data fill:#c8e6c9\r\n```\r\n\r\n**优势**：\r\n- ✅ **全局访问**：任何地方都可以访问MDCTool实例\r\n- ✅ **数据统一**：所有文档数据统一管理\r\n- ✅ **状态管理**：工作流状态统一管理\r\n\r\n### 状态模式（State Pattern）\r\n\r\n**核心思想**：工作流状态通过状态模式管理\r\n\r\n```mermaid\r\ngraph TB\r\n    Context[上下文<br/>MDCRule]\r\n    StateInterface[状态接口<br/>EMDCStatus]\r\n    \r\n    DraftState[草稿状态<br/>Draft]\r\n    ReviewState[审核中状态<br/>Review]\r\n    ApprovedState[已通过状态<br/>Approved]\r\n    ImplementedState[已实现状态<br/>Implemented]\r\n    \r\n    Context -->|管理| StateInterface\r\n    StateInterface -->|实现| DraftState\r\n    StateInterface -->|实现| ReviewState\r\n    StateInterface -->|实现| ApprovedState\r\n    StateInterface -->|实现| ImplementedState\r\n    \r\n    style Context fill:#f3e5f5\r\n    style StateInterface fill:#e1f5ff\r\n    style DraftState fill:#c8e6c9\r\n    style ReviewState fill:#c8e6c9\r\n    style ApprovedState fill:#c8e6c9\r\n    style ImplementedState fill:#c8e6c9\r\n```\r\n\r\n---\r\n\r\n## 数据流设计\r\n\r\n### 规则创建数据流\r\n\r\n```mermaid\r\nsequenceDiagram\r\n    participant User as 用户\r\n    participant Editor as MDCEditorPanel\r\n    participant MDCTool as MDCTool\r\n    participant Data as MDCDataContainer\r\n    \r\n    User->>Editor: 创建规则\r\n    Editor->>MDCTool: AddRule(ruleData)\r\n    MDCTool->>MDCTool: 创建MDCRule对象\r\n    MDCTool->>MDCTool: 设置Status = Draft\r\n    MDCTool->>Data: AddRule(rule)\r\n    Data->>Data: 添加到规则列表\r\n    MDCTool->>MDCTool: SaveData()\r\n    MDCTool-->>Editor: 创建完成\r\n    Editor-->>User: 显示创建成功\r\n```\r\n\r\n### 工作流状态转换数据流\r\n\r\n```mermaid\r\nsequenceDiagram\r\n    participant User as 用户\r\n    participant Editor as MDCEditorPanel\r\n    participant MDCTool as MDCTool\r\n    participant Rule as MDCRule\r\n    \r\n    User->>Editor: 改变状态（草稿→审核中）\r\n    Editor->>MDCTool: ChangeStatus(ruleId, Review)\r\n    MDCTool->>MDCTool: ValidateTransition(oldStatus, Review)\r\n    MDCTool->>Rule: Status = Review\r\n    MDCTool->>MDCTool: SaveData()\r\n    MDCTool-->>Editor: 状态改变完成\r\n    Editor-->>User: 显示状态更新\r\n```\r\n\r\n---\r\n\r\n## 架构验证\r\n\r\n### 流程合理性验证\r\n\r\n从架构可验证：\r\n- ✅ **数据流完整**：创建规则 → 状态流转 → 实现完成（完整流程）\r\n- ✅ **职责清晰**：数据层、服务层、编辑器层职责明确，无重叠\r\n- ✅ **解耦设计**：通过单例模式和编辑器工具实现解耦\r\n- ✅ **工作流管理**：状态流转逻辑清晰，支持验证\r\n\r\n### 扩展性验证\r\n\r\n从架构可验证：\r\n- ✅ **规则类型扩展**：新增规则类型只需扩展EMDCType枚举\r\n- ✅ **状态扩展**：新增状态只需扩展EMDCStatus枚举\r\n- ✅ **编辑器扩展**：新增编辑器页面只需继承OdinMenuEditorWindow\r\n- ✅ **数据驱动**：规则特性通过配置数据扩展\r\n\r\n### 易用性验证\r\n\r\n从架构可验证：\r\n- ✅ **可视化界面**：Odin Inspector提供友好的编辑界面\r\n- ✅ **工作流管理**：清晰的状态流转和验证机制\r\n- ✅ **团队协作**：评论系统、标签系统、版本控制\r\n- ✅ **Unity集成**：在Unity编辑器内管理设计文档\r\n\r\n---\r\n\r\n## 开发指导原则\r\n\r\n### 一、开发约束（什么能做，什么不能做）\r\n\r\n#### ✅ 应该做的\r\n\r\n1. **规则必须通过MDCTool管理**\r\n   ```\r\n   ✅ 正确：\r\n   MDCTool.Instance.AddRule(rule)\r\n   \r\n   ❌ 错误：\r\n   直接操作MDCDataContainer\r\n   ```\r\n\r\n2. **状态转换必须验证**\r\n   ```\r\n   ✅ 正确：\r\n   MDCTool.Instance.ChangeStatus(ruleId, newStatus)\r\n   -- 内部验证状态转换有效性\r\n   \r\n   ❌ 错误：\r\n   直接修改rule.Status\r\n   ```\r\n\r\n3. **数据必须持久化**\r\n   ```\r\n   ✅ 正确：\r\n   MDCTool.Instance.SaveData()\r\n   \r\n   ❌ 错误：\r\n   修改数据后不保存\r\n   ```\r\n\r\n#### ❌ 不应该做的\r\n\r\n1. **禁止直接操作MDCDataContainer**\r\n   - 必须通过MDCTool统一管理\r\n   - 不能直接修改DataContainer\r\n\r\n2. **禁止绕过状态验证**\r\n   - 状态转换必须通过ChangeStatus方法\r\n   - 不能直接修改rule.Status\r\n\r\n3. **禁止在编辑器外直接修改数据**\r\n   - 数据修改应该通过编辑器工具\r\n   - 不能直接修改ScriptableObject文件\r\n\r\n### 二、开发流程（标准化开发步骤）\r\n\r\n#### 使用MDC工具的标准流程\r\n\r\n```\r\n1. 打开编辑器窗口\r\n   ↓\r\n   Window > MDC > MDC Editor Panel\r\n   \r\n2. 创建规则\r\n   ↓\r\n   点击\"创建规则\"按钮\r\n   选择规则类型（Player/Character/Quest等）\r\n   编辑规则内容\r\n   \r\n3. 提交审核\r\n   ↓\r\n   规则状态：草稿 → 审核中\r\n   \r\n4. 审核通过\r\n   ↓\r\n   规则状态：审核中 → 已通过\r\n   \r\n5. 实现完成\r\n   ↓\r\n   规则状态：已通过 → 已实现\r\n```\r\n\r\n---\r\n\r\n## 总结\r\n\r\n### 架构设计价值\r\n\r\n该架构设计文档的价值在于：\r\n- ✅ **思路解构**：完整解构MDC工具系统的搭建思路\r\n- ✅ **流程验证**：从架构层面验证流程合理性\r\n- ✅ **模式分析**：分析单例模式、状态模式的应用\r\n- ✅ **开发指导**：为后续详细设计和实现提供清晰指导\r\n\r\n### 设计原则\r\n\r\n- ✅ **文档结构化 + 工作流管理为核心**：设计文档按规则类型分类，通过工作流管理状态流转\r\n- ✅ **数据驱动架构**：设计文档特性通过配置数据实现\r\n- ✅ **单例模式 + 编辑器工具**：通过单例管理全局数据，通过编辑器工具提供可视化界面\r\n- ✅ **Unity集成**：在Unity编辑器内管理设计文档，打通设计与实现\r\n\r\n### 架构特点\r\n\r\n- ✅ **规则分类**：11种规则类型（Player、Character、Quest、Battle等）\r\n- ✅ **工作流管理**：草稿 → 审核中 → 已通过/已拒绝 → 已实现\r\n- ✅ **团队协作**：评论系统、标签系统、版本控制\r\n- ✅ **Unity集成**：在Unity编辑器内管理设计文档\r\n\r\n细节实现是后续开发阶段的工作，当前架构设计已足够指导整个MDC工具系统的开发。\r\n"
        }
    ]
}